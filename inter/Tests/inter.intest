-cases [Valid] 'inter/Tests/Valid'
-cases [Invalid] 'inter/Tests/Invalid'
-cases [General] 'inter/Tests/General'
-cases [Duplex] 'inter/Tests/Duplex'
-cases [PipelineErrors] 'inter/Tests/PipelineErrors'
-cases [Units] 'inter/Tests/Units'

-recipe [Valid]

	set: $O = $PATH/$CASE.intert
	set: $A = $PATH/_Textual/$CASE.intert
	set: $B = $PATH/_Binary/$CASE.interb
	set: $T = $PATH/_Console/$CASE.txt

	mkdir: $PATH/_Textual
	mkdir: $PATH/_Binary
	mkdir: $PATH/_Console

	step: inter/Tangled/inter $O -binary $B >$T 2>&1
	or: 'produced errors in inter' $T

	step: inter/Tangled/inter $B -textual $A >$T 2>&1
	or: 'produced errors in inter' $T

	show: $A

	match text: $A $O
	or: 'produced incorrect output'

-end

-recipe [Invalid]

	set: $O = $PATH/$CASE.intert
	set: $A = $PATH/_Results_Actual/$CASE.txt
	set: $I = $PATH/_Results_Ideal/$CASE.txt

	mkdir: $PATH/_Results_Actual
	mkdir: $PATH/_Results_Ideal

	fail step: inter/Tangled/inter $O >$A 2>&1
	or: 'failed to produce error message' $A
	show: $A
	exists: $I
	or: 'produced error(s), but no ideal transcript existed'
	match text: $A $I
	or: 'produced the wrong error message(s)'

-end

-recipe [General]

	set: $O = $PATH/$CASE.intert
	set: $P = $PATH/_Pipelines/$CASE.interpipeline
	set: $A = $PATH/_Results_Actual/$CASE.txt
	set: $I = $PATH/_Results_Ideal/$CASE.txt
	set: $T = $PATH/_Console/$CASE.txt

	mkdir: $PATH/_Results_Actual
	mkdir: $PATH/_Results_Ideal
	mkdir: $PATH/_Console

	step: inter/Tangled/inter -architecture 16d -template inform7/Internal/I6T/standard_rules -variable '*in=$O' -variable '*out=$A' -pipeline-file $P >$T 2>&1
	or: 'failed to produce output' $T

	show: $A

	match text: $A $I
	or: 'produced incorrect output'

-end

-recipe [Duplex]

	set: $P = $PATH/$CASE.interpipeline
	set: $OA = $PATH/_Pairs/$CASE+A.intert
	set: $OB = $PATH/_Pairs/$CASE+B.intert
	set: $BA = $PATH/_Binaries/$CASE+A.interb
	set: $BB = $PATH/_Binaries/$CASE+B.interb
	set: $AA = $PATH/_Results_Actual/$CASE+A.txt
	set: $IA = $PATH/_Results_Ideal/$CASE+A.txt
	set: $AB = $PATH/_Results_Actual/$CASE+B.txt
	set: $IB = $PATH/_Results_Ideal/$CASE+B.txt
	set: $T = $PATH/_Console/$CASE.txt

	mkdir: $PATH/_Results_Actual
	mkdir: $PATH/_Results_Ideal
	mkdir: $PATH/_Console
	mkdir: $PATH/_Binaries

	step: inter/Tangled/inter -template inform7/Internal/I6T -variable '*inA=$OA' -variable '*inB=$OB' -variable '*binA=$BA' -variable '*binB=$BB' -variable '*outA=$AA' -variable '*outB=$AB' -pipeline-file $P >$T 2>&1
	or: 'failed to produce output' $T

	show: $A

	match text: $AA $IA
	or: 'produced incorrect output on A'

	match text: $AB $IB
	or: 'produced incorrect output on B'

-end

-recipe [PipelineErrors]

	set: $O = $PATH/$CASE.intert
	set: $P = $PATH/$CASE.interpipeline
	set: $A = $PATH/_Results_Actual/$CASE.txt
	set: $I = $PATH/_Results_Ideal/$CASE.txt

	mkdir: $PATH/_Results_Actual
	mkdir: $PATH/_Results_Ideal

	fail step: inter/Tangled/inter -template inform7/Internal/I6T -variable '*in=$O' -pipeline-file $P >$A 2>&1
	or: 'failed to produce errors' $A

	show: $A

	match text: $A $I
	or: 'produced incorrect errors'

-end

-recipe [Units]

	set: $O = $PATH/$CASE.txt
	set: $A = $PATH/_Results_Actual/$CASE.txt
	set: $I = $PATH/_Results_Ideal/$CASE.txt

	mkdir: $PATH/_Results_Actual
	mkdir: $PATH/_Results_Ideal
	mkdir: $PATH/_Console

	step: inter/Tangled/inter -template inform7/Internal/I6T -test $O >$A 2>&1
	or: 'failed to produce output' $A

	show: $A

	match text: $A $I
	or: 'produced incorrect output'

-end
