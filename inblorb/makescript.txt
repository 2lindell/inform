# This is the script from which inweb -makefile will construct a makefile.

{platform-settings}

{identity-settings}

BLORBLIB = $(ME)/Tests/Assistants/blorblib

# Making the program:

$(ME)/Tangled/$(MYNAME): $(BLORBLIB)/blorbscan {dependent-files}
	$(call make-me)

.PHONY: force
force:
	$(call make-me)

define make-me
	$(INWEB) $(ME) -tangle
	$(CC) -o $(ME)/Tangled/$(ME).o $(ME)/Tangled/$(ME).c
	$(LINK) -o $(ME)/Tangled/$(ME)$(EXEEXTENSION) $(ME)/Tangled/$(ME).o $(LINKEROPTS)
endef

# Testing the program:

.PHONY: test
test: $(BLORBLIB)/blorbscan
	$(INTEST) -from $(ME) all

$(BLORBLIB)/blorbscan: $(BLORBLIB)/*.c $(BLORBLIB)/*.h
	cd $(BLORBLIB); $(INDULGENTCC) blorblib.c
	cd $(BLORBLIB); $(INDULGENTCC) blorbscan.c
	cd $(BLORBLIB); $(LINK) -o blorbscan$(EXEEXTENSION) *.o $(LINKEROPTS)

# Cleaning up:

.PHONY: clean
clean:
	$(call clean-up)

.PHONY: purge
purge:
	$(call clean-up)
	rm -f $(ME)/Tangled/$(ME)
	rm -f $(BLORBLIB)/blorbscan

define clean-up
	rm -f $(ME)/Tangled/*.o
	rm -f $(ME)/Tangled/*.c
	rm -f $(ME)/Tangled/*.h
	rm -f $(BLORBLIB)/*.o
endef
