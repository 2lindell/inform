<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>P/cu</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../webs.html">Sources</a></h1>
<ul>
<li><a href="../compiler.html"><b>compiler</b></a></li>
<li><a href="../other.html">other tools</a></li>
<li><a href="../extensions.html">extensions and kits</a></li>
<li><a href="../units.html">unit test tools</a></li>
</ul>
<h2>Compiler Webs</h2>
<ul>
<li><a href="../inbuild/index.html">inbuild</a></li>
<li><a href="../inform7/index.html">inform7</a></li>
<li><a href="../inter/index.html">inter</a></li>
</ul>
<h2>Inbuild Modules</h2>
<ul>
<li><a href="../inbuild-module/index.html">inbuild</a></li>
<li><a href="../arch-module/index.html">arch</a></li>
<li><a href="../words-module/index.html">words</a></li>
<li><a href="../syntax-module/index.html">syntax</a></li>
<li><a href="../html-module/index.html">html</a></li>
</ul>
<h2>Inform7 Modules</h2>
<ul>
<li><a href="../core-module/index.html">core</a></li>
<li><a href="../problems-module/index.html">problems</a></li>
<li><a href="../inflections-module/index.html">inflections</a></li>
<li><a href="../linguistics-module/index.html">linguistics</a></li>
<li><a href="../kinds-module/index.html">kinds</a></li>
<li><a href="../if-module/index.html">if</a></li>
<li><a href="../multimedia-module/index.html">multimedia</a></li>
<li><a href="../index-module/index.html">index</a></li>
</ul>
<h2>Inter Modules</h2>
<ul>
<li><a href="../inter-module/index.html">inter</a></li>
<li><a href="../building-module/index.html">building</a></li>
<li><a href="../codegen-module/index.html">codegen</a></li>
</ul>
<h2>Foundation</h2>
<ul>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>
</ul>


		</nav>
		<main role="main">
		
<!--Weave of '1/mn' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">Source</a></li><li><a href="../compiler.html">Compiler</a></li><li><a href="index.html">inform7 7.10.1</a></li><li><a href="index.html#1">Chapter 1: Delegation</a></li><li><b>Main</b></li></ul><p class="purpose">A shell for the modules which actually form the compiler.</p>

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1.  </b>The source code for the Inform 7 compiler is modularised, and each module
has its own web, leaving very little here. (To get a sense of how Inform works,
read the web for the Core module, and dip into the others as needed.)
</p>

<p class="inwebparagraph">First, some identification:
</p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">INTOOL_NAME</span><span class="plain"> </span><span class="string">"inform7"</span>
    <span class="definitionkeyword">define</span> <span class="constant">INFORM7_BUILD</span><span class="plain"> </span><span class="string">"inform7 [[Build Number]]"</span>
    <span class="definitionkeyword">define</span> <span class="constant">HUMAN_READABLE_INTOOL_NAME</span><span class="plain"> </span><span class="string">"Inform 7"</span>
</pre>
<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>On some platforms the core Inform compiler is a separate command-line tool,
so that execution should begin with <code class="display"><span class="extract">main()</span></code>, as in all C programs. But some
Inform UI applications need to compile it into the body of a larger program:
those should define the symbol <code class="display"><span class="extract">SUPPRESS_MAIN</span></code> and call <code class="display"><span class="extract">Main::core_inform_main()</span></code>
when they want I7 to run.
</p>


<pre class="display">
    <span class="plain">#</span><span class="identifier">ifndef</span><span class="plain"> </span><span class="constant">SUPPRESS_MAIN</span>
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">main</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">argc</span><span class="plain">, </span><span class="reserved">char</span><span class="plain"> *</span><span class="identifier">argv</span><span class="plain">[]) {</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">Main::core_inform_main</span><span class="plain">(</span><span class="identifier">argc</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">);</span>
    <span class="plain">}</span>
    <span class="plain">#</span><span class="identifier">endif</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function main is used in 2/pl2 (<a href="2-pl2.html#SP3_1">&#167;3.1</a>), 2/pck (<a href="2-pck.html#SP3">&#167;3</a>), 2/cnn (<a href="2-cnn.html#SP1">&#167;1</a>), 1/ic (<a href="1-ic.html#SP15">&#167;15</a>), 5/kts (<a href="5-kts.html#SP1">&#167;1</a>), 6/st (<a href="6-st.html#SP1">&#167;1</a>), 4/am (<a href="4-am.html#SP26_1">&#167;26.1</a>), 10/varc (<a href="10-varc.html#SP14">&#167;14</a>), 19/tb (<a href="19-tb.html#SP27">&#167;27</a>, <a href="19-tb.html#SP27_1">&#167;27.1</a>, <a href="19-tb.html#SP27_1_3">&#167;27.1.3</a>, <a href="19-tb.html#SP29">&#167;29</a>), 21/rl2 (<a href="21-rl2.html#SP23">&#167;23</a>), 22/ph (<a href="22-ph.html#SP4">&#167;4</a>), 22/pu (<a href="22-pu.html#SP3">&#167;3</a>), 26/uo (<a href="26-uo.html#SP11_1">&#167;11.1</a>), 27/cm (<a href="27-cm.html#SP1">&#167;1</a>), 1/bs (<a href="1-bs.html#SP2">&#167;2</a>), 3/fc (<a href="3-fc.html#SP1">&#167;1</a>), 3/sm (<a href="3-sm.html#SP36">&#167;36</a>, <a href="3-sm.html#SP36_1">&#167;36.1</a>, <a href="3-sm.html#SP38">&#167;38</a>), 3/em2 (<a href="3-em2.html#SP24">&#167;24</a>), 4/ap (<a href="4-ap.html#SP2">&#167;2</a>).</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>Either way, that brings us here. All our modules have to be started up and
shut down, so we take care of that with one more intermediary. These modules
fall into four categories:
</p>

<p class="inwebparagraph"></p>

<ul class="items"><li>(a) Libraries of code providing services to the compiler but containing
none of its logic: Foundation, Words, Inflections, Syntax, Linguistics,
Kinds, Problems, Index. Foundation is shared with numerous other tools,
and is part of the Inweb repository.
</li></ul>
<ul class="items"><li>(b) Core, the front end of the compiler for the basic Inform 7 language.
</li></ul>
<ul class="items"><li>(c) Inter and Codegen, the back end. These modules are shared with the
command-line tool Inter.
</li></ul>
<ul class="items"><li>(d) Extensions to the Inform 7 language for interactive fiction: IF,
Multimedia.
</li></ul>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Main::core_inform_main</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">argc</span><span class="plain">, </span><span class="reserved">char</span><span class="plain"> *</span><span class="identifier">argv</span><span class="plain">[]) {</span>
        <span class="functiontext">Foundation::start</span><span class="plain">(); </span>    <span class="comment">must be started first</span>
        <span class="functiontext">WordsModule::start</span><span class="plain">();</span>
        <span class="functiontext">InflectionsModule::start</span><span class="plain">();</span>
        <span class="functiontext">SyntaxModule::start</span><span class="plain">();</span>
        <span class="functiontext">LinguisticsModule::start</span><span class="plain">();</span>
        <span class="functiontext">KindsModule::start</span><span class="plain">();</span>
        <span class="functiontext">ProblemsModule::start</span><span class="plain">();</span>
        <span class="functiontext">CoreModule::start</span><span class="plain">();</span>
        <span class="functiontext">IFModule::start</span><span class="plain">();</span>
        <span class="functiontext">MultimediaModule::start</span><span class="plain">();</span>
        <span class="functiontext">HTMLModule::start</span><span class="plain">();</span>
        <span class="functiontext">IndexModule::start</span><span class="plain">();</span>
        <span class="functiontext">ArchModule::start</span><span class="plain">();</span>
        <span class="functiontext">InterModule::start</span><span class="plain">();</span>
        <span class="functiontext">BuildingModule::start</span><span class="plain">();</span>
        <span class="functiontext">CodegenModule::start</span><span class="plain">();</span>
        <span class="functiontext">InbuildModule::start</span><span class="plain">();</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">rv</span><span class="plain"> = </span><span class="functiontext">CoreMain::main</span><span class="plain">(</span><span class="identifier">argc</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">);</span>

        <span class="functiontext">WordsModule::end</span><span class="plain">();</span>
        <span class="functiontext">InflectionsModule::end</span><span class="plain">();</span>
        <span class="functiontext">SyntaxModule::end</span><span class="plain">();</span>
        <span class="functiontext">LinguisticsModule::end</span><span class="plain">();</span>
        <span class="functiontext">KindsModule::end</span><span class="plain">();</span>
        <span class="functiontext">ProblemsModule::end</span><span class="plain">();</span>
        <span class="functiontext">MultimediaModule::end</span><span class="plain">();</span>
        <span class="functiontext">CoreModule::end</span><span class="plain">();</span>
        <span class="functiontext">IFModule::end</span><span class="plain">();</span>
        <span class="functiontext">IndexModule::end</span><span class="plain">();</span>
        <span class="functiontext">HTMLModule::end</span><span class="plain">();</span>
        <span class="functiontext">InterModule::end</span><span class="plain">();</span>
        <span class="functiontext">ArchModule::end</span><span class="plain">();</span>
        <span class="functiontext">BuildingModule::end</span><span class="plain">();</span>
        <span class="functiontext">CodegenModule::end</span><span class="plain">();</span>
        <span class="functiontext">InbuildModule::end</span><span class="plain">();</span>
        <span class="functiontext">Foundation::end</span><span class="plain">(); </span>    <span class="comment">must be ended last</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">rv</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Main::core_inform_main is used in <a href="#SP2">&#167;2</a>.</p>

<hr class="tocbar">
<ul class="toc"><li><i>(This section begins Chapter 1: Delegation.)</i></li><li><i>(This section ends Chapter 1: Delegation.)</i></li></ul><hr class="tocbar">
<!--End of weave-->
		</main>
	</body>
</html>

