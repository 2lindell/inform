<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Context Symbols</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-src/Figures/Inform.png" height=72">
</a></h1>
<ul><li><a href="../compiler.html">compiler tools</a></li>
<li><a href="../other.html">other tools</a></li>
<li><a href="../extensions.html">extensions and kits</a></li>
<li><a href="../units.html">unit test tools</a></li>
</ul><h2>Other Tools</h2><ul>
<li><a href="../inblorb/index.html">inblorb</a></li>
<li><a href="index.html"><span class="selectedlink">indoc</span></a></li>
<li><a href="../inpolicy/index.html">inpolicy</a></li>
<li><a href="../inrtps/index.html">inrtps</a></li>
</ul><h2>Foundation</h2><ul>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>

</ul>
		</nav>
		<main role="main">
		
<!--Weave of 'Context Symbols' generated by 7-->
<ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="../other.html">Other Tools</a></li><li><a href="index.html">indoc</a></li><li><a href="index.html#1">Chapter 1: Setting Up</a></li><li><b>Context Symbols</b></li></ul><p class="purpose">Provides conditional rendering of text, depending on context.</p>

<ul class="toc"><li><a href="1-cs.html#SP1">&#167;1. About symbols</a></li><li><a href="1-cs.html#SP2">&#167;2. Starting up</a></li><li><a href="1-cs.html#SP3">&#167;3. Making and unmaking</a></li><li><a href="1-cs.html#SP4">&#167;4. Testing</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. About symbols. </b>Documentation is allowed to contain rawtext which varies depending on the
context: on what platform it's being written for, or what format it is
being rendered to, for example. The context is defined by which symbol
names have been defined.
</p>

<p class="inwebparagraph">Symbols are C-like identifiers (alphanumeric or underscored). The symbol has
been declared if and only if it is an existing key for the following hash,
and the associated value is "y".
</p>

<pre class="display">
    <span class="reserved">dictionary</span><span class="plain"> *</span><span class="identifier">defined_symbols</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2. Starting up. </b>The symbol <code class="display"><span class="extract">indoc</span></code> is always defined, so that, in theory, other programs
working on rawtext can distinguish themselves from us (by not defining it).
For example,
</p>

<pre class="display">
        <span class="plain">{^indoc:}You'll probably never see this paragraph.</span>
</pre>

<p class="inwebparagraph">provides rawtext visible only if <code class="display"><span class="extract">indoc</span></code> isn't the renderer.
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Symbols::start_up_symbols<button class="popup" onclick="togglePopup('usagePopup17')">...<span class="popuptext" id="usagePopup17">Usage of <b>Symbols::start_up_symbols</b>:<br>Main - <a href="1-mn.html#SP1_1">&#167;1.1</a></span></button></span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="functiontext"><a href="1-cs.html#SP3">Symbols::declare_symbol</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"indoc"</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3. Making and unmaking. </b></p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Symbols::declare_symbol<button class="popup" onclick="togglePopup('usagePopup18')">...<span class="popuptext" id="usagePopup18">Usage of <b>Symbols::declare_symbol</b>:<br><a href="1-cs.html#SP2">&#167;2</a>, Instructions - <a href="1-ins.html#SP5">&#167;5</a>, <a href="1-ins.html#SP3_2">&#167;3.2</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">symbol</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">defined_symbols</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">defined_symbols</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/2-dct.html#SP2">Dictionaries::new</a></span><span class="plain">(10, </span><span class="constant">TRUE</span><span class="plain">);</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">entry</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/2-dct.html#SP9">Dictionaries::create_text</a></span><span class="plain">(</span><span class="identifier">defined_symbols</span><span class="plain">, </span><span class="identifier">symbol</span><span class="plain">);</span>
        <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">entry</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"y"</span><span class="plain">);</span>
        <span class="identifier">LOGIF</span><span class="plain">(</span><span class="identifier">SYMBOLS</span><span class="plain">, </span><span class="string">"Declaring &lt;%S&gt;\n"</span><span class="plain">, </span><span class="identifier">symbol</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Symbols::undeclare_symbol<button class="popup" onclick="togglePopup('usagePopup19')">...<span class="popuptext" id="usagePopup19">Usage of <b>Symbols::undeclare_symbol</b>:<br>Instructions - <a href="1-ins.html#SP5">&#167;5</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">symbol</span><span class="plain">) {</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">entry</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/2-dct.html#SP10">Dictionaries::get_text</a></span><span class="plain">(</span><span class="identifier">defined_symbols</span><span class="plain">, </span><span class="identifier">symbol</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">entry</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="reserved">return</span><span class="plain">;</span>
        <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">entry</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"n"</span><span class="plain">);</span>
        <span class="identifier">LOGIF</span><span class="plain">(</span><span class="identifier">SYMBOLS</span><span class="plain">, </span><span class="string">"Undeclaring &lt;%S&gt;\n"</span><span class="plain">, </span><span class="identifier">symbol</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4. Testing. </b>This returns 1 if the current context matches the condition given, and 0
otherwise.
</p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Symbols::perform_ifdef<button class="popup" onclick="togglePopup('usagePopup20')">...<span class="popuptext" id="usagePopup20">Usage of <b>Symbols::perform_ifdef</b>:<br><a href="1-cs.html#SP5_1">&#167;5.1</a>, <a href="1-cs.html#SP5_2">&#167;5.2</a>, <a href="1-cs.html#SP5_3">&#167;5.3</a>, <a href="1-cs.html#SP5_4">&#167;5.4</a>, Structural Scan - <a href="2-ss.html#SP6_1">&#167;6.1</a><br>Rawtext Reader - <a href="2-rr.html#SP4_1">&#167;4.1</a>, <a href="2-rr.html#SP4_6_1">&#167;4.6.1</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">cond</span><span class="plain">) {</span>
        <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=0, </span><span class="identifier">L</span><span class="plain">=</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">cond</span><span class="plain">); </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">L</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) {</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">cond</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-chr.html#SP2">Characters::is_whitespace</a></span><span class="plain">(</span><span class="identifier">c</span><span class="plain">)) {</span>
                <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP24">Str::delete_nth_character</a></span><span class="plain">(</span><span class="identifier">cond</span><span class="plain">, </span><span class="identifier">i</span><span class="plain">);</span>
                <span class="identifier">i</span><span class="plain">--; </span><span class="identifier">L</span><span class="plain">--;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">v</span><span class="plain"> = </span><span class="functiontext"><a href="1-cs.html#SP5">Symbols::perform_ifdef_inner</a></span><span class="plain">(</span><span class="identifier">cond</span><span class="plain">);</span>
        <span class="identifier">LOGIF</span><span class="plain">(</span><span class="identifier">SYMBOLS</span><span class="plain">, </span><span class="string">"Ifdef &lt;%S&gt; --&gt; %s\n"</span><span class="plain">, </span><span class="identifier">cond</span><span class="plain">, </span><span class="identifier">v</span><span class="plain">?</span><span class="string">"yes"</span><span class="plain">:</span><span class="string">"no"</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">v</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5.  </b>There is an expression grammar here, which we apply correctly if the
condition is well-formed; if it"s a mess, we try to return 0, but don"t go
to any trouble to report errors.
</p>

<p class="inwebparagraph">Any condition can be bracketed; otherwise we have the unary operator <code class="display"><span class="extract">^</span></code>
(negation), the binary <code class="display"><span class="extract">+</span></code> (conjunction), and binary <code class="display"><span class="extract">,</span></code> (disjunction),
which associate in that order. An atomic condition is true if and only if
it is a declared symbol. So for example
</p>

<p class="inwebparagraph">	^alpha,beta+gamma
</p>

<p class="inwebparagraph">is true if either alpha is undeclared, or if both beta and gamma are declared.
Whereas
</p>

<p class="inwebparagraph">	^(alpha,beta)+gamma
	^alpha+^beta+gamma
</p>

<p class="inwebparagraph">are both true if alpha and beta are undeclared but gamma is declared.
</p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Symbols::perform_ifdef_inner<button class="popup" onclick="togglePopup('usagePopup21')">...<span class="popuptext" id="usagePopup21">Usage of <b>Symbols::perform_ifdef_inner</b>:<br><a href="1-cs.html#SP4">&#167;4</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">cond</span><span class="plain">) {</span>
        &lt;<span class="cwebmacro">Subexpressions can be bracketed</span> <span class="cwebmacronumber">5.1</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">The comma operator is left-associative and means or</span> <span class="cwebmacronumber">5.2</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">The plus operator is left-associative and means and</span> <span class="cwebmacronumber">5.3</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">The caret operator is unary and means not</span> <span class="cwebmacronumber">5.4</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">A bare symbol name is true if and only if it is declared</span> <span class="cwebmacronumber">5.5</span>&gt;<span class="plain">;</span>

        &lt;<span class="cwebmacro">The expression is malformed</span> <span class="cwebmacronumber">5.6</span>&gt;<span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP5_1"></a><b>&#167;5.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Subexpressions can be bracketed</span> <span class="cwebmacronumber">5.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cond</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%((%c*)%)"</span><span class="plain">)) {</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">rv</span><span class="plain"> = </span><span class="functiontext"><a href="1-cs.html#SP4">Symbols::perform_ifdef</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]);</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="identifier">rv</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="1-cs.html#SP5">&#167;5</a>.</p>

<p class="inwebparagraph"><a id="SP5_2"></a><b>&#167;5.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">The comma operator is left-associative and means or</span> <span class="cwebmacronumber">5.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">k</span><span class="plain"> = </span><span class="functiontext"><a href="1-cs.html#SP6">Symbols::find_operator</a></span><span class="plain">(</span><span class="identifier">cond</span><span class="plain">, </span><span class="character">','</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">k</span><span class="plain"> &gt;= </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">L</span><span class="plain">);</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">);</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">L</span><span class="plain">, </span><span class="identifier">cond</span><span class="plain">);</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP15">Str::truncate</a></span><span class="plain">(</span><span class="identifier">L</span><span class="plain">, </span><span class="identifier">k</span><span class="plain">);</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP16">Str::copy_tail</a></span><span class="plain">(</span><span class="identifier">R</span><span class="plain">, </span><span class="identifier">cond</span><span class="plain">, </span><span class="identifier">k</span><span class="plain">+1);</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">rv</span><span class="plain"> = ((</span><span class="functiontext"><a href="1-cs.html#SP4">Symbols::perform_ifdef</a></span><span class="plain">(</span><span class="identifier">L</span><span class="plain">)) || (</span><span class="functiontext"><a href="1-cs.html#SP4">Symbols::perform_ifdef</a></span><span class="plain">(</span><span class="identifier">R</span><span class="plain">)));</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">L</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="identifier">rv</span><span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">k</span><span class="plain"> == -2) </span>&lt;<span class="cwebmacro">The expression is malformed</span> <span class="cwebmacronumber">5.6</span>&gt;<span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="1-cs.html#SP5">&#167;5</a>.</p>

<p class="inwebparagraph"><a id="SP5_3"></a><b>&#167;5.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">The plus operator is left-associative and means and</span> <span class="cwebmacronumber">5.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">k</span><span class="plain"> = </span><span class="functiontext"><a href="1-cs.html#SP6">Symbols::find_operator</a></span><span class="plain">(</span><span class="identifier">cond</span><span class="plain">, </span><span class="character">'+'</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">k</span><span class="plain"> &gt;= </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">L</span><span class="plain">);</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">);</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">L</span><span class="plain">, </span><span class="identifier">cond</span><span class="plain">);</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP15">Str::truncate</a></span><span class="plain">(</span><span class="identifier">L</span><span class="plain">, </span><span class="identifier">k</span><span class="plain">);</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP16">Str::copy_tail</a></span><span class="plain">(</span><span class="identifier">R</span><span class="plain">, </span><span class="identifier">cond</span><span class="plain">, </span><span class="identifier">k</span><span class="plain">+1);</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">rv</span><span class="plain"> = ((</span><span class="functiontext"><a href="1-cs.html#SP4">Symbols::perform_ifdef</a></span><span class="plain">(</span><span class="identifier">L</span><span class="plain">)) &amp;&amp; (</span><span class="functiontext"><a href="1-cs.html#SP4">Symbols::perform_ifdef</a></span><span class="plain">(</span><span class="identifier">R</span><span class="plain">)));</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">L</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="identifier">rv</span><span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">k</span><span class="plain"> == -2) </span>&lt;<span class="cwebmacro">The expression is malformed</span> <span class="cwebmacronumber">5.6</span>&gt;<span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="1-cs.html#SP5">&#167;5</a>.</p>

<p class="inwebparagraph"><a id="SP5_4"></a><b>&#167;5.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">The caret operator is unary and means not</span> <span class="cwebmacronumber">5.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cond</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%^(%c*)"</span><span class="plain">)) {</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">rv</span><span class="plain"> = </span><span class="functiontext"><a href="1-cs.html#SP4">Symbols::perform_ifdef</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]);</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="identifier">rv</span><span class="plain">?</span><span class="identifier">FALSE:TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="1-cs.html#SP5">&#167;5</a>.</p>

<p class="inwebparagraph"><a id="SP5_5"></a><b>&#167;5.5.  </b><code class="display">
&lt;<span class="cwebmacrodefn">A bare symbol name is true if and only if it is declared</span> <span class="cwebmacronumber">5.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cond</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%i+"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
            <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">entry</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/2-dct.html#SP10">Dictionaries::get_text</a></span><span class="plain">(</span><span class="identifier">defined_symbols</span><span class="plain">, </span><span class="identifier">cond</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">entry</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"y"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="1-cs.html#SP5">&#167;5</a>.</p>

<p class="inwebparagraph"><a id="SP5_6"></a><b>&#167;5.6.  </b><code class="display">
&lt;<span class="cwebmacrodefn">The expression is malformed</span> <span class="cwebmacronumber">5.6</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="functiontext"><a href="../../../inweb/docs/foundation-module/3-em.html#SP7">Errors::with_text</a></span><span class="plain">(</span><span class="string">"malformed condition: %S"</span><span class="plain">, </span><span class="identifier">cond</span><span class="plain">); </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">0</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="1-cs.html#SP5">&#167;5</a>, <a href="1-cs.html#SP5_2">&#167;5.2</a>, <a href="1-cs.html#SP5_3">&#167;5.3</a>.</p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6.  </b>The following looks for a single character <code class="display"><span class="extract">op</span></code> in any unbracketed interior
parts of the text <code class="display"><span class="extract">cond</span></code>, and looks out for mismatched brackets on the way.
</p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Symbols::find_operator<button class="popup" onclick="togglePopup('usagePopup22')">...<span class="popuptext" id="usagePopup22">Usage of <b>Symbols::find_operator</b>:<br><a href="1-cs.html#SP5_2">&#167;5.2</a>, <a href="1-cs.html#SP5_3">&#167;5.3</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">cond</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">op</span><span class="plain">) {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">bl</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">k</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">, </span><span class="identifier">L</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">cond</span><span class="plain">); </span><span class="identifier">k</span><span class="plain"> &lt; </span><span class="identifier">L</span><span class="plain">; </span><span class="identifier">k</span><span class="plain">++) {</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">ch</span><span class="plain"> = </span><span class="functiontext"><a href="../../../inweb/docs/foundation-module/4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">cond</span><span class="plain">, </span><span class="identifier">k</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ch</span><span class="plain"> == </span><span class="character">'('</span><span class="plain">) </span><span class="identifier">bl</span><span class="plain">++;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ch</span><span class="plain"> == </span><span class="character">')'</span><span class="plain">) </span><span class="identifier">bl</span><span class="plain">--;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">bl</span><span class="plain"> &lt; </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> -2; </span><span class="comment"> Too many close brackets</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">bl</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="identifier">k</span><span class="plain"> &gt; </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="identifier">k</span><span class="plain"> &lt; </span><span class="identifier">L</span><span class="plain"> - </span><span class="constant">1</span><span class="plain">) &amp;&amp; (</span><span class="identifier">ch</span><span class="plain"> == </span><span class="identifier">op</span><span class="plain">)) {</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="identifier">k</span><span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">bl</span><span class="plain"> != </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> -2; </span><span class="comment"> Too many open brackets</span>
        <span class="reserved">return</span><span class="plain"> -1; </span><span class="comment"> Not found</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<hr class="tocbar">
<ul class="toc"><li><a href="1-ins.html">Back to 'Instructions'</a></li><li><i>(This section ends Chapter 1: Setting Up.)</i></li></ul><hr class="tocbar">
<!--End of weave-->
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
		</main>
	</body>
</html>

