<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Instructions</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-src/Figures/Inform.png" height=72">
</a></h1>
<ul><li><a href="../compiler.html">compiler tools</a></li>
<li><a href="../other.html">other tools</a></li>
<li><a href="../extensions.html">extensions and kits</a></li>
<li><a href="../units.html">unit test tools</a></li>
</ul><h2>Other Tools</h2><ul>
<li><a href="../inblorb/index.html">inblorb</a></li>
<li><a href="index.html"><span class="selectedlink">indoc</span></a></li>
<li><a href="../inpolicy/index.html">inpolicy</a></li>
<li><a href="../inrtps/index.html">inrtps</a></li>
</ul><h2>Foundation</h2><ul>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>

</ul>
		</nav>
		<main role="main">
		
<!--Weave of 'Instructions' generated by 7-->
<ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="../other.html">Other Tools</a></li><li><a href="index.html">indoc</a></li><li><a href="index.html#1">Chapter 1: Setting Up</a></li><li><b>Instructions</b></li></ul><p class="purpose">Instructions of indoc to different output types.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Definitions</a></li><li><a href="#SP3">&#167;3. Instructions file</a></li><li><a href="#SP6">&#167;6. Parsing values</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Definitions. </b>The command-line and Instructions-file-set values provide a large slate of
what used to be global variables in the Perl version of Indoc. Today they
are herded together into an instance of the <code class="display"><span class="extract">settings_block</span></code> structure,
and in particular into a global instance of this called <code class="display"><span class="extract">indoc_settings</span></code>.
</p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">LETTER_ALPHABETIZATION</span><span class="plain"> </span><span class="constant">1</span>
    <span class="definitionkeyword">define</span> <span class="constant">WORD_ALPHABETIZATION</span><span class="plain"> </span><span class="constant">2</span>
    <span class="definitionkeyword">define</span> <span class="constant">EXMODE_open_internal</span><span class="plain"> </span><span class="constant">1</span>
    <span class="definitionkeyword">define</span> <span class="constant">EXMODE_openable_internal</span><span class="plain"> </span><span class="constant">2</span>
    <span class="definitionkeyword">define</span> <span class="constant">BOOK_GRANULARITY</span><span class="plain"> </span><span class="constant">1</span>
    <span class="definitionkeyword">define</span> <span class="constant">CHAPTER_GRANULARITY</span><span class="plain"> </span><span class="constant">2</span>
    <span class="definitionkeyword">define</span> <span class="constant">SECTION_GRANULARITY</span><span class="plain"> </span><span class="constant">3</span>
    <span class="definitionkeyword">define</span> <span class="constant">SAME_AS_MAIN_GRANULARITY</span><span class="plain"> -1</span>
    <span class="definitionkeyword">define</span> <span class="constant">HTML_FORMAT</span><span class="plain"> </span><span class="constant">1</span>
    <span class="definitionkeyword">define</span> <span class="constant">PLAIN_FORMAT</span><span class="plain"> </span><span class="constant">2</span>
    <span class="definitionkeyword">define</span> <span class="constant">PASTEMODE_none</span><span class="plain"> </span><span class="constant">1</span>
    <span class="definitionkeyword">define</span> <span class="constant">PASTEMODE_Andrew</span><span class="plain"> </span><span class="constant">2</span>
    <span class="definitionkeyword">define</span> <span class="constant">PASTEMODE_David</span><span class="plain"> </span><span class="constant">3</span>
    <span class="definitionkeyword">define</span> <span class="constant">WRAPPER_none</span><span class="plain"> </span><span class="constant">1</span>
    <span class="definitionkeyword">define</span> <span class="constant">WRAPPER_epub</span><span class="plain"> </span><span class="constant">2</span>
    <span class="definitionkeyword">define</span> <span class="constant">WRAPPER_zip</span><span class="plain"> </span><span class="constant">3</span>
</pre>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">settings_block</span><span class="plain"> {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">verbose_mode</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">test_index_mode</span><span class="plain">;</span>

        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">destination</span><span class="plain">; </span><span class="comment"> path to the directory where documentation will be made</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">destination_modifiable</span><span class="plain">; </span><span class="comment"> can <code class="display"><span class="extract">destination</span></code> still be changed by instructions?</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">manifest_leafname</span><span class="plain">; </span><span class="comment"> within the <code class="display"><span class="extract">destination</span></code> directory</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">xrefs_filename</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">insertion_filename</span><span class="plain">;</span>

        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">book_folder</span><span class="plain">;</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">book_cover_image</span><span class="plain">; </span><span class="comment"> e.g., <code class="display"><span class="extract">cover-image.png</span></code>; by default, none</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">index_alphabetisation_algorithm</span><span class="plain">; </span><span class="comment"> one of the <code class="display"><span class="extract">*_ALPHABETIZATION</span></code> values above</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">granularity</span><span class="plain">; </span><span class="comment"> one of the <code class="display"><span class="extract">*_GRANULARITY</span></code> values above</span>

        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">contents_leafname</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">contents_expandable</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">toc_granularity</span><span class="plain">; </span><span class="comment"> one of the <code class="display"><span class="extract">*_GRANULARITY</span></code> values above</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">book_contains_examples</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">examples_mode</span><span class="plain">; </span><span class="comment"> one of the <code class="display"><span class="extract">EXMODE_*</span></code> values above</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">examples_alphabetical_leafname</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">examples_numerical_leafname</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">examples_thematic_leafname</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">examples_directory</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">examples_granularity</span><span class="plain">; </span><span class="comment"> one of the <code class="display"><span class="extract">*_GRANULARITY</span></code> values above</span>

        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">change_logs_folder</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">css_source_file</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">definitions_filename</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">definitions_index_leafname</span><span class="plain">;</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">format</span><span class="plain">; </span><span class="comment"> one of the <code class="display"><span class="extract">*_FORMAT</span></code> values above</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">XHTML</span><span class="plain">; </span><span class="comment"> a flag: relevant only if <code class="display"><span class="extract">HTML_FORMAT</span></code> is chosen</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">javascript</span><span class="plain">; </span><span class="comment"> a flag</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">javascript_paste_method</span><span class="plain">; </span><span class="comment"> one of the <code class="display"><span class="extract">PASTEMDDE_*</span></code> values above</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">html_for_Inform_application</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">images_copy</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">images_path</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">inform_definitions_mode</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">suppress_fonts</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">assume_Public_Library</span><span class="plain">;</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">retina_images</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">support_creation</span><span class="plain">;</span>

        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">link_to_extensions_index</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">top_and_tail</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">top_and_tail_sections</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">treat_code_as_verbatim</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">wrapper</span><span class="plain">; </span><span class="comment"> one of the <code class="display"><span class="extract">WRAPPER_*</span></code> values above</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">ebook</span><span class="plain"> *</span><span class="reserved">ebook</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">navigation_design</span><span class="plain"> *</span><span class="identifier">navigation</span><span class="plain">;</span>

        <span class="constant">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">settings_block</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure settings_block is accessed in 1/mn, 1/cnf, 2/ss, 2/exm, 2/rnd, 2/rr, 2/utc, 2/haj, 2/css, 3/iu, 3/gi, 3/ei, 4/nd, 4/cm, 4/ca, 4/ct, 4/cr and here.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b></p>

<pre class="display">
    <span class="reserved">settings_block</span><span class="plain"> *</span><span class="functiontext">Instructions::clean_slate<button class="popup" onclick="togglePopup('usagePopup7')">...<span class="popuptext" id="usagePopup7">Usage of <b>Instructions::clean_slate</b>:<br>Main - <a href="1-mn.html#SP1_1">&#167;1.1</a></span></button></span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="reserved">settings_block</span><span class="plain"> *</span><span class="identifier">settings</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">settings_block</span><span class="plain">);</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">verbose_mode</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">test_index_mode</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">destination</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">destination_modifiable</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">manifest_leafname</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">xrefs_filename</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">insertion_filename</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">book_folder</span><span class="plain"> = </span><span class="functiontext"><a href="3-pth.html#SP5">Pathnames::from_text</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"Documentation"</span><span class="plain">);</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">book_cover_image</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">index_alphabetisation_algorithm</span><span class="plain"> = </span><span class="constant">LETTER_ALPHABETIZATION</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">granularity</span><span class="plain"> = </span><span class="constant">SECTION_GRANULARITY</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">contents_leafname</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">contents_expandable</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">toc_granularity</span><span class="plain"> = </span><span class="constant">SAME_AS_MAIN_GRANULARITY</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">book_contains_examples</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_mode</span><span class="plain"> = </span><span class="constant">EXMODE_open_internal</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_alphabetical_leafname</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_numerical_leafname</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_thematic_leafname</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_directory</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_granularity</span><span class="plain"> = </span><span class="constant">SAME_AS_MAIN_GRANULARITY</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">change_logs_folder</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">; </span><span class="comment"> default not set here, as it depends on book folder</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">css_source_file</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">definitions_filename</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">definitions_index_leafname</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">format</span><span class="plain"> = </span><span class="constant">HTML_FORMAT</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">XHTML</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">javascript</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">javascript_paste_method</span><span class="plain"> = </span><span class="constant">PASTEMODE_none</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">html_for_Inform_application</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">images_copy</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">images_path</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">inform_definitions_mode</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">suppress_fonts</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">assume_Public_Library</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">retina_images</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">support_creation</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">link_to_extensions_index</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">top_and_tail</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">top_and_tail_sections</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">treat_code_as_verbatim</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">wrapper</span><span class="plain"> = </span><span class="constant">WRAPPER_none</span><span class="plain">;</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="reserved">ebook</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">navigation</span><span class="plain"> = </span><span class="functiontext"><a href="4-nd.html#SP1">Nav::default</a></span><span class="plain">();</span>

        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">settings</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3. Instructions file. </b>Note that <code class="display"><span class="extract">indoc</span></code> reports errors in the instructions file, but doesn't halt on
them until all have been found. (The user may as well get all of the bad news,
not just the beginning of it.)
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Instructions::read_instructions<button class="popup" onclick="togglePopup('usagePopup8')">...<span class="popuptext" id="usagePopup8">Usage of <b>Instructions::read_instructions</b>:<br>Configuration - <a href="1-cnf.html#SP1">&#167;1</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">target_sought</span><span class="plain">, </span><span class="reserved">linked_list</span><span class="plain"> *</span><span class="identifier">L</span><span class="plain">,</span>
        <span class="reserved">settings_block</span><span class="plain"> *</span><span class="identifier">settings</span><span class="plain">) {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">found_flag</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">; </span><span class="comment"> was a target of this name actually found?</span>

        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">change_logs_folder</span><span class="plain"> = </span><span class="functiontext"><a href="3-pth.html#SP4">Pathnames::subfolder</a></span><span class="plain">(</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">book_folder</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Change Logs"</span><span class="plain">);</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_directory</span><span class="plain"> = </span><span class="functiontext"><a href="3-pth.html#SP4">Pathnames::subfolder</a></span><span class="plain">(</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">book_folder</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Examples"</span><span class="plain">);</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">css_source_file</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP2">Filenames::in_folder</a></span><span class="plain">(</span><span class="identifier">path_to_indoc_materials</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"base.css"</span><span class="plain">);</span>
        <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">definitions_index_leafname</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"general_index.html"</span><span class="plain">);</span>

        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="reserved">filename</span><span class="plain">, </span><span class="identifier">L</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="#SP4">Instructions::read_instructions_from</a></span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="identifier">target_sought</span><span class="plain">, </span><span class="identifier">settings</span><span class="plain">))</span>
                <span class="identifier">found_flag</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>

        &lt;<span class="cwebmacro">Reconcile any conflicting instructions</span> <span class="cwebmacronumber">3.1</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">Declare the format and wrapper as symbols</span> <span class="cwebmacronumber">3.2</span>&gt;<span class="plain">;</span>

        <span class="functiontext"><a href="2-haj.html#SP6">HTMLUtilities::add_image_source</a></span><span class="plain">(</span><span class="functiontext"><a href="3-pth.html#SP4">Pathnames::subfolder</a></span><span class="plain">(</span><span class="identifier">path_to_indoc_materials</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"images"</span><span class="plain">));</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">found_flag</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">)</span>
            <span class="functiontext"><a href="3-em.html#SP2">Errors::fatal_with_text</a></span><span class="plain">(</span><span class="string">"unknown target %S"</span><span class="plain">, </span><span class="identifier">target_sought</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4.  </b>The instructions can be either at the top level, which means they apply to
all targets, or grouped in braced blocks relevant to one target only. For
example,
</p>

<pre class="display">
        <span class="plain">superbness = 20</span>
        <span class="plain">hypercard {</span>
            <span class="plain">superbness = 40</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph">applies 20 for all targets except <code class="display"><span class="extract">hypercard</span></code>, where it applies 40.
</p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">ins_helper_state</span><span class="plain"> {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">found_aim</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">settings_block</span><span class="plain"> *</span><span class="identifier">settings</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">desired_target</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">scanning_target</span><span class="plain">;</span>
    <span class="plain">} </span><span class="reserved">ins_helper_state</span><span class="plain">;</span>

    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Instructions::read_instructions_from<button class="popup" onclick="togglePopup('usagePopup9')">...<span class="popuptext" id="usagePopup9">Usage of <b>Instructions::read_instructions_from</b>:<br><a href="#SP3">&#167;3</a>, <a href="#SP5">&#167;5</a></span></button></span><span class="plain">(</span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">desired</span><span class="plain">,</span>
        <span class="reserved">settings_block</span><span class="plain"> *</span><span class="identifier">settings</span><span class="plain">) {</span>
        <span class="reserved">ins_helper_state</span><span class="plain"> </span><span class="identifier">ihs</span><span class="plain">;</span>
        <span class="identifier">ihs</span><span class="plain">.</span><span class="element">scanning_target</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP2">Str::new</a></span><span class="plain">();</span>
        <span class="identifier">ihs</span><span class="plain">.</span><span class="element">desired_target</span><span class="plain"> = </span><span class="identifier">desired</span><span class="plain">;</span>
        <span class="identifier">ihs</span><span class="plain">.</span><span class="element">found_aim</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
        <span class="identifier">ihs</span><span class="plain">.</span><span class="element">settings</span><span class="plain"> = </span><span class="identifier">settings</span><span class="plain">;</span>
            <span class="functiontext"><a href="4-tf.html#SP5">TextFiles::read</a></span><span class="plain">(</span><span class="identifier">F</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"can't open instructions file"</span><span class="plain">,</span>
            <span class="constant">TRUE</span><span class="plain">, </span><span class="functiontext"><a href="#SP5">Instructions::read_instructions_helper</a></span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, &amp;</span><span class="identifier">ihs</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">ihs</span><span class="plain">.</span><span class="identifier">found_aim</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure ins_helper_state is accessed in 1/cnf and here.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5.  </b></p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Instructions::read_instructions_helper<button class="popup" onclick="togglePopup('usagePopup10')">...<span class="popuptext" id="usagePopup10">Usage of <b>Instructions::read_instructions_helper</b>:<br><a href="#SP4">&#167;4</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">cl</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">,</span>
        <span class="reserved">void</span><span class="plain"> *</span><span class="identifier">v_ihs</span><span class="plain">) {</span>
        <span class="reserved">ins_helper_state</span><span class="plain"> *</span><span class="identifier">ihs</span><span class="plain"> = (</span><span class="reserved">ins_helper_state</span><span class="plain"> *) </span><span class="identifier">v_ihs</span><span class="plain">;</span>
        <span class="reserved">settings_block</span><span class="plain"> *</span><span class="identifier">settings</span><span class="plain"> = </span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">settings</span><span class="plain">;</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *#%c*"</span><span class="plain">)) { </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">); </span><span class="reserved">return</span><span class="plain">; }</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *"</span><span class="plain">)) { </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">); </span><span class="reserved">return</span><span class="plain">; }</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%C+) { *"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">scanning_target</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">)</span>
                <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"second target opened while first is still open"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
            <span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">scanning_target</span><span class="plain">, </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">scanning_target</span><span class="plain">, </span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">desired_target</span><span class="plain">)) </span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">found_aim</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *} *"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">scanning_target</span><span class="plain">) == </span><span class="constant">0</span><span class="plain">)</span>
                <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"unexpected target end-marker"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
            <span class="functiontext"><a href="4-sm.html#SP15">Str::clear</a></span><span class="plain">(</span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">scanning_target</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext"><a href="4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">scanning_target</span><span class="plain">) == </span><span class="constant">0</span><span class="plain">) ||</span>
                <span class="plain">(</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">scanning_target</span><span class="plain">, </span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">desired_target</span><span class="plain">))) {</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">verbose_mode</span><span class="plain">)</span>
                    <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"%f, line %d: %S\n"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">-&gt;</span><span class="element">text_file_filename</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">-&gt;</span><span class="element">line_count</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *follow: *(%c*?) *"</span><span class="plain">)) {</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="#SP4">Instructions::read_instructions_from</a></span><span class="plain">(</span>
                        <span class="functiontext"><a href="3-fln.html#SP2">Filenames::in_folder</a></span><span class="plain">(</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">book_folder</span><span class="plain">, </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]),</span>
                        <span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">desired_target</span><span class="plain">, </span><span class="identifier">settings</span><span class="plain">))</span>
                        <span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">found_aim</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
                <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *declare: *(%c*?) *"</span><span class="plain">)) {</span>
                    <span class="functiontext"><a href="1-cs.html#SP3">Symbols::declare_symbol</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]);</span>
                <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *undeclare: *(%c*?) *"</span><span class="plain">)) {</span>
                    <span class="functiontext"><a href="1-cs.html#SP3">Symbols::undeclare_symbol</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]);</span>
                <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span>&lt;<span class="cwebmacro">This is an instruction</span> <span class="cwebmacronumber">5.1</span>&gt;<span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP5_1"></a><b>&#167;5.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">This is an instruction</span> <span class="cwebmacronumber">5.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *volume: *(%c*?) *"</span><span class="plain">)) {</span>
            &lt;<span class="cwebmacro">Disallow this in a specific target</span> <span class="cwebmacronumber">5.1.1</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Act on a volume creation</span> <span class="cwebmacronumber">5.1.2</span>&gt;
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *cover: *(%c*?) *"</span><span class="plain">)) {</span>
            &lt;<span class="cwebmacro">Disallow this in a specific target</span> <span class="cwebmacronumber">5.1.1</span>&gt;<span class="plain">;</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">book_cover_image</span><span class="plain"> = </span><span class="functiontext"><a href="#SP7">Instructions::set_file</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">settings</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *examples *"</span><span class="plain">)) {</span>
            &lt;<span class="cwebmacro">Disallow this in a specific target</span> <span class="cwebmacronumber">5.1.1</span>&gt;<span class="plain">;</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">book_contains_examples</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *dc:(%C+): *(%c*?) *"</span><span class="plain">)) {</span>
            &lt;<span class="cwebmacro">Disallow this in a specific target</span> <span class="cwebmacronumber">5.1.1</span>&gt;<span class="plain">;</span>
            <span class="functiontext"><a href="#SP10">Instructions::create_ebook_metadata</a></span><span class="plain">(</span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]), </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]));</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *css: *(%c*?) *"</span><span class="plain">)) {</span>
            &lt;<span class="cwebmacro">Act on a CSS tweak</span> <span class="cwebmacronumber">5.1.3</span>&gt;<span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *index: *(%c*?) *"</span><span class="plain">)) {</span>
            &lt;<span class="cwebmacro">Act on an indexing notation</span> <span class="cwebmacronumber">5.1.4</span>&gt;<span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *images: *(%c*?) *"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="2-haj.html#SP6">HTMLUtilities::add_image_source</a></span><span class="plain">(</span><span class="functiontext"><a href="#SP6">Instructions::set_path</a></span><span class="plain">(</span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">settings</span><span class="plain">));</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">cl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *(%C+) *= *(%c*?) *"</span><span class="plain">)) {</span>
            &lt;<span class="cwebmacro">Act on an instructions setting</span> <span class="cwebmacronumber">5.1.5</span>&gt;<span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"unknown syntax in instructions file"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP5">&#167;5</a>.</p>

<p class="inwebparagraph"><a id="SP5_1_1"></a><b>&#167;5.1.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Disallow this in a specific target</span> <span class="cwebmacronumber">5.1.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">ihs</span><span class="plain">-&gt;</span><span class="element">scanning_target</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">)</span>
            <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span>
                <span class="string">"structural settings like this one must apply to all targets"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP5_1">&#167;5.1</a> (four times), <a href="#SP5_1_2">&#167;5.1.2</a>.</p>

<p class="inwebparagraph"><a id="SP5_1_2"></a><b>&#167;5.1.2.  </b>Here's where we parse the specifier part of lines like
</p>

<pre class="display">
        <span class="plain">volume: The Inform Recipe Book (RB) = The Recipe Book.txt</span>
</pre>

<p class="inwebparagraph">which reads:
</p>

<pre class="display">
        <span class="plain">The Inform Recipe Book (RB) = The Recipe Book.txt</span>
</pre>

<p class="inwebparagraph"></p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Act on a volume creation</span> <span class="cwebmacronumber">5.1.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        &lt;<span class="cwebmacro">Disallow this in a specific target</span> <span class="cwebmacronumber">5.1.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">title</span><span class="plain"> = </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0];</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">file</span><span class="plain">);</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">abbrev</span><span class="plain">);</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr2</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">title</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c+?) *= *(%c+?)"</span><span class="plain">)) { </span><span class="comment"> the optional filename syntax</span>
            <span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">title</span><span class="plain">, </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]); </span><span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">file</span><span class="plain">, </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">file</span><span class="plain">, </span><span class="string">"%S.txt"</span><span class="plain">, </span><span class="identifier">title</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">title</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?) *%((%c*?)%)"</span><span class="plain">)) { </span><span class="comment"> the optional abbreviation syntax</span>
            <span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">title</span><span class="plain">, </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]); </span><span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">abbrev</span><span class="plain">, </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]);</span>
        <span class="plain">}</span>
        <span class="functiontext"><a href="2-ss.html#SP5">Scanner::create_volume</a></span><span class="plain">(</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">book_folder</span><span class="plain">, </span><span class="identifier">file</span><span class="plain">, </span><span class="identifier">title</span><span class="plain">, </span><span class="identifier">abbrev</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">file</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">abbrev</span><span class="plain">);</span>
        <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP5_1">&#167;5.1</a>.</p>

<p class="inwebparagraph"><a id="SP5_1_3"></a><b>&#167;5.1.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Act on a CSS tweak</span> <span class="cwebmacronumber">5.1.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">tweak</span><span class="plain"> = </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0];</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr2</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr3</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">tweak</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%C+)text(%C+) = (%C+)"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="2-css.html#SP9">CSS::add_span_notation</a></span><span class="plain">(</span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[2], </span><span class="constant">MARKUP_SPP</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="reserved">volume</span><span class="plain"> *</span><span class="identifier">act_on</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">tweak</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%C+) *: *(%c+)"</span><span class="plain">)) {</span>
                <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">abbrev</span><span class="plain"> = </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0];</span>
                <span class="functiontext"><a href="4-sm.html#SP16">Str::copy</a></span><span class="plain">(</span><span class="identifier">tweak</span><span class="plain">, </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]);</span>
                <span class="reserved">volume</span><span class="plain"> *</span><span class="identifier">V</span><span class="plain">;</span>
                <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">V</span><span class="plain">, </span><span class="reserved">volume</span><span class="plain">)</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">V</span><span class="plain">-&gt;</span><span class="element">vol_abbrev</span><span class="plain">, </span><span class="identifier">abbrev</span><span class="plain">))</span>
                        <span class="identifier">act_on</span><span class="plain"> = </span><span class="identifier">V</span><span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">act_on</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"unknown volume abbreviation"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">tweak</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c+?) *{ *"</span><span class="plain">)) {</span>
                <span class="reserved">int</span><span class="plain"> </span><span class="identifier">plus</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
                <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">tag</span><span class="plain"> = </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0];</span>
                <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">want</span><span class="plain">);</span>
                <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">ncl</span><span class="plain">);</span>
                <span class="reserved">while</span><span class="plain"> ((</span><span class="functiontext"><a href="4-tf.html#SP6">TextFiles::read_line</a></span><span class="plain">(</span><span class="identifier">ncl</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">)), (</span><span class="functiontext"><a href="4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">ncl</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">)) {</span>
                    <span class="functiontext"><a href="4-sm.html#SP23">Str::trim_white_space</a></span><span class="plain">(</span><span class="identifier">ncl</span><span class="plain">);</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr3</span><span class="plain">, </span><span class="identifier">ncl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *} *"</span><span class="plain">)) </span><span class="reserved">break</span><span class="plain">;</span>
                    <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">want</span><span class="plain">, </span><span class="string">"%S\n"</span><span class="plain">, </span><span class="identifier">ncl</span><span class="plain">);</span>
                <span class="plain">}</span>
                <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">ncl</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr3</span><span class="plain">, </span><span class="identifier">tag</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?) *%+%+ *"</span><span class="plain">)) { </span><span class="identifier">plus</span><span class="plain"> = </span><span class="constant">2</span><span class="plain">; </span><span class="identifier">tag</span><span class="plain"> = </span><span class="identifier">mr3</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]; }</span>
                <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr3</span><span class="plain">, </span><span class="identifier">tag</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?) *%+ *"</span><span class="plain">)) { </span><span class="identifier">plus</span><span class="plain"> = </span><span class="constant">1</span><span class="plain">; </span><span class="identifier">tag</span><span class="plain"> = </span><span class="identifier">mr3</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]; }</span>
                <span class="functiontext"><a href="2-css.html#SP4">CSS::request_css_tweak</a></span><span class="plain">(</span><span class="identifier">act_on</span><span class="plain">, </span><span class="identifier">tag</span><span class="plain">, </span><span class="identifier">want</span><span class="plain">, </span><span class="identifier">plus</span><span class="plain">);</span>
                <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">want</span><span class="plain">);</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"bad CSS tweaking syntax"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">);</span>
        <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr3</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP5_1">&#167;5.1</a>.</p>

<p class="inwebparagraph"><a id="SP5_1_4"></a><b>&#167;5.1.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Act on an indexing notation</span> <span class="cwebmacronumber">5.1.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">tweak</span><span class="plain"> = </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0];</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr2</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">test_index_mode</span><span class="plain">) </span><span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Read in: %S\n"</span><span class="plain">, </span><span class="identifier">tweak</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">tweak</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"^{(%C*)headword(%C*)} = (%C+) *(%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="3-gi.html#SP1">Indexes::add_indexing_notation</a></span><span class="plain">(</span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[2], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[3]);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">tweak</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"{(%C+?)} = (%C+) *(%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="3-gi.html#SP1">Indexes::add_indexing_notation_for_symbols</a></span><span class="plain">(</span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[2]);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">tweak</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"definition = (%C+) *(%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="3-gi.html#SP1">Indexes::add_indexing_notation_for_definitions</a></span><span class="plain">(</span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1], </span><span class="identifier">NULL</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">tweak</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%C+)-definition = (%C+) *(%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="3-gi.html#SP1">Indexes::add_indexing_notation_for_definitions</a></span><span class="plain">(</span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[2], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0]);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">tweak</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"example = (%C+) *(%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="3-gi.html#SP1">Indexes::add_indexing_notation_for_examples</a></span><span class="plain">(</span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0], </span><span class="identifier">mr2</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1]);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"bad indexing notation"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP5_1">&#167;5.1</a>.</p>

<p class="inwebparagraph"><a id="SP5_1_5"></a><b>&#167;5.1.5.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Act on an instructions setting</span> <span class="cwebmacronumber">5.1.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">key</span><span class="plain"> = </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[0];</span>
        <span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">val</span><span class="plain"> = </span><span class="identifier">mr</span><span class="plain">.</span><span class="element">exp</span><span class="plain">[1];</span>
        &lt;<span class="cwebmacro">Deal with braced write values</span> <span class="cwebmacronumber">5.1.5.1</span>&gt;<span class="plain">;</span>
        &lt;<span class="cwebmacro">Set an instructions option</span> <span class="cwebmacronumber">5.1.5.2</span>&gt;<span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP5_1">&#167;5.1</a>.</p>

<p class="inwebparagraph"><a id="SP5_1_5_1"></a><b>&#167;5.1.5.1.  </b>The write value can span multiple lines if the first line consists only
of <code class="display"><span class="extract">{</span></code> and the last only of <code class="display"><span class="extract">}</span></code> (plus leading or trailing white space to
taste). In a multiple-line value, each line is terminated with a newline.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Deal with braced write values</span> <span class="cwebmacronumber">5.1.5.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP18">Str::eq</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"{"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="4-sm.html#SP15">Str::clear</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">);</span>
            <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr2</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">ncl</span><span class="plain">);</span>
            <span class="reserved">while</span><span class="plain"> ((</span><span class="functiontext"><a href="4-tf.html#SP6">TextFiles::read_line</a></span><span class="plain">(</span><span class="identifier">ncl</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">)), (</span><span class="functiontext"><a href="4-sm.html#SP8">Str::len</a></span><span class="plain">(</span><span class="identifier">ncl</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">)) {</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">, </span><span class="identifier">ncl</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" *} *"</span><span class="plain">)) </span><span class="reserved">break</span><span class="plain">;</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="string">"%S\n"</span><span class="plain">, </span><span class="identifier">ncl</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">ncl</span><span class="plain">);</span>
            <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr2</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP5_1_5">&#167;5.1.5</a>.</p>

<p class="inwebparagraph"><a id="SP5_1_5_2"></a><b>&#167;5.1.5.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Set an instructions option</span> <span class="cwebmacronumber">5.1.5.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"alphabetization"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"word-by-word"</span><span class="plain">))</span>
                <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">index_alphabetisation_algorithm</span><span class="plain"> = </span><span class="constant">WORD_ALPHABETIZATION</span><span class="plain">;</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"letter-by-letter"</span><span class="plain">))</span>
                <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">index_alphabetisation_algorithm</span><span class="plain"> = </span><span class="constant">LETTER_ALPHABETIZATION</span><span class="plain">;</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"no such alphabetization"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"assume_Public_Library"</span><span class="plain">))</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">assume_Public_Library</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"change_logs_directory"</span><span class="plain">))</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">change_logs_folder</span><span class="plain"> = </span><span class="functiontext"><a href="#SP6">Instructions::set_path</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">settings</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"contents_leafname"</span><span class="plain">))</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">contents_leafname</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"contents_expandable"</span><span class="plain">))</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">contents_expandable</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"css_source_file"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">css_source_file</span><span class="plain"> = </span><span class="functiontext"><a href="#SP7">Instructions::set_file</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">settings</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"definitions_filename"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">definitions_filename</span><span class="plain"> = </span><span class="functiontext"><a href="#SP7">Instructions::set_file</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">settings</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"definitions_index_filename"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">definitions_index_leafname</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"destination"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">destination_modifiable</span><span class="plain">)</span>
                <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">destination</span><span class="plain"> = </span><span class="functiontext"><a href="#SP6">Instructions::set_path</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">settings</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"examples_directory"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_directory</span><span class="plain"> = </span><span class="functiontext"><a href="#SP6">Instructions::set_path</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">settings</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"examples_alphabetical_leafname"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_alphabetical_leafname</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"examples_granularity"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_granularity</span><span class="plain"> = </span><span class="functiontext"><a href="#SP8">Instructions::set_range</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="constant">1</span><span class="plain">, </span><span class="constant">3</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"examples_mode"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"open"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">examples_mode</span><span class="plain"> = </span><span class="constant">EXMODE_open_internal</span><span class="plain">; }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"openable"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">examples_mode</span><span class="plain"> = </span><span class="constant">EXMODE_openable_internal</span><span class="plain">; }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"no such examples mode"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"examples_numerical_leafname"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_numerical_leafname</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"examples_thematic_leafname"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_thematic_leafname</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"format"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"HTML"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">format</span><span class="plain"> = </span><span class="constant">HTML_FORMAT</span><span class="plain">; }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"text"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">format</span><span class="plain"> = </span><span class="constant">PLAIN_FORMAT</span><span class="plain">; }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"no such format"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"granularity"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">granularity</span><span class="plain"> = </span><span class="functiontext"><a href="#SP8">Instructions::set_range</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="constant">1</span><span class="plain">, </span><span class="constant">3</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"html_for_Inform_application"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">html_for_Inform_application</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"images_path"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">images_path</span><span class="plain"> = </span><span class="functiontext"><a href="#SP6">Instructions::set_path</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">settings</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"images_copy"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">images_copy</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"inform_definitions_mode"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">inform_definitions_mode</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"javascript"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">javascript</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"javascript_paste_method"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"none"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">javascript_paste_method</span><span class="plain"> = </span><span class="constant">PASTEMODE_none</span><span class="plain">; }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"Andrew"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">javascript_paste_method</span><span class="plain"> = </span><span class="constant">PASTEMODE_Andrew</span><span class="plain">; }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"David"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">javascript_paste_method</span><span class="plain"> = </span><span class="constant">PASTEMODE_David</span><span class="plain">; }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"no such Javascript paste mode"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"link_to_extensions_index"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">link_to_extensions_index</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"manifest_leafname"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">manifest_leafname</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"navigation"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">navigation</span><span class="plain"> = </span><span class="functiontext"><a href="4-nd.html#SP1">Nav::parse</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">navigation</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"no such navigation mode"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"retina_images"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">retina_images</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"support_creation"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">support_creation</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"suppress_fonts"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">suppress_fonts</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"toc_granularity"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">toc_granularity</span><span class="plain"> = </span><span class="functiontext"><a href="#SP8">Instructions::set_range</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="constant">1</span><span class="plain">, </span><span class="constant">3</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"top_and_tail_sections"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">top_and_tail_sections</span><span class="plain"> = </span><span class="functiontext"><a href="#SP7">Instructions::set_file</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">settings</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"top_and_tail"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">top_and_tail</span><span class="plain"> = </span><span class="functiontext"><a href="#SP7">Instructions::set_file</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">settings</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"treat_code_as_verbatim"</span><span class="plain">)) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">treat_code_as_verbatim</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"wrapper"</span><span class="plain">)) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"EPUB"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">wrapper</span><span class="plain"> = </span><span class="constant">WRAPPER_epub</span><span class="plain">; }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"zip"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">wrapper</span><span class="plain"> = </span><span class="constant">WRAPPER_zip</span><span class="plain">; }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"none"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">wrapper</span><span class="plain"> = </span><span class="constant">WRAPPER_none</span><span class="plain">; }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"no such wrapper"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"XHTML"</span><span class="plain">)) { </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">XHTML</span><span class="plain"> = </span><span class="functiontext"><a href="#SP9">Instructions::set_yn</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">); }</span>

        <span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file</a></span><span class="plain">(</span><span class="string">"no such setting"</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP5_1_5">&#167;5.1.5</a>.</p>

<p class="inwebparagraph"><a id="SP3_1"></a><b>&#167;3.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Reconcile any conflicting instructions</span> <span class="cwebmacronumber">3.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">wrapper</span><span class="plain"> == </span><span class="constant">WRAPPER_epub</span><span class="plain">) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">javascript</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">javascript_paste_method</span><span class="plain"> = </span><span class="constant">PASTEMODE_none</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">examples_mode</span><span class="plain"> == </span><span class="constant">EXMODE_openable_internal</span><span class="plain">) {</span>
                <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_mode</span><span class="plain"> = </span><span class="constant">EXMODE_open_internal</span><span class="plain">;</span>
            <span class="plain">}</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">contents_expandable</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">images_copy</span><span class="plain"> = </span><span class="constant">1</span><span class="plain">;</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">navigation</span><span class="plain"> = </span><span class="functiontext"><a href="4-nd.html#SP1">Nav::for_ebook</a></span><span class="plain">(</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">navigation</span><span class="plain">);</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">format</span><span class="plain"> = </span><span class="constant">HTML_FORMAT</span><span class="plain">;</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">XHTML</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="reserved">ebook</span><span class="plain"> = </span><span class="functiontext"><a href="5-ee.html#SP5">Epub::new</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"untitled ebook"</span><span class="plain">, </span><span class="string">""</span><span class="plain">);</span>
        <span class="plain">}</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">javascript_paste_method</span><span class="plain"> != </span><span class="constant">PASTEMODE_none</span><span class="plain">)</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">javascript</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">examples_granularity</span><span class="plain"> == </span><span class="constant">SAME_AS_MAIN_GRANULARITY</span><span class="plain">)</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_granularity</span><span class="plain"> = </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">granularity</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">toc_granularity</span><span class="plain"> == </span><span class="constant">SAME_AS_MAIN_GRANULARITY</span><span class="plain">)</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">toc_granularity</span><span class="plain"> = </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">granularity</span><span class="plain">;</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">examples_granularity</span><span class="plain"> &lt; </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">granularity</span><span class="plain">) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">examples_granularity</span><span class="plain"> = </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">granularity</span><span class="plain">;</span>
            <span class="functiontext"><a href="3-em.html#SP5">Errors::nowhere</a></span><span class="plain">(</span><span class="string">"examples granularity can't be less than granularity"</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">toc_granularity</span><span class="plain"> &lt; </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">granularity</span><span class="plain">) {</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">toc_granularity</span><span class="plain"> = </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">granularity</span><span class="plain">;</span>
            <span class="functiontext"><a href="3-em.html#SP5">Errors::nowhere</a></span><span class="plain">(</span><span class="string">"TOC granularity can't be less than granularity"</span><span class="plain">);</span>
        <span class="plain">}</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">format</span><span class="plain"> == </span><span class="constant">PLAIN_FORMAT</span><span class="plain">)</span>
            <span class="identifier">settings</span><span class="plain">-&gt;</span><span class="identifier">navigation</span><span class="plain"> = </span><span class="functiontext"><a href="4-nd.html#SP1">Nav::for_plain_text</a></span><span class="plain">(</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">navigation</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP3">&#167;3</a>.</p>

<p class="inwebparagraph"><a id="SP3_2"></a><b>&#167;3.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Declare the format and wrapper as symbols</span> <span class="cwebmacronumber">3.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">wrapper</span><span class="plain"> == </span><span class="constant">WRAPPER_epub</span><span class="plain">) </span><span class="functiontext"><a href="1-cs.html#SP3">Symbols::declare_symbol</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"EPUB"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">wrapper</span><span class="plain"> == </span><span class="constant">WRAPPER_zip</span><span class="plain">) </span><span class="functiontext"><a href="1-cs.html#SP3">Symbols::declare_symbol</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"zip"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="1-cs.html#SP3">Symbols::declare_symbol</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"unwrapped"</span><span class="plain">);</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">format</span><span class="plain"> == </span><span class="constant">HTML_FORMAT</span><span class="plain">) </span><span class="functiontext"><a href="1-cs.html#SP3">Symbols::declare_symbol</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"HTML"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">format</span><span class="plain"> == </span><span class="constant">PLAIN_FORMAT</span><span class="plain">) </span><span class="functiontext"><a href="1-cs.html#SP3">Symbols::declare_symbol</a></span><span class="plain">(</span><span class="identifier">I</span><span class="string">"text"</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP3">&#167;3</a>.</p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6. Parsing values. </b>Note the Unix-style conveniences for pathnames: an initial <code class="display"><span class="extract">~</span></code> means the
home folder, <code class="display"><span class="extract">~~</span></code> means the book folder.
</p>

<pre class="display">
    <span class="reserved">pathname</span><span class="plain"> *</span><span class="functiontext">Instructions::set_path<button class="popup" onclick="togglePopup('usagePopup11')">...<span class="popuptext" id="usagePopup11">Usage of <b>Instructions::set_path</b>:<br><a href="#SP5_1">&#167;5.1</a>, <a href="#SP5_1_5_2">&#167;5.1.5.2</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">val</span><span class="plain">, </span><span class="reserved">settings_block</span><span class="plain"> *</span><span class="identifier">settings</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">0</span><span class="plain">) == </span><span class="character">'~'</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">1</span><span class="plain">) == </span><span class="character">'~'</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">2</span><span class="plain">) == </span><span class="character">'/'</span><span class="plain">) || (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">2</span><span class="plain">) == </span><span class="constant">FOLDER_SEPARATOR</span><span class="plain">)) {</span>
                    <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">t</span><span class="plain">);</span>
                    <span class="functiontext"><a href="4-sm.html#SP16">Str::copy_tail</a></span><span class="plain">(</span><span class="identifier">t</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="constant">3</span><span class="plain">);</span>
                    <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> = </span><span class="functiontext"><a href="3-pth.html#SP5">Pathnames::from_text_relative</a></span><span class="plain">(</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">book_folder</span><span class="plain">, </span><span class="identifier">t</span><span class="plain">);</span>
                    <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">t</span><span class="plain">);</span>
                    <span class="reserved">return</span><span class="plain"> </span><span class="identifier">P</span><span class="plain">;</span>
                <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">2</span><span class="plain">) == </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">book_folder</span><span class="plain">;</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">1</span><span class="plain">) == </span><span class="character">'/'</span><span class="plain">) || (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">1</span><span class="plain">) == </span><span class="constant">FOLDER_SEPARATOR</span><span class="plain">)) {</span>
                <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">t</span><span class="plain">);</span>
                <span class="functiontext"><a href="4-sm.html#SP16">Str::copy_tail</a></span><span class="plain">(</span><span class="identifier">t</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="constant">2</span><span class="plain">);</span>
                <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> = </span><span class="functiontext"><a href="3-pth.html#SP5">Pathnames::from_text_relative</a></span><span class="plain">(</span><span class="identifier">home_path</span><span class="plain">, </span><span class="identifier">t</span><span class="plain">);</span>
                <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">t</span><span class="plain">);</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="identifier">P</span><span class="plain">;</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">1</span><span class="plain">) == </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">home_path</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="functiontext"><a href="3-pth.html#SP5">Pathnames::from_text</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7.  </b></p>

<pre class="display">
    <span class="reserved">filename</span><span class="plain"> *</span><span class="functiontext">Instructions::set_file<button class="popup" onclick="togglePopup('usagePopup12')">...<span class="popuptext" id="usagePopup12">Usage of <b>Instructions::set_file</b>:<br><a href="#SP5_1">&#167;5.1</a>, <a href="#SP5_1_5_2">&#167;5.1.5.2</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">val</span><span class="plain">, </span><span class="reserved">settings_block</span><span class="plain"> *</span><span class="identifier">settings</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">0</span><span class="plain">) == </span><span class="character">'~'</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">1</span><span class="plain">) == </span><span class="character">'~'</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">2</span><span class="plain">) == </span><span class="character">'/'</span><span class="plain">) || (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">2</span><span class="plain">) == </span><span class="constant">FOLDER_SEPARATOR</span><span class="plain">)) {</span>
                    <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">t</span><span class="plain">);</span>
                    <span class="functiontext"><a href="4-sm.html#SP16">Str::copy_tail</a></span><span class="plain">(</span><span class="identifier">t</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="constant">3</span><span class="plain">);</span>
                    <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP3">Filenames::from_text_relative</a></span><span class="plain">(</span><span class="identifier">settings</span><span class="plain">-&gt;</span><span class="element">book_folder</span><span class="plain">, </span><span class="identifier">t</span><span class="plain">);</span>
                    <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">t</span><span class="plain">);</span>
                    <span class="reserved">return</span><span class="plain"> </span><span class="identifier">F</span><span class="plain">;</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">1</span><span class="plain">) == </span><span class="character">'/'</span><span class="plain">) || (</span><span class="functiontext"><a href="4-sm.html#SP13">Str::get_at</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">1</span><span class="plain">) == </span><span class="constant">FOLDER_SEPARATOR</span><span class="plain">)) {</span>
                <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">t</span><span class="plain">);</span>
                <span class="functiontext"><a href="4-sm.html#SP16">Str::copy_tail</a></span><span class="plain">(</span><span class="identifier">t</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="constant">2</span><span class="plain">);</span>
                <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="functiontext"><a href="3-fln.html#SP3">Filenames::from_text_relative</a></span><span class="plain">(</span><span class="identifier">home_path</span><span class="plain">, </span><span class="identifier">t</span><span class="plain">);</span>
                <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">t</span><span class="plain">);</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="identifier">F</span><span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="functiontext"><a href="3-fln.html#SP3">Filenames::from_text</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP8"></a><b>&#167;8.  </b>An integer value within or at the edges of the given range.
</p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Instructions::set_range<button class="popup" onclick="togglePopup('usagePopup13')">...<span class="popuptext" id="usagePopup13">Usage of <b>Instructions::set_range</b>:<br><a href="#SP5_1_5_2">&#167;5.1.5.2</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">key</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">val</span><span class="plain">,</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">min</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">max</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">) {</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext"><a href="4-pm.html#SP9">Regexp::create_mr</a></span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-pm.html#SP10">Regexp::match</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"%d+"</span><span class="plain">)) {</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">v</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP7">Str::atoi</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>
            <span class="functiontext"><a href="4-pm.html#SP9">Regexp::dispose_of</a></span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">v</span><span class="plain"> &gt;= </span><span class="identifier">min</span><span class="plain">) &amp;&amp; (</span><span class="identifier">v</span><span class="plain"> &lt;= </span><span class="identifier">max</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">v</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">ERM</span><span class="plain">);</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">ERM</span><span class="plain">, </span><span class="string">"'%S' must a number from %d to %d, not '%S'"</span><span class="plain">, </span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">min</span><span class="plain">, </span><span class="identifier">max</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">);</span>
        <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file_S</a></span><span class="plain">(</span><span class="identifier">ERM</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">ERM</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">min</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP9"></a><b>&#167;9.  </b>A yes-no answer.
</p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Instructions::set_yn<button class="popup" onclick="togglePopup('usagePopup14')">...<span class="popuptext" id="usagePopup14">Usage of <b>Instructions::set_yn</b>:<br><a href="#SP5_1_5_2">&#167;5.1.5.2</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">key</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">val</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"yes"</span><span class="plain">)) { </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">1</span><span class="plain">; }</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext"><a href="4-sm.html#SP21">Str::eq_wide_string</a></span><span class="plain">(</span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"no"</span><span class="plain">)) { </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">0</span><span class="plain">; }</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">ERM</span><span class="plain">);</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">ERM</span><span class="plain">, </span><span class="string">"'%S' must be 'yes' or 'no', not '%S'"</span><span class="plain">, </span><span class="identifier">key</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">);</span>
        <span class="functiontext"><a href="3-em.html#SP5">Errors::in_text_file_S</a></span><span class="plain">(</span><span class="identifier">ERM</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">ERM</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="constant">0</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP10"></a><b>&#167;10.  </b>For ebooks only.
</p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">dc_metadatum</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">dc_key</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">dc_val</span><span class="plain">;</span>
        <span class="constant">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">dc_metadatum</span><span class="plain">;</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Instructions::create_ebook_metadata<button class="popup" onclick="togglePopup('usagePopup15')">...<span class="popuptext" id="usagePopup15">Usage of <b>Instructions::create_ebook_metadata</b>:<br><a href="#SP5_1">&#167;5.1</a></span></button></span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">key</span><span class="plain">, </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">value</span><span class="plain">) {</span>
        <span class="reserved">dc_metadatum</span><span class="plain"> *</span><span class="identifier">dcm</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">dc_metadatum</span><span class="plain">);</span>
        <span class="identifier">dcm</span><span class="plain">-&gt;</span><span class="element">dc_key</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">key</span><span class="plain">);</span>
        <span class="identifier">dcm</span><span class="plain">-&gt;</span><span class="element">dc_val</span><span class="plain"> = </span><span class="functiontext"><a href="4-sm.html#SP3">Str::duplicate</a></span><span class="plain">(</span><span class="identifier">value</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Instructions::apply_ebook_metadata<button class="popup" onclick="togglePopup('usagePopup16')">...<span class="popuptext" id="usagePopup16">Usage of <b>Instructions::apply_ebook_metadata</b>:<br>Main - <a href="1-mn.html#SP1_1">&#167;1.1</a></span></button></span><span class="plain">(</span><span class="reserved">ebook</span><span class="plain"> *</span><span class="identifier">E</span><span class="plain">) {</span>
        <span class="reserved">dc_metadatum</span><span class="plain"> *</span><span class="identifier">dcm</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">dcm</span><span class="plain">, </span><span class="reserved">dc_metadatum</span><span class="plain">) {</span>
            <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">K</span><span class="plain">[1024];</span>
            <span class="functiontext"><a href="4-sm.html#SP6">Str::copy_to_wide_string</a></span><span class="plain">(</span><span class="identifier">K</span><span class="plain">, </span><span class="identifier">dcm</span><span class="plain">-&gt;</span><span class="identifier">dc_key</span><span class="plain">, </span><span class="constant">1024</span><span class="plain">);</span>
            <span class="functiontext"><a href="5-ee.html#SP5">Epub::attach_metadata</a></span><span class="plain">(</span><span class="identifier">E</span><span class="plain">, </span><span class="identifier">K</span><span class="plain">, </span><span class="identifier">dcm</span><span class="plain">-&gt;</span><span class="identifier">dc_val</span><span class="plain">);</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure dc_metadatum is private to this section.</p>

<hr class="tocbar">
<ul class="toc"><li><a href="1-cnf.html">Back to 'Configuration'</a></li><li><a href="1-cs.html">Continue with 'Context Symbols'</a></li></ul><hr class="tocbar">
<!--End of weave-->
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
		</main>
	</body>
</html>

