<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Inter Namespace</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-src/Figures/Inform.png" height=72">
</a></h1>
<ul><li><a href="../compiler.html">compiler tools</a></li>
<li><a href="../other.html">other tools</a></li>
<li><a href="../extensions.html">extensions and kits</a></li>
<li><a href="../units.html">unit test tools</a></li>
</ul><h2>Compiler Webs</h2><ul>
<li><a href="../inbuild/index.html">inbuild</a></li>
<li><a href="../inform7/index.html">inform7</a></li>
<li><a href="../inter/index.html">inter</a></li>
</ul><h2>Inbuild Modules</h2><ul>
<li><a href="../supervisor-module/index.html">supervisor</a></li>
</ul><h2>Inform7 Modules</h2><ul>
<li><a href="../core-module/index.html">core</a></li>
<li><a href="../inflections-module/index.html">inflections</a></li>
<li><a href="../linguistics-module/index.html">linguistics</a></li>
<li><a href="../kinds-module/index.html">kinds</a></li>
<li><a href="../if-module/index.html">if</a></li>
<li><a href="../multimedia-module/index.html">multimedia</a></li>
<li><a href="../problems-module/index.html">problems</a></li>
<li><a href="../index-module/index.html">index</a></li>
</ul><h2>Inter Modules</h2><ul>
<li><a href="../bytecode-module/index.html">bytecode</a></li>
<li><a href="index.html"><span class="selectedlink">building</span></a></li>
<li><a href="../codegen-module/index.html">codegen</a></li>
</ul><h2>Shared Modules</h2><ul>
<li><a href="../arch-module/index.html">arch</a></li>
<li><a href="../syntax-module/index.html">syntax</a></li>
<li><a href="../words-module/index.html">words</a></li>
<li><a href="../html-module/index.html">html</a></li>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>

</ul>
		</nav>
		<main role="main">
		
<!--Weave of 'Inter Namespace' generated by 7-->
<ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="../compiler.html">Inter Modules</a></li><li><a href="index.html">building</a></li><li><a href="index.html#1">Chapter 1: Architecture</a></li><li><b>Inter Namespace</b></li></ul><p class="purpose">To manage identifiers, which have names and positions in the Inter hierarchy.</p>

<ul class="toc"><li><a href="1-in.html#SP1">&#167;1. Families</a></li><li><a href="1-in.html#SP2">&#167;2. Printing inames</a></li><li><a href="1-in.html#SP4">&#167;4. Making new inames</a></li><li><a href="1-in.html#SP8">&#167;8. Conversion of inames to symbols</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Families. </b>Each inter name comes from a "generator". Some are one-shot, and produce just
one name before being discarded; others produce a numbered sequence of names
in a given pattern, counting upwards from 1 (<code class="display"><span class="extract">example_1</span></code>, <code class="display"><span class="extract">example_2</span></code>, ...);
and others still derive new names from existing ones (for example, turning
<code class="display"><span class="extract">fish</span></code> and <code class="display"><span class="extract">rumour</span></code> into <code class="display"><span class="extract">fishmonger</span></code> and <code class="display"><span class="extract">rumourmonger</span></code>).
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">UNIQUE_INGEN</span><span class="definitionkeyword"> from </span><span class="constant">1</span>
    <span class="definitionkeyword">enum</span> <span class="constant">MULTIPLE_INGEN</span>
    <span class="definitionkeyword">enum</span> <span class="constant">DERIVED_INGEN</span>
</pre>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">inter_name_generator</span><span class="plain"> {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">ingen</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">name_stem</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">no_generated</span><span class="plain">; </span><span class="comment"> relevamt only for <code class="display"><span class="extract">MULTIPLE_INGEN</span></code></span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">derived_prefix</span><span class="plain">; </span><span class="comment"> relevamt only for <code class="display"><span class="extract">DERIVED_INGEN</span></code></span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">derived_suffix</span><span class="plain">; </span><span class="comment"> relevamt only for <code class="display"><span class="extract">DERIVED_INGEN</span></code></span>
    <span class="plain">} </span><span class="reserved">inter_name_generator</span><span class="plain">;</span>

    <span class="reserved">inter_name_generator</span><span class="plain"> *</span><span class="functiontext">InterNames::single_use_generator<button class="popup" onclick="togglePopup('usagePopup117')">...<span class="popuptext" id="usagePopup117">Usage of <b>InterNames::single_use_generator</b>:<br><a href="1-in.html#SP5">&#167;5</a></span></button></span><span class="plain">(</span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">) {</span>
        <span class="reserved">inter_name_generator</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">inter_name_generator</span><span class="plain">);</span>
        <span class="identifier">F</span><span class="plain">-&gt;</span><span class="element">ingen</span><span class="plain"> = </span><span class="constant">UNIQUE_INGEN</span><span class="plain">;</span>
        <span class="identifier">F</span><span class="plain">-&gt;</span><span class="element">name_stem</span><span class="plain"> = </span><span class="identifier">Str::duplicate</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">);</span>
        <span class="identifier">F</span><span class="plain">-&gt;</span><span class="element">derived_prefix</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">F</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">inter_name_generator</span><span class="plain"> *</span><span class="functiontext">InterNames::multiple_use_generator<button class="popup" onclick="togglePopup('usagePopup118')">...<span class="popuptext" id="usagePopup118">Usage of <b>InterNames::multiple_use_generator</b>:<br>Translation - <a href="1-trn.html#SP1">&#167;1</a><br>Packaging - <a href="1-pck.html#SP4">&#167;4</a></span></button></span><span class="plain">(</span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">prefix</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">stem</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">suffix</span><span class="plain">) {</span>
        <span class="reserved">inter_name_generator</span><span class="plain"> *</span><span class="identifier">gen</span><span class="plain"> = </span><span class="functiontext"><a href="1-in.html#SP1">InterNames::single_use_generator</a></span><span class="plain">(</span><span class="identifier">stem</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">prefix</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="identifier">gen</span><span class="plain">-&gt;</span><span class="element">ingen</span><span class="plain"> = </span><span class="constant">DERIVED_INGEN</span><span class="plain">;</span>
            <span class="identifier">gen</span><span class="plain">-&gt;</span><span class="element">derived_prefix</span><span class="plain"> = </span><span class="identifier">Str::duplicate</span><span class="plain">(</span><span class="identifier">prefix</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">suffix</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="identifier">gen</span><span class="plain">-&gt;</span><span class="element">ingen</span><span class="plain"> = </span><span class="constant">DERIVED_INGEN</span><span class="plain">;</span>
            <span class="identifier">gen</span><span class="plain">-&gt;</span><span class="element">derived_suffix</span><span class="plain"> = </span><span class="identifier">Str::duplicate</span><span class="plain">(</span><span class="identifier">suffix</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="identifier">gen</span><span class="plain">-&gt;</span><span class="element">ingen</span><span class="plain"> = </span><span class="constant">MULTIPLE_INGEN</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">gen</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure inter_name_generator is accessed in 1/hl, 1/pck and here.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2. Printing inames. </b>Inter names are stored not in textual form, but in terms of what would be
required to generate that text. (The memo field, which in principle allows
any text to be stored, is used only for a small proportion of inames.)
</p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">inter_name</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">inter_name_generator</span><span class="plain"> *</span><span class="identifier">generated_by</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">unique_number</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">inter_symbol</span><span class="plain"> *</span><span class="identifier">symbol</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">package_request</span><span class="plain"> *</span><span class="identifier">location_in_hierarchy</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">memo</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">derived_from</span><span class="plain">;</span>
    <span class="plain">} </span><span class="reserved">inter_name</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure inter_name is accessed in 3/prd and here.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>This implements the <code class="display"><span class="extract">%n</span></code> escape, which prints an iname:
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">InterNames::writer<button class="popup" onclick="togglePopup('usagePopup119')">...<span class="popuptext" id="usagePopup119">Usage of <b>InterNames::writer</b>:<br>Building Module - <a href="1-bm.html#SP4_2">&#167;4.2</a></span></button></span><span class="plain">(</span><span class="identifier">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">char</span><span class="plain"> *</span><span class="identifier">format_string</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">vI</span><span class="plain">) {</span>
        <span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = (</span><span class="reserved">inter_name</span><span class="plain"> *) </span><span class="identifier">vI</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">iname</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&lt;no-inter-name&gt;"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="identifier">generated_by</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"bad inter_name"</span><span class="plain">);</span>
            <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">generated_by</span><span class="plain">-&gt;</span><span class="element">ingen</span><span class="plain">) {</span>
                <span class="reserved">case</span><span class="plain"> </span><span class="identifier">DERIVED_INGEN:</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">generated_by</span><span class="plain">-&gt;</span><span class="identifier">derived_prefix</span><span class="plain">);</span>
                    <span class="functiontext"><a href="1-in.html#SP3">InterNames::writer</a></span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">format_string</span><span class="plain">, </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">derived_from</span><span class="plain">);</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">generated_by</span><span class="plain">-&gt;</span><span class="identifier">derived_suffix</span><span class="plain">);</span>
                    <span class="reserved">break</span><span class="plain">;</span>
                <span class="reserved">case</span><span class="plain"> </span><span class="identifier">UNIQUE_INGEN:</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">generated_by</span><span class="plain">-&gt;</span><span class="identifier">name_stem</span><span class="plain">);</span>
                    <span class="reserved">break</span><span class="plain">;</span>
                <span class="reserved">case</span><span class="plain"> </span><span class="identifier">MULTIPLE_INGEN:</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">generated_by</span><span class="plain">-&gt;</span><span class="identifier">name_stem</span><span class="plain">);</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="identifier">unique_number</span><span class="plain"> &gt;= </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%d"</span><span class="plain">, </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">unique_number</span><span class="plain">);</span>
                    <span class="reserved">break</span><span class="plain">;</span>
                <span class="identifier">default:</span><span class="plain"> </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"unknown ingen"</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"_%S"</span><span class="plain">, </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain">);</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4. Making new inames. </b>We can now make a new iname, which is easy unless there's a memo to attach.
For example, attaching the wording "printing the name of a dark room" to
an iname which would otherwise just be <code class="display"><span class="extract">V12</span></code> produces <code class="display"><span class="extract">V12_printing_the_name_of_a_da</span></code>.
Memos exist largely to make the Inter code easier for human eyes to read,
as in this case, but sometimes, as with kind names like <code class="display"><span class="extract">K2_thing</span></code>, they're
needed because template or explicit I6 inclusion code makes references to them.
</p>

<p class="inwebparagraph">Although most inter names are eventually used to create symbols in the
Inter hierarchy's symbols table, this does not happen immediately, and
for some inames it never will.
</p>

<pre class="display">
    <span class="reserved">inter_name</span><span class="plain"> *</span><span class="functiontext">InterNames::new<button class="popup" onclick="togglePopup('usagePopup120')">...<span class="popuptext" id="usagePopup120">Usage of <b>InterNames::new</b>:<br><a href="1-in.html#SP5">&#167;5</a>, <a href="1-in.html#SP6">&#167;6</a></span></button></span><span class="plain">(</span><span class="reserved">inter_name_generator</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain">, </span><span class="reserved">package_request</span><span class="plain"> *</span><span class="identifier">R</span><span class="plain">, </span><span class="identifier">wording</span><span class="plain"> </span><span class="identifier">W</span><span class="plain">) {</span>
        <span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">inter_name</span><span class="plain">);</span>
        <span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">generated_by</span><span class="plain"> = </span><span class="identifier">F</span><span class="plain">;</span>
        <span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">unique_number</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">symbol</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">derived_from</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">location_in_hierarchy</span><span class="plain"> = </span><span class="identifier">R</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Wordings::empty</span><span class="plain">(</span><span class="identifier">W</span><span class="plain">)) {</span>
            <span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain"> = </span><span class="identifier">Str::new</span><span class="plain">();</span>
            &lt;<span class="cwebmacro">Fill the memo with up to 28 characters of text from the given wording</span> <span class="cwebmacronumber">4.1</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Ensure that the name, as now extended by the memo, is a legal Inter identifier</span> <span class="cwebmacronumber">4.2</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP4_1"></a><b>&#167;4.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Fill the memo with up to 28 characters of text from the given wording</span> <span class="cwebmacronumber">4.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="identifier">LOOP_THROUGH_WORDING</span><span class="plain">(</span><span class="identifier">j</span><span class="plain">, </span><span class="identifier">W</span><span class="plain">) {</span>
            <span class="comment"> identifier is at this point 32 chars or fewer in length: add at most 30 more</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain">++ &gt; </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain">, </span><span class="string">" "</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Wide::len</span><span class="plain">(</span><span class="identifier">Lexer::word_text</span><span class="plain">(</span><span class="identifier">j</span><span class="plain">)) &gt; </span><span class="constant">30</span><span class="plain">)</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain">, </span><span class="string">"etc"</span><span class="plain">);</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain">, </span><span class="string">"%N"</span><span class="plain">, </span><span class="identifier">j</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain">) &gt; </span><span class="constant">32</span><span class="plain">) </span><span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">Str::truncate</span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain">, </span><span class="constant">28</span><span class="plain">); </span><span class="comment"> it was at worst 62 chars in size, but is now truncated to 28</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="1-in.html#SP4">&#167;4</a>.</p>

<p class="inwebparagraph"><a id="SP4_2"></a><b>&#167;4.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Ensure that the name, as now extended by the memo, is a legal Inter identifier</span> <span class="cwebmacronumber">4.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">Identifiers::purify</span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain">);</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">NBUFF</span><span class="plain">);</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">NBUFF</span><span class="plain">, </span><span class="string">"%n"</span><span class="plain">, </span><span class="identifier">iname</span><span class="plain">);</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">L</span><span class="plain"> = </span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">NBUFF</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">NBUFF</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">L</span><span class="plain"> &gt; </span><span class="constant">28</span><span class="plain">) </span><span class="identifier">Str::truncate</span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="identifier">memo</span><span class="plain">, </span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">memo</span><span class="plain">) - (</span><span class="identifier">L</span><span class="plain"> - </span><span class="constant">28</span><span class="plain">));</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="1-in.html#SP4">&#167;4</a>.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5.  </b>That creation function should be called only by these, which in turn must
be called only from within the current chapter. First, the single-shot cases,
where the caller wants a single name with fixed wording (but possibly with
a memo to attach):
</p>

<pre class="display">
    <span class="reserved">inter_name</span><span class="plain"> *</span><span class="functiontext">InterNames::explicitly_named_with_memo<button class="popup" onclick="togglePopup('usagePopup121')">...<span class="popuptext" id="usagePopup121">Usage of <b>InterNames::explicitly_named_with_memo</b>:<br>Hierarchy Locations - <a href="1-hl.html#SP3_1">&#167;3.1</a></span></button></span><span class="plain">(</span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">, </span><span class="reserved">package_request</span><span class="plain"> *</span><span class="identifier">R</span><span class="plain">, </span><span class="identifier">wording</span><span class="plain"> </span><span class="identifier">W</span><span class="plain">) {</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="functiontext"><a href="1-in.html#SP4">InterNames::new</a></span><span class="plain">(</span><span class="functiontext"><a href="1-in.html#SP1">InterNames::single_use_generator</a></span><span class="plain">(</span><span class="identifier">name</span><span class="plain">), </span><span class="identifier">R</span><span class="plain">, </span><span class="identifier">W</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">inter_name</span><span class="plain"> *</span><span class="functiontext">InterNames::explicitly_named<button class="popup" onclick="togglePopup('usagePopup122')">...<span class="popuptext" id="usagePopup122">Usage of <b>InterNames::explicitly_named</b>:<br>Building Site - <a href="1-bs.html#SP2">&#167;2</a><br>Hierarchy Locations - <a href="1-hl.html#SP3">&#167;3</a>, <a href="1-hl.html#SP3_1">&#167;3.1</a>, <a href="1-hl.html#SP4">&#167;4</a><br>Packaging - <a href="1-pck.html#SP15">&#167;15</a>, <a href="1-pck.html#SP18">&#167;18</a>, <a href="1-pck.html#SP19">&#167;19</a>, <a href="1-pck.html#SP20">&#167;20</a><br>Producing Inter - <a href="3-prd.html#SP2">&#167;2</a></span></button></span><span class="plain">(</span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">, </span><span class="reserved">package_request</span><span class="plain"> *</span><span class="identifier">R</span><span class="plain">) {</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="functiontext"><a href="1-in.html#SP5">InterNames::explicitly_named_with_memo</a></span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="identifier">R</span><span class="plain">, </span><span class="identifier">EMPTY_WORDING</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">inter_name</span><span class="plain"> *</span><span class="functiontext">InterNames::explicitly_named_in_template<button class="popup" onclick="togglePopup('usagePopup123')">...<span class="popuptext" id="usagePopup123">Usage of <b>InterNames::explicitly_named_in_template</b>:<br>Hierarchy Locations - <a href="1-hl.html#SP3">&#167;3</a></span></button></span><span class="plain">(</span><span class="identifier">inter_tree</span><span class="plain"> *</span><span class="identifier">I</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">) {</span>
        <span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = </span><span class="functiontext"><a href="1-in.html#SP5">InterNames::explicitly_named</a></span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="functiontext"><a href="1-bs.html#SP2">Site::connectors_request</a></span><span class="plain">(</span><span class="identifier">I</span><span class="plain">));</span>
        <span class="identifier">inter_symbol</span><span class="plain"> *</span><span class="identifier">plug</span><span class="plain"> = </span><span class="identifier">Inter::Connectors::find_plug</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">, </span><span class="identifier">name</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">plug</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">plug</span><span class="plain"> = </span><span class="identifier">Inter::Connectors::plug</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">, </span><span class="identifier">name</span><span class="plain">);</span>
        <span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">symbol</span><span class="plain"> = </span><span class="identifier">plug</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6.  </b>Second, the generated or derived cases:
</p>

<pre class="display">
    <span class="reserved">inter_name</span><span class="plain"> *</span><span class="functiontext">InterNames::multiple<button class="popup" onclick="togglePopup('usagePopup124')">...<span class="popuptext" id="usagePopup124">Usage of <b>InterNames::multiple</b>:<br>none</span></button></span><span class="plain">(</span><span class="reserved">inter_name_generator</span><span class="plain"> *</span><span class="identifier">G</span><span class="plain">, </span><span class="reserved">package_request</span><span class="plain"> *</span><span class="identifier">R</span><span class="plain">, </span><span class="identifier">wording</span><span class="plain"> </span><span class="identifier">W</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">G</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"no generator"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">G</span><span class="plain">-&gt;</span><span class="element">ingen</span><span class="plain"> == </span><span class="constant">UNIQUE_INGEN</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"not a generator name"</span><span class="plain">);</span>
        <span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = </span><span class="functiontext"><a href="1-in.html#SP4">InterNames::new</a></span><span class="plain">(</span><span class="identifier">G</span><span class="plain">, </span><span class="identifier">R</span><span class="plain">, </span><span class="identifier">W</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">G</span><span class="plain">-&gt;</span><span class="element">ingen</span><span class="plain"> != </span><span class="constant">DERIVED_INGEN</span><span class="plain">) </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">unique_number</span><span class="plain"> = ++</span><span class="identifier">G</span><span class="plain">-&gt;</span><span class="element">no_generated</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">inter_name</span><span class="plain"> *</span><span class="functiontext">InterNames::generated_in<button class="popup" onclick="togglePopup('usagePopup125')">...<span class="popuptext" id="usagePopup125">Usage of <b>InterNames::generated_in</b>:<br>Packaging - <a href="1-pck.html#SP4">&#167;4</a></span></button></span><span class="plain">(</span><span class="reserved">inter_name_generator</span><span class="plain"> *</span><span class="identifier">G</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">fix</span><span class="plain">, </span><span class="identifier">wording</span><span class="plain"> </span><span class="identifier">W</span><span class="plain">, </span><span class="reserved">package_request</span><span class="plain"> *</span><span class="identifier">R</span><span class="plain">) {</span>
        <span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = </span><span class="functiontext"><a href="1-in.html#SP6">InterNames::multiple</a></span><span class="plain">(</span><span class="identifier">G</span><span class="plain">, </span><span class="identifier">R</span><span class="plain">, </span><span class="identifier">W</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">fix</span><span class="plain"> != -1) </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">unique_number</span><span class="plain"> = </span><span class="identifier">fix</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">inter_name</span><span class="plain"> *</span><span class="functiontext">InterNames::generated<button class="popup" onclick="togglePopup('usagePopup126')">...<span class="popuptext" id="usagePopup126">Usage of <b>InterNames::generated</b>:<br>Hierarchy Locations - <a href="1-hl.html#SP3">&#167;3</a></span></button></span><span class="plain">(</span><span class="reserved">inter_name_generator</span><span class="plain"> *</span><span class="identifier">G</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">fix</span><span class="plain">, </span><span class="identifier">wording</span><span class="plain"> </span><span class="identifier">W</span><span class="plain">) {</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="functiontext"><a href="1-in.html#SP6">InterNames::generated_in</a></span><span class="plain">(</span><span class="identifier">G</span><span class="plain">, </span><span class="identifier">fix</span><span class="plain">, </span><span class="identifier">W</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">inter_name</span><span class="plain"> *</span><span class="functiontext">InterNames::derived<button class="popup" onclick="togglePopup('usagePopup127')">...<span class="popuptext" id="usagePopup127">Usage of <b>InterNames::derived</b>:<br>Hierarchy Locations - <a href="1-hl.html#SP3">&#167;3</a></span></button></span><span class="plain">(</span><span class="reserved">inter_name_generator</span><span class="plain"> *</span><span class="identifier">G</span><span class="plain">, </span><span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">from</span><span class="plain">, </span><span class="identifier">wording</span><span class="plain"> </span><span class="identifier">W</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">G</span><span class="plain">-&gt;</span><span class="element">ingen</span><span class="plain"> != </span><span class="constant">DERIVED_INGEN</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"not a derived generator"</span><span class="plain">);</span>
        <span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = </span><span class="functiontext"><a href="1-in.html#SP6">InterNames::multiple</a></span><span class="plain">(</span><span class="identifier">G</span><span class="plain">, </span><span class="identifier">from</span><span class="plain">-&gt;</span><span class="element">location_in_hierarchy</span><span class="plain">, </span><span class="identifier">W</span><span class="plain">);</span>
        <span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">derived_from</span><span class="plain"> = </span><span class="identifier">from</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7.  </b>Now that inames have been created, we allow their locations to be read:
</p>

<pre class="display">
    <span class="reserved">package_request</span><span class="plain"> *</span><span class="functiontext">InterNames::location<button class="popup" onclick="togglePopup('usagePopup128')">...<span class="popuptext" id="usagePopup128">Usage of <b>InterNames::location</b>:<br>Hierarchy Locations - <a href="1-hl.html#SP3">&#167;3</a><br>Packaging - <a href="1-pck.html#SP2">&#167;2</a>, <a href="1-pck.html#SP12">&#167;12</a>, <a href="1-pck.html#SP19">&#167;19</a><br>Producing Inter - <a href="3-prd.html#SP3">&#167;3</a></span></button></span><span class="plain">(</span><span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">iname</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">location_in_hierarchy</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">inter_symbols_table</span><span class="plain"> *</span><span class="functiontext">InterNames::scope<button class="popup" onclick="togglePopup('usagePopup129')">...<span class="popuptext" id="usagePopup129">Usage of <b>InterNames::scope</b>:<br><a href="1-in.html#SP8">&#167;8</a></span></button></span><span class="plain">(</span><span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">iname</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"can't determine scope of null name"</span><span class="plain">);</span>
        <span class="reserved">package_request</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> = </span><span class="functiontext"><a href="1-in.html#SP7">InterNames::location</a></span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">P</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"can't determine scope of unlocated name"</span><span class="plain">);</span>
            <span class="comment"> return Inter::Tree::global_scope(InterNames::tree(iname));</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">Inter::Packages::scope</span><span class="plain">(</span><span class="functiontext"><a href="1-pck.html#SP13">Packaging::incarnate</a></span><span class="plain">(</span><span class="identifier">P</span><span class="plain">));</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP8"></a><b>&#167;8. Conversion of inames to symbols. </b>The purpose of inames is not quite to represent identifier names occurring in
given packages inside the Inter hierarchy: it would be more accurate to say
that they represent potential identifiers, which may or may not be used.
At some point they will probably (but not certainly) undergo "conversion",
when they are matched up with actual symbols in the symbols tables of the
given packages. An exception to this is that inames pointing to externally
defined resources in the template are never converted: see above.
</p>

<p class="inwebparagraph">Conversion is done on-demand, and thus left as late as possible. It happens
automatically here:
</p>

<pre class="display">
    <span class="identifier">inter_symbol</span><span class="plain"> *</span><span class="functiontext">InterNames::to_symbol<button class="popup" onclick="togglePopup('usagePopup130')">...<span class="popuptext" id="usagePopup130">Usage of <b>InterNames::to_symbol</b>:<br>Emitting Inter Schemas - <a href="2-eis.html#SP4">&#167;4</a><br>Producing Inter - <a href="3-prd.html#SP2">&#167;2</a>, <a href="3-prd.html#SP3">&#167;3</a></span></button></span><span class="plain">(</span><span class="reserved">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="identifier">symbol</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">NBUFF</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">NBUFF</span><span class="plain">, </span><span class="string">"%n"</span><span class="plain">, </span><span class="identifier">iname</span><span class="plain">);</span>
            <span class="identifier">inter_symbols_table</span><span class="plain"> *</span><span class="identifier">T</span><span class="plain"> = </span><span class="functiontext"><a href="1-in.html#SP7">InterNames::scope</a></span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">);</span>
            <span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">symbol</span><span class="plain"> = </span><span class="functiontext"><a href="3-prd.html#SP2">Produce::new_symbol</a></span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="identifier">NBUFF</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">NBUFF</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">-&gt;</span><span class="element">symbol</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<hr class="tocbar">
<ul class="toc"><li><a href="1-pt.html">Back to 'Package Types'</a></li><li><i>(This section ends Chapter 1: Architecture.)</i></li></ul><hr class="tocbar">
<!--End of weave-->
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
		</main>
	</body>
</html>

