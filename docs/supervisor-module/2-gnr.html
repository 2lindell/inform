<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Genres</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-src/Figures/Inform.png" height=72">
</a></h1>
<ul><li><a href="../compiler.html">compiler tools</a></li>
<li><a href="../other.html">other tools</a></li>
<li><a href="../extensions.html">extensions and kits</a></li>
<li><a href="../units.html">unit test tools</a></li>
</ul><h2>Compiler Webs</h2><ul>
<li><a href="../inbuild/index.html">inbuild</a></li>
<li><a href="../inform7/index.html">inform7</a></li>
<li><a href="../inter/index.html">inter</a></li>
</ul><h2>Inbuild Modules</h2><ul>
<li><a href="index.html"><span class="selectedlink">supervisor</span></a></li>
</ul><h2>Inform7 Modules</h2><ul>
<li><a href="../core-module/index.html">core</a></li>
<li><a href="../inflections-module/index.html">inflections</a></li>
<li><a href="../linguistics-module/index.html">linguistics</a></li>
<li><a href="../kinds-module/index.html">kinds</a></li>
<li><a href="../if-module/index.html">if</a></li>
<li><a href="../multimedia-module/index.html">multimedia</a></li>
<li><a href="../problems-module/index.html">problems</a></li>
<li><a href="../index-module/index.html">index</a></li>
</ul><h2>Inter Modules</h2><ul>
<li><a href="../bytecode-module/index.html">bytecode</a></li>
<li><a href="../building-module/index.html">building</a></li>
<li><a href="../codegen-module/index.html">codegen</a></li>
</ul><h2>Shared Modules</h2><ul>
<li><a href="../arch-module/index.html">arch</a></li>
<li><a href="../syntax-module/index.html">syntax</a></li>
<li><a href="../words-module/index.html">words</a></li>
<li><a href="../html-module/index.html">html</a></li>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>

</ul>
		</nav>
		<main role="main">
		
<!--Weave of 'Genres' generated by 7-->
<ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="../compiler.html">Inbuild Modules</a></li><li><a href="index.html">supervisor</a></li><li><a href="index.html#2">Chapter 2: Conceptual Framework</a></li><li><b>Genres</b></li></ul><p class="purpose">The different sorts of work managed by inbuild.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Genres</a></li><li><a href="#SP4">&#167;4. Method functions</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Genres. </b>Each different genre of work managed by Inbuild is represented by an instance
of the following structure. (At present, then, there are exactly seven
instances of it: nothing the user can do at the command line can change
that total.) A work unambiguously specifies what genre it has by means
of a non-null pointer to <code class="display"><span class="extract">inbuild_genre</span></code>. Moreover, the rules for how Inbuild
manages works of this genre are expressed by methods attached to the structure.
For example, to copy a work, Inbuild calls the <code class="display"><span class="extract">GENRE_COPY_TO_NEST_MTID</span></code>
method attached to its <code class="display"><span class="extract">inbuild_genre</span></code>.
</p>

<p class="inwebparagraph">Each genre has its own section of code: for example, <code class="display"><span class="extract">Kit Manager</span></code> defines
the instance <code class="display"><span class="extract">kit_genre</span></code> and provides its method functions.
</p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">inbuild_genre</span><span class="plain"> {</span>
        <span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">genre_name</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">stored_in_nests</span><span class="plain">;</span>
        <span class="identifier">METHOD_CALLS</span>
        <span class="identifier">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">inbuild_genre</span><span class="plain">;</span>

    <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="functiontext">Genres::new<button class="popup" onclick="togglePopup('usagePopup29')">...<span class="popuptext" id="usagePopup29">Usage of <b>Genres::new</b>:<br>Extension Manager - <a href="4-em.html#SP2">&#167;2</a><br>Kit Manager - <a href="4-km.html#SP1">&#167;1</a><br>Language Manager - <a href="4-lm.html#SP1">&#167;1</a><br>Pipeline Manager - <a href="4-pm.html#SP1">&#167;1</a><br>Project Bundle Manager - <a href="4-pbm.html#SP1">&#167;1</a><br>Project File Manager - <a href="4-pfm.html#SP1">&#167;1</a><br>Template Manager - <a href="4-tm.html#SP1">&#167;1</a></span></button></span><span class="plain">(</span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">nested</span><span class="plain">) {</span>
        <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">gen</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">inbuild_genre</span><span class="plain">);</span>
        <span class="identifier">gen</span><span class="plain">-&gt;</span><span class="element">genre_name</span><span class="plain"> = </span><span class="identifier">Str::duplicate</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">);</span>
        <span class="identifier">gen</span><span class="plain">-&gt;</span><span class="element">stored_in_nests</span><span class="plain"> = </span><span class="identifier">nested</span><span class="plain">;</span>
        <span class="identifier">ENABLE_METHOD_CALLS</span><span class="plain">(</span><span class="identifier">gen</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">gen</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">text_stream</span><span class="plain"> *</span><span class="functiontext">Genres::name<button class="popup" onclick="togglePopup('usagePopup30')">...<span class="popuptext" id="usagePopup30">Usage of <b>Genres::name</b>:<br>Copies - <a href="2-cps.html#SP9">&#167;9</a></span></button></span><span class="plain">(</span><span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">G</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">G</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">I</span><span class="string">"(none)"</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">G</span><span class="plain">-&gt;</span><span class="identifier">genre_name</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure inbuild_genre is accessed in 2/rqr, 3/bg and here.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>Some genres of work, such as kits and extensions, can be stored in nests;
others, such as Inform projects, cannot. Whether a copy can be stored in a
nest depends only on its genre.
</p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Genres::stored_in_nests<button class="popup" onclick="togglePopup('usagePopup31')">...<span class="popuptext" id="usagePopup31">Usage of <b>Genres::stored_in_nests</b>:<br>Build Graphs - <a href="3-bg.html#SP9">&#167;9</a></span></button></span><span class="plain">(</span><span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">G</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">G</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">G</span><span class="plain">-&gt;</span><span class="identifier">stored_in_nests</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>The requirements parser needs to identify genres by name, so:
</p>

<pre class="display">
    <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="functiontext">Genres::by_name<button class="popup" onclick="togglePopup('usagePopup32')">...<span class="popuptext" id="usagePopup32">Usage of <b>Genres::by_name</b>:<br>Requirements - <a href="2-rqr.html#SP4_1">&#167;4.1</a></span></button></span><span class="plain">(</span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">) {</span>
        <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">G</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">G</span><span class="plain">, </span><span class="reserved">inbuild_genre</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::eq_insensitive</span><span class="plain">(</span><span class="identifier">G</span><span class="plain">-&gt;</span><span class="element">genre_name</span><span class="plain">, </span><span class="identifier">name</span><span class="plain">))</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="identifier">G</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">NULL</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4. Method functions. </b>And here are the method functions which a genre can, optionally, provide.
All of these act on a given work, or a given copy of a work, having the
genre in question.
</p>

<p class="inwebparagraph">First, this writes text sufficient to identify a work: e.g., "Locksmith
by Emily Short".
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">GENRE_WRITE_WORK_MTID</span>
</pre>

<pre class="display">
    <span class="identifier">VMETHOD_TYPE</span><span class="plain">(</span><span class="constant">GENRE_WRITE_WORK_MTID</span><span class="plain">,</span>
        <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">gen</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain">, </span><span class="reserved">inbuild_work</span><span class="plain"> *</span><span class="identifier">work</span><span class="plain">)</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5.  </b>This looks at a textual file locator, which might be a pathname or a
filename, to see if it might refer to a copy of a work of the given genre.
If it does, an <code class="display"><span class="extract">inbuild_copy</span></code> is created, and the pointer <code class="display"><span class="extract">*C</span></code> is set to
point to it. If not, no error is issued, and <code class="display"><span class="extract">*C</span></code> is left unchanged.
</p>

<p class="inwebparagraph">Errors can, however, be produced if Inbuild is pretty sure that the object
in the file system is intended to be such a copy, but is damaged in some way:
an extension with a malformed titling line, for example. Such errors are
attached to the copy for later issuing.
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">GENRE_CLAIM_AS_COPY_MTID</span>
</pre>

<pre class="display">
    <span class="identifier">VMETHOD_TYPE</span><span class="plain">(</span><span class="constant">GENRE_CLAIM_AS_COPY_MTID</span><span class="plain">,</span>
        <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">gen</span><span class="plain">, </span><span class="reserved">inbuild_copy</span><span class="plain"> **</span><span class="identifier">C</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">arg</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">ext</span><span class="plain">,</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">directory_status</span><span class="plain">)</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6.  </b>This searches the nest <code class="display"><span class="extract">N</span></code> for anything which (a) looks like a copy of a
work of our genre, and (b) meets the given requirements. If a genre does
not provide this method, then nothing of that genre can ever appear in
<code class="display"><span class="extract">-matching</span></code> search results.
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">GENRE_SEARCH_NEST_FOR_MTID</span>
</pre>

<pre class="display">
    <span class="identifier">VMETHOD_TYPE</span><span class="plain">(</span><span class="constant">GENRE_SEARCH_NEST_FOR_MTID</span><span class="plain">,</span>
        <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">gen</span><span class="plain">, </span><span class="reserved">inbuild_nest</span><span class="plain"> *</span><span class="identifier">N</span><span class="plain">, </span><span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="identifier">req</span><span class="plain">,</span>
        <span class="identifier">linked_list</span><span class="plain"> *</span><span class="identifier">search_results</span><span class="plain">)</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7.  </b>Some genres of work involve Inform source text &mdash; Inform projects and
extensions, for example. Reading in source text is fairly fast, but it's not
an instant process, and we don't automatically perform it. (When an extension
is scanned for metadata during claiming, only the opening line is looked at.)
</p>

<p class="inwebparagraph">This method should exist only for such genres, and it should read the source
text. It will never be called twice on the same copy.
</p>

<p class="inwebparagraph">Text should actually be read by feeding it into the lexer. Inbuild will take
of it from there.
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">GENRE_READ_SOURCE_TEXT_FOR_MTID</span>
</pre>

<pre class="display">
    <span class="identifier">VMETHOD_TYPE</span><span class="plain">(</span><span class="constant">GENRE_READ_SOURCE_TEXT_FOR_MTID</span><span class="plain">,</span>
        <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">gen</span><span class="plain">, </span><span class="reserved">inbuild_copy</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">)</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP8"></a><b>&#167;8.  </b>At the Graph Construction phase of Inbuild, each copy is offered the chance
to finalise its internal representation. For example, this may be when its
build graph is constructed, because we can now know for sure that there are
no further unsuspected dependencies.
</p>

<p class="inwebparagraph">This method is optional, and is called exactly once on every copy (whose genre
provides it) which has been claimed by Inbuild.
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">GENRE_CONSTRUCT_GRAPH_MTID</span>
</pre>

<pre class="display">
    <span class="identifier">VMETHOD_TYPE</span><span class="plain">(</span><span class="constant">GENRE_CONSTRUCT_GRAPH_MTID</span><span class="plain">,</span>
        <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">gen</span><span class="plain">, </span><span class="reserved">inbuild_copy</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">)</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP9"></a><b>&#167;9.  </b>This method is called when a copy is about to be built or have its graph
described, for example by <code class="display"><span class="extract">-graph</span></code>, <code class="display"><span class="extract">-build</span></code> and <code class="display"><span class="extract">-rebuild</span></code>. Nothing actually
needs to be done, but if any work is needed before building can take place,
now's the time; and the vertex to build from can be altered by setting <code class="display"><span class="extract">*V</span></code>.
(This is used to create upstream targets for Inform projects, such as the
blorbed release version. It affects <code class="display"><span class="extract">-graph</span></code>, <code class="display"><span class="extract">-build</span></code> and <code class="display"><span class="extract">-rebuild</span></code> but
is ignored for other inspection options such as <code class="display"><span class="extract">-use-missing</span></code>.)
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">GENRE_BUILDING_SOON_MTID</span>
</pre>

<pre class="display">
    <span class="identifier">VMETHOD_TYPE</span><span class="plain">(</span><span class="constant">GENRE_BUILDING_SOON_MTID</span><span class="plain">,</span>
        <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">gen</span><span class="plain">, </span><span class="reserved">inbuild_copy</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">, </span><span class="reserved">build_vertex</span><span class="plain"> **</span><span class="identifier">V</span><span class="plain">)</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP10"></a><b>&#167;10.  </b>This duplicates, or syncs, a copy <code class="display"><span class="extract">C</span></code> of a work in our genre, placing it
at a canonical location inside the given nest <code class="display"><span class="extract">N</span></code>. In effect, it implements
the Inbuild command-line options <code class="display"><span class="extract">-copy-to N</span></code> and <code class="display"><span class="extract">-sync-to N</span></code>.
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">GENRE_COPY_TO_NEST_MTID</span>
</pre>

<pre class="display">
    <span class="identifier">VMETHOD_TYPE</span><span class="plain">(</span><span class="constant">GENRE_COPY_TO_NEST_MTID</span><span class="plain">,</span>
        <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">gen</span><span class="plain">, </span><span class="reserved">inbuild_copy</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">, </span><span class="reserved">inbuild_nest</span><span class="plain"> *</span><span class="identifier">N</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">syncing</span><span class="plain">,</span>
        <span class="reserved">build_methodology</span><span class="plain"> *</span><span class="identifier">meth</span><span class="plain">)</span>
</pre>

<p class="inwebparagraph"></p>

<hr class="tocbar">
<ul class="toc"><li><i>(This section begins Chapter 2: Conceptual Framework.)</i></li><li><a href="2-wrk.html">Continue with 'Works'</a></li></ul><hr class="tocbar">
<!--End of weave-->
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
		</main>
	</body>
</html>

