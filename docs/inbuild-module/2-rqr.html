<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>2/ce</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../webs.html">Sources</a></h1>
<ul>
<li><a href="../compiler.html"><b>compiler tools</b></a></li>
<li><a href="../other.html">other tools</a></li>
<li><a href="../extensions.html">extensions and kits</a></li>
<li><a href="../units.html">unit test tools</a></li>
</ul>
<h2>Compiler Webs</h2>
<ul>
<li><a href="../inbuild/index.html">inbuild</a></li>
<li><a href="../inform7/index.html">inform7</a></li>
<li><a href="../inter/index.html">inter</a></li>
</ul>
<h2>Inbuild Modules</h2>
<ul>
<li><a href="../inbuild-module/index.html">inbuild</a></li>
<li><a href="../arch-module/index.html">arch</a></li>
<li><a href="../words-module/index.html">words</a></li>
<li><a href="../syntax-module/index.html">syntax</a></li>
<li><a href="../html-module/index.html">html</a></li>
</ul>
<h2>Inform7 Modules</h2>
<ul>
<li><a href="../core-module/index.html">core</a></li>
<li><a href="../problems-module/index.html">problems</a></li>
<li><a href="../inflections-module/index.html">inflections</a></li>
<li><a href="../linguistics-module/index.html">linguistics</a></li>
<li><a href="../kinds-module/index.html">kinds</a></li>
<li><a href="../if-module/index.html">if</a></li>
<li><a href="../multimedia-module/index.html">multimedia</a></li>
<li><a href="../index-module/index.html">index</a></li>
</ul>
<h2>Inter Modules</h2>
<ul>
<li><a href="../inter-module/index.html">inter</a></li>
<li><a href="../building-module/index.html">building</a></li>
<li><a href="../codegen-module/index.html">codegen</a></li>
</ul>
<h2>Foundation</h2>
<ul>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>
</ul>


		</nav>
		<main role="main">
		
<!--Weave of '2/rqr' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">Source</a></li><li><a href="../compiler.html">Compiler Modules</a></li><li><a href="index.html">inbuild</a></li><li><a href="index.html#2">Chapter 2: Conceptual Framework</a></li><li><b>Requirements</b></li></ul><p class="purpose">A requirement is a way to specify some subset of works: for example, those with a given title, and/or version number.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Creation</a></li><li><a href="#SP6">&#167;6. Writing</a></li><li><a href="#SP7">&#167;7. Meeting requirements</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Creation. </b>A requirement is, in effect, the criteria for performing a search. We can
specify the title, and/or the author name, and/or the genre &mdash; all given
in the <code class="display"><span class="extract">work</span></code> field below, with those unspecified left blank &mdash; and/or
we can give a semantic version number range:
</p>


<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">inbuild_requirement</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">inbuild_work</span><span class="plain"> *</span><span class="identifier">work</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">semver_range</span><span class="plain"> *</span><span class="identifier">version_range</span><span class="plain">;</span>
        <span class="identifier">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">inbuild_requirement</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure inbuild_requirement is accessed in 2/wrk, 2/edt, 2/cps, 3/bg, 3/is2, 4/em, 4/km, 4/lm, 4/pm, 4/pbm, 4/pfm, 4/tm, 5/es, 5/kts, 5/ls, 5/ps2, 6/hdn, 6/inc, 7/ed, 7/ed2, 7/ec and here.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>Here are some creators:
</p>


<pre class="display">
    <span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="functiontext">Requirements::new</span><span class="plain">(</span><span class="reserved">inbuild_work</span><span class="plain"> *</span><span class="identifier">work</span><span class="plain">, </span><span class="identifier">semver_range</span><span class="plain"> *</span><span class="identifier">R</span><span class="plain">) {</span>
        <span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="identifier">req</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">inbuild_requirement</span><span class="plain">);</span>
        <span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain"> = </span><span class="identifier">work</span><span class="plain">;</span>
        <span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;version_range</span><span class="plain"> = </span><span class="identifier">R</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">req</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="functiontext">Requirements::any_version_of</span><span class="plain">(</span><span class="reserved">inbuild_work</span><span class="plain"> *</span><span class="identifier">work</span><span class="plain">) {</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">Requirements::new</span><span class="plain">(</span><span class="identifier">work</span><span class="plain">, </span><span class="identifier">VersionNumberRanges::any_range</span><span class="plain">());</span>
    <span class="plain">}</span>

    <span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="functiontext">Requirements::anything_of_genre</span><span class="plain">(</span><span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">G</span><span class="plain">) {</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">Requirements::any_version_of</span><span class="plain">(</span><span class="functiontext">Works::new</span><span class="plain">(</span><span class="identifier">G</span><span class="plain">, </span><span class="identifier">I</span><span class="string">""</span><span class="plain">, </span><span class="identifier">I</span><span class="string">""</span><span class="plain">));</span>
    <span class="plain">}</span>

    <span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="functiontext">Requirements::anything</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">Requirements::anything_of_genre</span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Requirements::new is used in 6/inc (<a href="6-inc.html#SP5_1">&#167;5.1</a>).</p>

<p class="endnote">The function Requirements::any_version_of is used in 3/is (<a href="3-is.html#SP3">&#167;3</a>, <a href="3-is.html#SP4">&#167;4</a>), 5/kts (<a href="5-kts.html#SP1">&#167;1</a>), 5/ls (<a href="5-ls.html#SP7">&#167;7</a>), 6/inc (<a href="6-inc.html#SP6_1_2">&#167;6.1.2</a>), 7/ed2 (<a href="7-ed2.html#SP4">&#167;4</a>).</p>

<p class="endnote">The function Requirements::anything_of_genre is used in 1/ic (<a href="1-ic.html#SP9_2">&#167;9.2</a>), 7/ec (<a href="7-ec.html#SP3">&#167;3</a>).</p>

<p class="endnote">The function Requirements::anything is used in <a href="#SP3">&#167;3</a>.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>The most involved of the creators parses text. An involved example might be:
</p>

<p class="inwebparagraph"></p>


<pre class="display">
        <span class="plain">genre=extension,author=Emily Short,title=Locksmith,min=6.1-alpha.2,max=17.2</span>
</pre>

<p class="inwebparagraph">We should return a requirement if this is valid, and write an error message if
it is not. (If the text has multiple things wrong with it, we write only the
first error message arising.)
</p>

<p class="inwebparagraph">At the top level, we have a comma-separated list of clauses. Note that the
empty text is legal here, and produces an unlimited requirement.
</p>


<pre class="display">
    <span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="functiontext">Requirements::from_text</span><span class="plain">(</span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">T</span><span class="plain">,</span>
        <span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">errors</span><span class="plain">) {</span>
        <span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="identifier">req</span><span class="plain"> = </span><span class="functiontext">Requirements::anything</span><span class="plain">();</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">from</span><span class="plain"> = 0;</span>
        <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">at</span><span class="plain"> = 0; </span><span class="identifier">at</span><span class="plain"> &lt; </span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">); </span><span class="identifier">at</span><span class="plain">++) {</span>
            <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="identifier">Str::get_at</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="identifier">at</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">','</span><span class="plain">) {</span>
                <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">initial</span><span class="plain">);</span>
                <span class="identifier">Str::substr</span><span class="plain">(</span><span class="identifier">initial</span><span class="plain">, </span><span class="identifier">Str::at</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="identifier">from</span><span class="plain">), </span><span class="identifier">Str::at</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="identifier">at</span><span class="plain">));</span>
                <span class="functiontext">Requirements::impose_clause</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">, </span><span class="identifier">initial</span><span class="plain">, </span><span class="identifier">errors</span><span class="plain">);</span>
                <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">initial</span><span class="plain">);</span>
                <span class="identifier">from</span><span class="plain"> = </span><span class="identifier">at</span><span class="plain"> + 1;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">from</span><span class="plain"> &lt; </span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">)) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">final</span><span class="plain">);</span>
            <span class="identifier">Str::substr</span><span class="plain">(</span><span class="identifier">final</span><span class="plain">, </span><span class="identifier">Str::at</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="identifier">from</span><span class="plain">), </span><span class="identifier">Str::end</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">));</span>
            <span class="functiontext">Requirements::impose_clause</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">, </span><span class="identifier">final</span><span class="plain">, </span><span class="identifier">errors</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">final</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">req</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Requirements::from_text appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4.  </b>Each clause must either be <code class="display"><span class="extract">all</span></code> or take the form <code class="display"><span class="extract">term=value</span></code>:
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Requirements::impose_clause</span><span class="plain">(</span><span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="identifier">req</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">T</span><span class="plain">,</span>
        <span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">errors</span><span class="plain">) {</span>
        <span class="identifier">Str::trim_white_space</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::eq</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"all"</span><span class="plain">)) </span><span class="reserved">return</span><span class="plain">;</span>

        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">);</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">value</span><span class="plain">);</span>
        <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">at</span><span class="plain"> = 0; </span><span class="identifier">at</span><span class="plain"> &lt; </span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">); </span><span class="identifier">at</span><span class="plain">++) {</span>
            <span class="identifier">wchar_t</span><span class="plain"> </span><span class="identifier">c</span><span class="plain"> = </span><span class="identifier">Str::get_at</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="identifier">at</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">c</span><span class="plain"> == </span><span class="character">'='</span><span class="plain">) {</span>
                <span class="identifier">Str::substr</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">, </span><span class="identifier">Str::start</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">), </span><span class="identifier">Str::at</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="identifier">at</span><span class="plain">));</span>
                <span class="identifier">Str::substr</span><span class="plain">(</span><span class="identifier">value</span><span class="plain">, </span><span class="identifier">Str::at</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">, </span><span class="identifier">at</span><span class="plain">+1), </span><span class="identifier">Str::end</span><span class="plain">(</span><span class="identifier">T</span><span class="plain">));</span>
                <span class="reserved">break</span><span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="identifier">Str::trim_white_space</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">);</span>
        <span class="identifier">Str::trim_white_space</span><span class="plain">(</span><span class="identifier">value</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">) &gt; 0) &amp;&amp; (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">value</span><span class="plain">) &gt; 0)) {</span>
            &lt;<span class="cwebmacro">Deal with a term-value pair</span> <span class="cwebmacronumber">4.1</span>&gt;<span class="plain">;</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">errors</span><span class="plain">) == 0)</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">errors</span><span class="plain">, </span><span class="string">"clause not in the form 'term=value': '%S'"</span><span class="plain">, </span><span class="identifier">T</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">value</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Requirements::impose_clause is used in <a href="#SP3">&#167;3</a>.</p>

<p class="inwebparagraph"><a id="SP4_1"></a><b>&#167;4.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Deal with a term-value pair</span> <span class="cwebmacronumber">4.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::eq</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"genre"</span><span class="plain">)) {</span>
            <span class="reserved">inbuild_genre</span><span class="plain"> *</span><span class="identifier">G</span><span class="plain"> = </span><span class="functiontext">Genres::by_name</span><span class="plain">(</span><span class="identifier">value</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">G</span><span class="plain">) </span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;genre</span><span class="plain"> = </span><span class="identifier">G</span><span class="plain">;</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">errors</span><span class="plain">) == 0)</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">errors</span><span class="plain">, </span><span class="string">"not a valid genre: '%S'"</span><span class="plain">, </span><span class="identifier">value</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::eq</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"title"</span><span class="plain">)) {</span>
            <span class="identifier">Str::copy</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;title</span><span class="plain">, </span><span class="identifier">value</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::eq</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"author"</span><span class="plain">)) {</span>
            <span class="identifier">Str::copy</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;author_name</span><span class="plain">, </span><span class="identifier">value</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::eq</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"version"</span><span class="plain">)) {</span>
            <span class="identifier">semantic_version_number</span><span class="plain"> </span><span class="identifier">V</span><span class="plain"> = </span><span class="functiontext">Requirements::semver</span><span class="plain">(</span><span class="identifier">value</span><span class="plain">, </span><span class="identifier">errors</span><span class="plain">);</span>
            <span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;version_range</span><span class="plain"> = </span><span class="identifier">VersionNumberRanges::compatibility_range</span><span class="plain">(</span><span class="identifier">V</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::eq</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"min"</span><span class="plain">)) {</span>
            <span class="identifier">semantic_version_number</span><span class="plain"> </span><span class="identifier">V</span><span class="plain"> = </span><span class="functiontext">Requirements::semver</span><span class="plain">(</span><span class="identifier">value</span><span class="plain">, </span><span class="identifier">errors</span><span class="plain">);</span>
            <span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;version_range</span><span class="plain"> = </span><span class="identifier">VersionNumberRanges::at_least_range</span><span class="plain">(</span><span class="identifier">V</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::eq</span><span class="plain">(</span><span class="identifier">term</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"max"</span><span class="plain">)) {</span>
            <span class="identifier">semantic_version_number</span><span class="plain"> </span><span class="identifier">V</span><span class="plain"> = </span><span class="functiontext">Requirements::semver</span><span class="plain">(</span><span class="identifier">value</span><span class="plain">, </span><span class="identifier">errors</span><span class="plain">);</span>
            <span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;version_range</span><span class="plain"> = </span><span class="identifier">VersionNumberRanges::at_most_range</span><span class="plain">(</span><span class="identifier">V</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">errors</span><span class="plain">) == 0)</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">errors</span><span class="plain">, </span><span class="string">"no such term as '%S'"</span><span class="plain">, </span><span class="identifier">term</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP4">&#167;4</a>.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5.  </b></p>


<pre class="display">
    <span class="identifier">semantic_version_number</span><span class="plain"> </span><span class="functiontext">Requirements::semver</span><span class="plain">(</span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">value</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">errors</span><span class="plain">) {</span>
        <span class="identifier">semantic_version_number</span><span class="plain"> </span><span class="identifier">V</span><span class="plain"> = </span><span class="identifier">VersionNumbers::from_text</span><span class="plain">(</span><span class="identifier">value</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">VersionNumbers::is_null</span><span class="plain">(</span><span class="identifier">V</span><span class="plain">))</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">errors</span><span class="plain">) == 0)</span>
                <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">errors</span><span class="plain">, </span><span class="string">"not a valid version number: '%S'"</span><span class="plain">, </span><span class="identifier">value</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">V</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Requirements::semver is used in <a href="#SP4_1">&#167;4.1</a>.</p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6. Writing. </b>This is the inverse of the above function, and uses the same notation.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Requirements::write</span><span class="plain">(</span><span class="identifier">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="identifier">req</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">req</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) { </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&lt;none&gt;"</span><span class="plain">); </span><span class="reserved">return</span><span class="plain">; }</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">claused</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;genre</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">claused</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">","</span><span class="plain">); </span><span class="identifier">claused</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"genre=%S"</span><span class="plain">, </span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;genre</span><span class="plain">-</span><span class="element">&gt;genre_name</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;title</span><span class="plain">) &gt; 0) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">claused</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">","</span><span class="plain">); </span><span class="identifier">claused</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"work=%S"</span><span class="plain">, </span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;title</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;author_name</span><span class="plain">) &gt; 0) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">claused</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">","</span><span class="plain">); </span><span class="identifier">claused</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"author=%S"</span><span class="plain">, </span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;author_name</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">VersionNumberRanges::is_any_range</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;version_range</span><span class="plain">) == </span><span class="identifier">FALSE</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">claused</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">","</span><span class="plain">); </span><span class="identifier">claused</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"range="</span><span class="plain">); </span><span class="identifier">VersionNumberRanges::write_range</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;version_range</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">claused</span><span class="plain"> == </span><span class="identifier">FALSE</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"all"</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Requirements::write is used in 3/bg (<a href="3-bg.html#SP6">&#167;6</a>).</p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7. Meeting requirements. </b>Finally, we actually use these intricacies for something. Given an edition,
we return <code class="display"><span class="extract">TRUE</span></code> if it meets the requirements and <code class="display"><span class="extract">FALSE</span></code> if it does not.
</p>

<p class="inwebparagraph">Note that requirements are based on the edition, not on the copy. If one
copy on file of Version 3.2 of Monkey Puzzle Trees by Capability Brown meets
a requirement, then so will all other copies of it.
</p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Requirements::meets</span><span class="plain">(</span><span class="reserved">inbuild_edition</span><span class="plain"> *</span><span class="identifier">edition</span><span class="plain">, </span><span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="identifier">req</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">req</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;genre</span><span class="plain">)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;genre</span><span class="plain"> != </span><span class="identifier">edition</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;genre</span><span class="plain">)</span>
                    <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;title</span><span class="plain">) &gt; 0)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::ne_insensitive</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;title</span><span class="plain">, </span><span class="identifier">edition</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;title</span><span class="plain">))</span>
                    <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;author_name</span><span class="plain">) &gt; 0)</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::ne_insensitive</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;author_name</span><span class="plain">, </span><span class="identifier">edition</span><span class="plain">-</span><span class="element">&gt;work</span><span class="plain">-</span><span class="element">&gt;author_name</span><span class="plain">))</span>
                    <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">VersionNumberRanges::in_range</span><span class="plain">(</span><span class="identifier">edition</span><span class="plain">-</span><span class="element">&gt;version</span><span class="plain">, </span><span class="identifier">req</span><span class="plain">-</span><span class="element">&gt;version_range</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Requirements::meets is used in 4/em (<a href="4-em.html#SP6">&#167;6</a>), 4/km (<a href="4-km.html#SP5">&#167;5</a>), 4/lm (<a href="4-lm.html#SP5">&#167;5</a>), 4/pm (<a href="4-pm.html#SP5">&#167;5</a>), 4/tm (<a href="4-tm.html#SP5">&#167;5</a>), 5/es (<a href="5-es.html#SP7">&#167;7</a>), 5/kts (<a href="5-kts.html#SP2">&#167;2</a>), 6/inc (<a href="6-inc.html#SP6">&#167;6</a>), 7/ed2 (<a href="7-ed2.html#SP4">&#167;4</a>).</p>

<hr class="tocbar">
<ul class="toc"><li><a href="2-ce.html">Back to 'Copy Errors'</a></li><li><a href="2-nst.html">Continue with 'Nests'</a></li></ul><hr class="tocbar">
<!--End of weave-->
		</main>
	</body>
</html>

