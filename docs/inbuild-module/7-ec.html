<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>7/ed2</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../webs.html">Sources</a></h1>
<ul>
<li><a href="../compiler.html"><b>compiler tools</b></a></li>
<li><a href="../other.html">other tools</a></li>
<li><a href="../extensions.html">extensions and kits</a></li>
<li><a href="../units.html">unit test tools</a></li>
</ul>
<h2>Compiler Webs</h2>
<ul>
<li><a href="../inbuild/index.html">inbuild</a></li>
<li><a href="../inform7/index.html">inform7</a></li>
<li><a href="../inter/index.html">inter</a></li>
</ul>
<h2>Inbuild Modules</h2>
<ul>
<li><a href="../inbuild-module/index.html">inbuild</a></li>
<li><a href="../arch-module/index.html">arch</a></li>
<li><a href="../words-module/index.html">words</a></li>
<li><a href="../syntax-module/index.html">syntax</a></li>
<li><a href="../html-module/index.html">html</a></li>
</ul>
<h2>Inform7 Modules</h2>
<ul>
<li><a href="../core-module/index.html">core</a></li>
<li><a href="../problems-module/index.html">problems</a></li>
<li><a href="../inflections-module/index.html">inflections</a></li>
<li><a href="../linguistics-module/index.html">linguistics</a></li>
<li><a href="../kinds-module/index.html">kinds</a></li>
<li><a href="../if-module/index.html">if</a></li>
<li><a href="../multimedia-module/index.html">multimedia</a></li>
<li><a href="../index-module/index.html">index</a></li>
</ul>
<h2>Inter Modules</h2>
<ul>
<li><a href="../inter-module/index.html">inter</a></li>
<li><a href="../building-module/index.html">building</a></li>
<li><a href="../codegen-module/index.html">codegen</a></li>
</ul>
<h2>Foundation</h2>
<ul>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>
</ul>


		</nav>
		<main role="main">
		
<!--Weave of '7/ec' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">Source</a></li><li><a href="../compiler.html">Compiler Modules</a></li><li><a href="index.html">inbuild</a></li><li><a href="index.html#7">Chapter 7: Extension Indexing</a></li><li><b>Extension Census</b></li></ul><p class="purpose">To conduct a census of all the extensions installed (whether used on this run or not), and keep the documentation index for them up to date.</p>

<ul class="toc"><li><a href="#SP3_1">&#167;3.1. Adding the extension to the census, or not</a></li><li><a href="#SP9">&#167;9. Icons for virtual machines</a></li><li><a href="#SP10">&#167;10. Displaying VM restrictions</a></li><li><a href="#SP11">&#167;11. Updating the documentation</a></li><li><a href="#SP13">&#167;13. Writing the extensions home pages</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1.  </b></p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">extension_census</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">linked_list</span><span class="plain"> *</span><span class="identifier">search_list</span><span class="plain">; </span><span class="comment">of <code class="display"><span class="extract">inbuild_nest</span></code></span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">linked_list</span><span class="plain"> *</span><span class="identifier">census_data</span><span class="plain">; </span><span class="comment">of <code class="display"><span class="extract">extension_census_datum</span></code></span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">linked_list</span><span class="plain"> *</span><span class="identifier">raw_data</span><span class="plain">; </span><span class="comment">of <code class="display"><span class="extract">inbuild_search_result</span></code></span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">no_census_errors</span><span class="plain">;</span>
        <span class="identifier">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">extension_census</span><span class="plain">;</span>

    <span class="reserved">extension_census</span><span class="plain"> *</span><span class="functiontext">Extensions::Census::new</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">extension_census</span><span class="plain">);</span>
        <span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">search_list</span><span class="plain"> = </span><span class="functiontext">Inbuild::nest_list</span><span class="plain">();</span>
        <span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">census_data</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">extension_census_datum</span><span class="plain">);</span>
        <span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">raw_data</span><span class="plain"> = </span><span class="identifier">NEW_LINKED_LIST</span><span class="plain">(</span><span class="reserved">inbuild_search_result</span><span class="plain">);</span>
        <span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">no_census_errors</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">C</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">pathname</span><span class="plain"> *</span><span class="functiontext">Extensions::Census::internal_path</span><span class="plain">(</span><span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">) {</span>
        <span class="reserved">inbuild_nest</span><span class="plain"> *</span><span class="identifier">N</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">N</span><span class="plain">, </span><span class="reserved">inbuild_nest</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">search_list</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Nests::get_tag</span><span class="plain">(</span><span class="identifier">N</span><span class="plain">) == </span><span class="constant">INTERNAL_NEST_TAG</span><span class="plain">)</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">ExtensionManager::path_within_nest</span><span class="plain">(</span><span class="identifier">N</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">NULL</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">pathname</span><span class="plain"> *</span><span class="functiontext">Extensions::Census::external_path</span><span class="plain">(</span><span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">) {</span>
        <span class="reserved">inbuild_nest</span><span class="plain"> *</span><span class="identifier">N</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">N</span><span class="plain">, </span><span class="reserved">inbuild_nest</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">search_list</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Nests::get_tag</span><span class="plain">(</span><span class="identifier">N</span><span class="plain">) == </span><span class="constant">EXTERNAL_NEST_TAG</span><span class="plain">)</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">ExtensionManager::path_within_nest</span><span class="plain">(</span><span class="identifier">N</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">NULL</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Extensions::Census::new is used in <a href="#SP11">&#167;11</a>.</p>

<p class="endnote">The function Extensions::Census::internal_path is used in <a href="#SP6_1">&#167;6.1</a>, <a href="#SP6_7_2_2">&#167;6.7.2.2</a>.</p>

<p class="endnote">The function Extensions::Census::external_path is used in <a href="#SP6_1">&#167;6.1</a>, <a href="#SP6_7_2_2">&#167;6.7.2.2</a>.</p>

<p class="endnote">The structure extension_census is private to this section.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>In addition to the extensions read in, there are the roads not taken: the
ones which I7 has at its disposal, but which the source text never asks to
include. Inform performs a "census" of installed extensions on every run,
essentially by scanning the directories which hold them to see what the
user has installed there.
</p>

<p class="inwebparagraph">Each extension discovered will produce a single "extension census datum",
or ECD.
</p>

<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">extension_census_datum</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">inbuild_search_result</span><span class="plain"> *</span><span class="identifier">found_as</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">built_in</span><span class="plain">; </span><span class="comment">found in the Inform 7 application's private stock</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">project_specific</span><span class="plain">; </span><span class="comment">found in the Materials folder for the current project</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">overriding_a_built_in_extension</span><span class="plain">; </span><span class="comment">not built in, but overriding one which is</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">next</span><span class="plain">; </span><span class="comment">next one in lexicographic order</span>
        <span class="identifier">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">extension_census_datum</span><span class="plain">;</span>

    <span class="identifier">text_stream</span><span class="plain"> *</span><span class="functiontext">Extensions::Census::ecd_rubric</span><span class="plain">(</span><span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">ecd</span><span class="plain">) {</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">Extensions::get_rubric</span><span class="plain">(</span><span class="functiontext">ExtensionManager::from_copy</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">));</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Extensions::Census::ecd_rubric is used in <a href="#SP6_7_4_1">&#167;6.7.4.1</a>, <a href="#SP6_7_4_4">&#167;6.7.4.4</a>.</p>

<p class="endnote">The structure extension_census_datum is accessed in 6/hdn, 6/inc, 7/ed, 7/ed2 and here.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>This is a narrative section and describes the story of the census. Just as
Caesar Augustus decreed that all the world should be taxed, and that each
should return to his place of birth, so we will open and inspect every
extension we can find, checking that each is in the right place.
</p>

<p class="inwebparagraph">Note that if the same extension is found in more than one domain, the first
to be found is considered the definitive version: this is why the external
area is searched first, so that the user can override built-in extensions
by placing his own versions in the external area. (Should this convention
ever be reversed, a matching change would need to be made in the code which
opens extension files in Read Source Text.)
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::perform</span><span class="plain">(</span><span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">) {</span>
        <span class="reserved">inbuild_requirement</span><span class="plain"> *</span><span class="identifier">req</span><span class="plain"> = </span><span class="functiontext">Requirements::anything_of_genre</span><span class="plain">(</span><span class="identifier">extension_genre</span><span class="plain">);</span>
        <span class="functiontext">Nests::search_for</span><span class="plain">(</span><span class="identifier">req</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">search_list</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">raw_data</span><span class="plain">);</span>

        <span class="reserved">inbuild_search_result</span><span class="plain"> *</span><span class="identifier">R</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">, </span><span class="reserved">inbuild_search_result</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">raw_data</span><span class="plain">) {</span>
            <span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">no_census_errors</span><span class="plain"> += </span><span class="identifier">LinkedLists::len</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">errors_reading_source_text</span><span class="plain">);</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">overridden_by_an_extension_already_found</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
            &lt;<span class="cwebmacro">See if already known from existing data</span> <span class="cwebmacronumber">3.1</span>&gt;<span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">overridden_by_an_extension_already_found</span><span class="plain"> == </span><span class="identifier">FALSE</span><span class="plain">)</span>
                &lt;<span class="cwebmacro">Add to the census data</span> <span class="cwebmacronumber">3.2</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Extensions::Census::perform is used in <a href="#SP11">&#167;11</a>.</p>

<p class="inwebparagraph"><a id="SP3_1"></a><b>&#167;3.1. Adding the extension to the census, or not. </b>Recall that the higher-priority external domain is scanned first; the
built-in domain is scanned second. So if we find that our new extension has
the same title and author as one already known, it must be the case that we
are now scanning the built-in area and that the previous one was an extension
which the user had installed to override this built-in extension.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">See if already known from existing data</span> <span class="cwebmacronumber">3.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">other</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">other</span><span class="plain">, </span><span class="reserved">extension_census_datum</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">census_data</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext">Works::match</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">, </span><span class="identifier">other</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">)) &amp;&amp;</span>
                <span class="plain">((</span><span class="identifier">other</span><span class="plain">-&gt;</span><span class="element">built_in</span><span class="plain">) || (</span><span class="functiontext">Nests::get_tag</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">-&gt;</span><span class="element">nest</span><span class="plain">) == </span><span class="constant">INTERNAL_NEST_TAG</span><span class="plain">))) {</span>
                <span class="identifier">other</span><span class="plain">-&gt;</span><span class="element">overriding_a_built_in_extension</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
                <span class="identifier">overridden_by_an_extension_already_found</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
            <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP3">&#167;3</a>.</p>

<p class="inwebparagraph"><a id="SP3_2"></a><b>&#167;3.2.  </b>Assuming the new extension was not overridden in this way, we come here.
Because we didn't check the version number text for validity, it might
through being invalid be longer than we expect: in case this is so, we
truncate it.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Add to the census data</span> <span class="cwebmacronumber">3.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">ecd</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">extension_census_datum</span><span class="plain">);</span>
        <span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain"> = </span><span class="identifier">R</span><span class="plain">;</span>
        <span class="functiontext">Works::add_to_database</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">, </span><span class="constant">INSTALLED_WDBC</span><span class="plain">);</span>
        <span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">built_in</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Nests::get_tag</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">-&gt;</span><span class="element">nest</span><span class="plain">) == </span><span class="constant">INTERNAL_NEST_TAG</span><span class="plain">) </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">built_in</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">project_specific</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Nests::get_tag</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">-&gt;</span><span class="element">nest</span><span class="plain">) == </span><span class="constant">MATERIALS_NEST_TAG</span><span class="plain">) </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">project_specific</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">overriding_a_built_in_extension</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
        <span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">next</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP3">&#167;3</a>.</p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4.  </b>And this is where the inclusion of that material into the catalogue is
taken care of. First, we sometimes position a warning prominently at the
top of the listing, because otherwise its position at the bottom will be
invisible unless the user scrolls a long way:
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::warn_about_census_errors</span><span class="plain">(</span><span class="identifier">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">no_census_errors</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain">; </span><span class="comment">no need for a warning</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">NUMBER_CREATED</span><span class="plain">(</span><span class="reserved">extension_census_datum</span><span class="plain">) &lt; </span><span class="constant">20</span><span class="plain">) </span><span class="reserved">return</span><span class="plain">; </span><span class="comment">it's a short page anyway</span>
        <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
        <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"border=0 src=inform:/doc_images/misinstalled.png"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;"</span>
            <span class="string">"&lt;b&gt;Warning&lt;/b&gt;. One or more extensions are installed incorrectly: "</span>
            <span class="string">"see details below."</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
    <span class="plain"> }</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Extensions::Census::warn_about_census_errors is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5.  </b></p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::transcribe_census_errors</span><span class="plain">(</span><span class="identifier">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">no_census_errors</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain">; </span><span class="comment">nothing to include, then</span>
        &lt;<span class="cwebmacro">Include the headnote explaining what census errors are</span> <span class="cwebmacronumber">5.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">inbuild_search_result</span><span class="plain"> *</span><span class="identifier">R</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">, </span><span class="reserved">inbuild_search_result</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="element">raw_data</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">LinkedLists::len</span><span class="plain">(</span><span class="identifier">R</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">errors_reading_source_text</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) {</span>
                <span class="reserved">copy_error</span><span class="plain"> *</span><span class="identifier">CE</span><span class="plain">;</span>
                <span class="identifier">LOOP_OVER_LINKED_LIST</span><span class="plain">(</span><span class="identifier">CE</span><span class="plain">, </span><span class="reserved">copy_error</span><span class="plain">, </span><span class="identifier">R</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">errors_reading_source_text</span><span class="plain">) {</span>
                    <span class="plain">#</span><span class="identifier">ifdef</span><span class="plain"> </span><span class="identifier">INDEX_MODULE</span>
                    <span class="identifier">HTMLFiles::open_para</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">2</span><span class="plain">, </span><span class="string">"hanging"</span><span class="plain">);</span>
                    <span class="plain">#</span><span class="identifier">endif</span>
                    <span class="plain">#</span><span class="identifier">ifndef</span><span class="plain"> </span><span class="identifier">INDEX_MODULE</span>
                    <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
                    <span class="plain">#</span><span class="identifier">endif</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&lt;b&gt;%X&lt;/b&gt; - "</span><span class="plain">, </span><span class="identifier">R</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">);</span>
                    <span class="functiontext">CopyErrors::write</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">CE</span><span class="plain">);</span>
                    <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Extensions::Census::transcribe_census_errors is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP5_1"></a><b>&#167;5.1.  </b>We only want to warn people here: not to stop them from using Inform
until they put matters right. (Suppose, for instance, they are using an
account not giving them sufficient privileges to modify files in the external
extensions area: they'd then be locked out if anything was amiss there.)
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Include the headnote explaining what census errors are</span> <span class="cwebmacronumber">5.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">HTML_TAG</span><span class="plain">(</span><span class="string">"hr"</span><span class="plain">);</span>
        <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
        <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"border=0 align=\"left\" src=inform:/doc_images/census_problem.png"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&lt;b&gt;Warning&lt;/b&gt;. Inform checks the folder of user-installed extensions "</span>
            <span class="string">"each time it translates the source text, in order to keep this directory "</span>
            <span class="string">"page up to date. Each file must be a properly labelled extension (with "</span>
            <span class="string">"its titling line correctly identifying itself), and must be in the right "</span>
            <span class="string">"place - e.g. 'Marbles by Daphne Quilt' must have the filename 'Marbles.i7x' "</span>
            <span class="string">"(or just 'Marbles' with no file extension) and be stored in the folder "</span>
            <span class="string">"'Daphne Quilt'. The title should be at most %d characters long; the "</span>
            <span class="string">"author name, %d. At the last check, these rules were not being followed:"</span><span class="plain">,</span>
                <span class="constant">MAX_EXTENSION_TITLE_LENGTH</span><span class="plain">, </span><span class="constant">MAX_EXTENSION_AUTHOR_LENGTH</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP5">&#167;5</a>.</p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6.  </b>Here we write the copy for the directory page of the extensions
documentation: the one which the user currently sees by clicking on the
"Installed Extensions" link from the contents page of the documentation.
It contains an alphabetised catalogue of extensions by author and then
title, along with some useful information about them, and then a list of
any oddities found in the external extensions area.
</p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">SORT_CE_BY_TITLE</span><span class="plain"> </span><span class="constant">1</span>
    <span class="definitionkeyword">define</span> <span class="constant">SORT_CE_BY_AUTHOR</span><span class="plain"> </span><span class="constant">2</span>
    <span class="definitionkeyword">define</span> <span class="constant">SORT_CE_BY_INSTALL</span><span class="plain"> </span><span class="constant">3</span>
    <span class="definitionkeyword">define</span> <span class="constant">SORT_CE_BY_DATE</span><span class="plain"> </span><span class="constant">4</span>
    <span class="definitionkeyword">define</span> <span class="constant">SORT_CE_BY_LENGTH</span><span class="plain"> </span><span class="constant">5</span>
</pre>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::write_results</span><span class="plain">(</span><span class="identifier">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">) {</span>
        &lt;<span class="cwebmacro">Display the location of installed extensions</span> <span class="cwebmacronumber">6.1</span>&gt;<span class="plain">;</span>
        <span class="functiontext">Extensions::Census::warn_about_census_errors</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">);</span>
        <span class="identifier">HTML::end_html_row</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
        <span class="identifier">HTML::end_html_table</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
        <span class="identifier">HTML_TAG</span><span class="plain">(</span><span class="string">"hr"</span><span class="plain">);</span>
        &lt;<span class="cwebmacro">Time stamp the extensions used on this run</span> <span class="cwebmacronumber">6.2</span>&gt;<span class="plain">;</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">key_vms</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">, </span><span class="identifier">key_override</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">, </span><span class="identifier">key_builtin</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">,</span>
            <span class="identifier">key_pspec</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">, </span><span class="identifier">key_bullet</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>

        &lt;<span class="cwebmacro">Display the census radio buttons</span> <span class="cwebmacronumber">6.3</span>&gt;<span class="plain">;</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">no_entries</span><span class="plain"> = </span><span class="identifier">NUMBER_CREATED</span><span class="plain">(</span><span class="reserved">extension_census_datum</span><span class="plain">);</span>
        <span class="reserved">extension_census_datum</span><span class="plain"> **</span><span class="identifier">sorted_census_results</span><span class="plain"> = </span><span class="identifier">Memory::I7_calloc</span><span class="plain">(</span><span class="identifier">no_entries</span><span class="plain">,</span>
            <span class="reserved">sizeof</span><span class="plain">(</span><span class="reserved">extension_census_datum</span><span class="plain"> *), </span><span class="constant">EXTENSION_DICTIONARY_MREASON</span><span class="plain">);</span>

        <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">d</span><span class="plain">=1; </span><span class="identifier">d</span><span class="plain">&lt;=5; </span><span class="identifier">d</span><span class="plain">++) {</span>
            &lt;<span class="cwebmacro">Start an HTML division for this sorted version of the census</span> <span class="cwebmacronumber">6.4</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Sort the census into the appropriate order</span> <span class="cwebmacronumber">6.6</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Display the sorted version of the census</span> <span class="cwebmacronumber">6.7</span>&gt;<span class="plain">;</span>
            <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"div"</span><span class="plain">);</span>
        <span class="plain">}</span>
        &lt;<span class="cwebmacro">Print the key to any symbols used in the census lines</span> <span class="cwebmacronumber">6.5</span>&gt;<span class="plain">;</span>
        <span class="functiontext">Extensions::Census::transcribe_census_errors</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">);</span>
        <span class="identifier">Memory::I7_array_free</span><span class="plain">(</span><span class="identifier">sorted_census_results</span><span class="plain">, </span><span class="constant">EXTENSION_DICTIONARY_MREASON</span><span class="plain">,</span>
            <span class="identifier">no_entries</span><span class="plain">, </span><span class="reserved">sizeof</span><span class="plain">(</span><span class="reserved">extension_census_datum</span><span class="plain"> *));</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Extensions::Census::write_results is used in <a href="#SP15">&#167;15</a>.</p>

<p class="inwebparagraph"><a id="SP6_1"></a><b>&#167;6.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Display the location of installed extensions</span> <span class="cwebmacronumber">6.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">nps</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">, </span><span class="identifier">nbi</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">, </span><span class="identifier">ni</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">ecd</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">, </span><span class="reserved">extension_census_datum</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">project_specific</span><span class="plain">) </span><span class="identifier">nps</span><span class="plain">++;</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">built_in</span><span class="plain">) </span><span class="identifier">nbi</span><span class="plain">++;</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="identifier">ni</span><span class="plain">++;</span>
        <span class="plain">}</span>

        <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
        <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"src='inform:/doc_images/builtin_ext.png' border=0"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;You have "</span>
            <span class="string">"%d extensions built-in to this copy of Inform, marked with a grey folder "</span>
            <span class="string">"icon in the catalogue below."</span><span class="plain">,</span>
            <span class="identifier">nbi</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
        <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ni</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"src='inform:/doc_images/folder4.png' border=0"</span><span class="plain">);</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;You have no other extensions installed at present."</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="plain">#</span><span class="identifier">ifdef</span><span class="plain"> </span><span class="identifier">INDEX_MODULE</span>
            <span class="identifier">HTML::Javascript::open_file</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="functiontext">Extensions::Census::external_path</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">), </span><span class="identifier">NULL</span><span class="plain">,</span>
                <span class="string">"src='inform:/doc_images/folder4.png' border=0"</span><span class="plain">);</span>
            <span class="plain">#</span><span class="identifier">endif</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;You have %d further extension%s installed. These are marked "</span>
                <span class="string">"with a blue folder icon in the catalogue below. (Click it to see "</span>
                <span class="string">"where the file is stored on your computer.) "</span>
                <span class="string">"For more extensions, visit &lt;b&gt;www.inform7.com&lt;/b&gt;."</span><span class="plain">,</span>
                <span class="identifier">ni</span><span class="plain">, (</span><span class="identifier">ni</span><span class="plain">==1)?</span><span class="string">""</span><span class="plain">:</span><span class="string">"s"</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">nps</span><span class="plain"> &gt; </span><span class="constant">0</span><span class="plain">) {</span>
            <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
            <span class="plain">#</span><span class="identifier">ifdef</span><span class="plain"> </span><span class="identifier">INDEX_MODULE</span>
            <span class="identifier">HTML::Javascript::open_file</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="functiontext">Extensions::Census::internal_path</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">), </span><span class="identifier">NULL</span><span class="plain">, </span><span class="constant">PROJECT_SPECIFIC_SYMBOL</span><span class="plain">);</span>
            <span class="plain">#</span><span class="identifier">endif</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;You have %d extension%s in the .materials folder for the "</span>
                <span class="string">"current project. (Click the purple folder icon to show the "</span>
                <span class="string">"location.) %s not available to other projects."</span><span class="plain">,</span>
                <span class="identifier">nps</span><span class="plain">, (</span><span class="identifier">nps</span><span class="plain">==1)?</span><span class="string">""</span><span class="plain">:</span><span class="string">"s"</span><span class="plain">, (</span><span class="identifier">nps</span><span class="plain">==1)?</span><span class="string">"This is"</span><span class="plain">:</span><span class="string">"These are"</span><span class="plain">);</span>
            <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_2"></a><b>&#167;6.2.  </b>This simply ensures that dates used are updated to today's date for
extensions used in the current run; otherwise they wouldn't show in the
documentation as used today until the next run, for obscure timing reasons.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Time stamp the extensions used on this run</span> <span class="cwebmacronumber">6.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="plain">#</span><span class="identifier">ifdef</span><span class="plain"> </span><span class="identifier">CORE_MODULE</span>
        <span class="reserved">inform_extension</span><span class="plain"> *</span><span class="identifier">E</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">E</span><span class="plain">, </span><span class="reserved">inform_extension</span><span class="plain">)</span>
            <span class="functiontext">Extensions::Dictionary::time_stamp</span><span class="plain">(</span><span class="identifier">E</span><span class="plain">);</span>
        <span class="plain">#</span><span class="identifier">endif</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_3"></a><b>&#167;6.3.  </b>I am the first to admit that this implementation is not inspired. There
are five radio buttons, and number 2 is selected by default.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Display the census radio buttons</span> <span class="cwebmacronumber">6.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Sort catalogue: "</span><span class="plain">);</span>
        <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"a"</span><span class="plain">,</span>
            <span class="string">"href=\"#\" style=\"text-decoration: none\" "</span>
            <span class="string">"onclick=\"openExtra('disp1', 'plus1'); closeExtra('disp2', 'plus2'); "</span>
            <span class="string">"closeExtra('disp3', 'plus3'); closeExtra('disp4', 'plus4'); "</span>
            <span class="string">"closeExtra('disp5', 'plus5'); return false;\""</span><span class="plain">);</span>
        <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"border=0 id=\"plus1\" src=inform:/doc_images/extrarboff.png"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;By title"</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"a"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" | "</span><span class="plain">);</span>
        <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"a"</span><span class="plain">,</span>
            <span class="string">"href=\"#\" style=\"text-decoration: none\" "</span>
            <span class="string">"onclick=\"closeExtra('disp1', 'plus1'); openExtra('disp2', 'plus2'); "</span>
            <span class="string">"closeExtra('disp3', 'plus3'); closeExtra('disp4', 'plus4'); "</span>
            <span class="string">"closeExtra('disp5', 'plus5'); return false;\""</span><span class="plain">);</span>
        <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"border=0 id=\"plus2\" src=inform:/doc_images/extrarbon.png"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;By author"</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"a"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" | "</span><span class="plain">);</span>
        <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"a"</span><span class="plain">,</span>
            <span class="string">"href=\"#\" style=\"text-decoration: none\" "</span>
            <span class="string">"onclick=\"closeExtra('disp1', 'plus1'); closeExtra('disp2', 'plus2'); "</span>
            <span class="string">"openExtra('disp3', 'plus3'); closeExtra('disp4', 'plus4'); "</span>
            <span class="string">"closeExtra('disp5', 'plus5'); return false;\""</span><span class="plain">);</span>
        <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"border=0 id=\"plus3\" src=inform:/doc_images/extrarboff.png"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;By installation"</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"a"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" | "</span><span class="plain">);</span>
        <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"a"</span><span class="plain">,</span>
            <span class="string">"href=\"#\" style=\"text-decoration: none\" "</span>
            <span class="string">"onclick=\"closeExtra('disp1', 'plus1'); closeExtra('disp2', 'plus2'); "</span>
            <span class="string">"closeExtra('disp3', 'plus3'); openExtra('disp4', 'plus4'); "</span>
            <span class="string">"closeExtra('disp5', 'plus5'); return false;\""</span><span class="plain">);</span>
        <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"border=0 id=\"plus4\" src=inform:/doc_images/extrarboff.png"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;By date used"</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"a"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" | "</span><span class="plain">);</span>
        <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"a"</span><span class="plain">,</span>
            <span class="string">"href=\"#\" style=\"text-decoration: none\" "</span>
            <span class="string">"onclick=\"closeExtra('disp1', 'plus1'); closeExtra('disp2', 'plus2'); "</span>
            <span class="string">"closeExtra('disp3', 'plus3'); closeExtra('disp4', 'plus4'); "</span>
            <span class="string">"openExtra('disp5', 'plus5'); return false;\""</span><span class="plain">);</span>
        <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"border=0 id=\"plus5\" src=inform:/doc_images/extrarboff.png"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;By word count"</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"a"</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_4"></a><b>&#167;6.4.  </b>Consequently, of the five divisions, number 2 is shown and the others
hidden, by default.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Start an HTML division for this sorted version of the census</span> <span class="cwebmacronumber">6.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">char</span><span class="plain"> *</span><span class="identifier">display</span><span class="plain"> = </span><span class="string">"none"</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">d</span><span class="plain"> == </span><span class="constant">SORT_CE_BY_AUTHOR</span><span class="plain">) </span><span class="identifier">display</span><span class="plain"> = </span><span class="string">"block"</span><span class="plain">;</span>
        <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"div"</span><span class="plain">, </span><span class="string">"id=\"disp%d\" style=\"display: %s;\""</span><span class="plain">, </span><span class="identifier">d</span><span class="plain">, </span><span class="identifier">display</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_5"></a><b>&#167;6.5.  </b>The key at the foot only explicates those symbols actually used, and
doesn't explicate the "unindexed" symbol at all, since that's actually
just a blank image used for horizontal spacing to keep margins straight.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Print the key to any symbols used in the census lines</span> <span class="cwebmacronumber">6.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">key_builtin</span><span class="plain">) || (</span><span class="identifier">key_override</span><span class="plain">) || (</span><span class="identifier">key_bullet</span><span class="plain">) || (</span><span class="identifier">key_vms</span><span class="plain">) || (</span><span class="identifier">key_pspec</span><span class="plain">)) {</span>
            <span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Key: "</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">key_bullet</span><span class="plain">) {</span>
                <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"%s"</span><span class="plain">, </span><span class="constant">INDEXED_SYMBOL</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" Used&amp;nbsp;"</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">key_builtin</span><span class="plain">) {</span>
                <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"%s"</span><span class="plain">, </span><span class="constant">BUILT_IN_SYMBOL</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" Built in&amp;nbsp;"</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">key_pspec</span><span class="plain">) {</span>
                <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"%s"</span><span class="plain">, </span><span class="constant">PROJECT_SPECIFIC_SYMBOL</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" Project specific&amp;nbsp;"</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">key_override</span><span class="plain">) {</span>
                <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"%s"</span><span class="plain">, </span><span class="constant">OVERRIDING_SYMBOL</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" Your version overrides the one built in&amp;nbsp;"</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">key_vms</span><span class="plain">) {</span>
                <span class="plain">#</span><span class="identifier">ifdef</span><span class="plain"> </span><span class="identifier">CORE_MODULE</span>
                <span class="identifier">HTML_TAG</span><span class="plain">(</span><span class="string">"br"</span><span class="plain">);</span>
                <span class="functiontext">Extensions::Census::write_key</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
                <span class="plain">#</span><span class="identifier">endif</span>
            <span class="plain">}</span>
            <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_6"></a><b>&#167;6.6.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Sort the census into the appropriate order</span> <span class="cwebmacronumber">6.6</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">ecd</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">, </span><span class="reserved">extension_census_datum</span><span class="plain">)</span>
            <span class="identifier">sorted_census_results</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">++] = </span><span class="identifier">ecd</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> (*</span><span class="identifier">criterion</span><span class="plain">)(</span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *, </span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *) = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">d</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SORT_CE_BY_TITLE:</span><span class="plain"> </span><span class="identifier">criterion</span><span class="plain"> = </span><span class="functiontext">Extensions::Census::compare_ecd_by_title</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SORT_CE_BY_AUTHOR:</span><span class="plain"> </span><span class="identifier">criterion</span><span class="plain"> = </span><span class="functiontext">Extensions::Census::compare_ecd_by_author</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SORT_CE_BY_INSTALL:</span><span class="plain"> </span><span class="identifier">criterion</span><span class="plain"> = </span><span class="functiontext">Extensions::Census::compare_ecd_by_installation</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SORT_CE_BY_DATE:</span><span class="plain"> </span><span class="identifier">criterion</span><span class="plain"> = </span><span class="functiontext">Extensions::Census::compare_ecd_by_date</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SORT_CE_BY_LENGTH:</span><span class="plain"> </span><span class="identifier">criterion</span><span class="plain"> = </span><span class="functiontext">Extensions::Census::compare_ecd_by_length</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="identifier">default:</span><span class="plain"> </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"no such sorting criterion"</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="identifier">qsort</span><span class="plain">(</span><span class="identifier">sorted_census_results</span><span class="plain">, (</span><span class="identifier">size_t</span><span class="plain">) </span><span class="identifier">no_entries</span><span class="plain">, </span><span class="reserved">sizeof</span><span class="plain">(</span><span class="reserved">extension_census_datum</span><span class="plain"> *),</span>
            <span class="identifier">criterion</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_7"></a><b>&#167;6.7.  </b>Standard rows have black text on striped background colours, these being
the usual ones seen in Mac OS X applications such as iTunes.
</p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">FIRST_STRIPE_COLOUR</span><span class="plain"> </span><span class="string">"#ffffff"</span>
    <span class="definitionkeyword">define</span> <span class="constant">SECOND_STRIPE_COLOUR</span><span class="plain"> </span><span class="string">"#f3f6fa"</span>
</pre>

<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Display the sorted version of the census</span> <span class="cwebmacronumber">6.7</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">HTML::begin_html_table</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">FIRST_STRIPE_COLOUR</span><span class="plain">, </span><span class="identifier">TRUE</span><span class="plain">, </span><span class="constant">0</span><span class="plain">, </span><span class="constant">0</span><span class="plain">, </span><span class="constant">2</span><span class="plain">, </span><span class="constant">0</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>
        &lt;<span class="cwebmacro">Show a titling row explaining the census sorting, if necessary</span> <span class="cwebmacronumber">6.7.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">stripe</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">current_author_name</span><span class="plain">);</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">, </span><span class="identifier">current_installation</span><span class="plain"> = -1;</span>
        <span class="reserved">for</span><span class="plain"> (</span><span class="identifier">i</span><span class="plain">=0; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">no_entries</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) {</span>
            <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">ecd</span><span class="plain"> = </span><span class="identifier">sorted_census_results</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">];</span>
            &lt;<span class="cwebmacro">Insert a subtitling row in the census sorting, if necessary</span> <span class="cwebmacronumber">6.7.2</span>&gt;<span class="plain">;</span>
            <span class="identifier">stripe</span><span class="plain"> = </span><span class="constant">1</span><span class="plain"> - </span><span class="identifier">stripe</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">stripe</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">)</span>
                <span class="identifier">HTML::first_html_column_coloured</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">0</span><span class="plain">, </span><span class="constant">SECOND_STRIPE_COLOUR</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>
            <span class="reserved">else</span>
                <span class="identifier">HTML::first_html_column_coloured</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">0</span><span class="plain">, </span><span class="constant">FIRST_STRIPE_COLOUR</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>
            &lt;<span class="cwebmacro">Print the census line for this extension</span> <span class="cwebmacronumber">6.7.4</span>&gt;<span class="plain">;</span>
            <span class="identifier">HTML::end_html_row</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">current_author_name</span><span class="plain">);</span>
        &lt;<span class="cwebmacro">Show a final titling row closing the census sorting</span> <span class="cwebmacronumber">6.7.3</span>&gt;<span class="plain">;</span>
        <span class="identifier">HTML::end_html_table</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6">&#167;6</a>.</p>

<p class="inwebparagraph"><a id="SP6_7_1"></a><b>&#167;6.7.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Show a titling row explaining the census sorting, if necessary</span> <span class="cwebmacronumber">6.7.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">d</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SORT_CE_BY_TITLE:</span>
                &lt;<span class="cwebmacro">Begin a tinted census line</span> <span class="cwebmacronumber">6.7.1.1</span>&gt;<span class="plain">;</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Extensions in alphabetical order"</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">End a tinted census line</span> <span class="cwebmacronumber">6.7.1.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SORT_CE_BY_DATE:</span>
                &lt;<span class="cwebmacro">Begin a tinted census line</span> <span class="cwebmacronumber">6.7.1.1</span>&gt;<span class="plain">;</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Extensions in order of date used (most recent first)"</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">End a tinted census line</span> <span class="cwebmacronumber">6.7.1.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">SORT_CE_BY_LENGTH:</span>
                &lt;<span class="cwebmacro">Begin a tinted census line</span> <span class="cwebmacronumber">6.7.1.1</span>&gt;<span class="plain">;</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Extensions in order of word count (longest first)"</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">End a tinted census line</span> <span class="cwebmacronumber">6.7.1.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6_7">&#167;6.7</a>.</p>

<p class="inwebparagraph"><a id="SP6_7_2"></a><b>&#167;6.7.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Insert a subtitling row in the census sorting, if necessary</span> <span class="cwebmacronumber">6.7.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">d</span><span class="plain"> == </span><span class="constant">SORT_CE_BY_AUTHOR</span><span class="plain">) &amp;&amp;</span>
            <span class="plain">(</span><span class="identifier">Str::ne</span><span class="plain">(</span><span class="identifier">current_author_name</span><span class="plain">, </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">-&gt;</span><span class="element">author_name</span><span class="plain">))) {</span>
            <span class="identifier">Str::copy</span><span class="plain">(</span><span class="identifier">current_author_name</span><span class="plain">, </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">-&gt;</span><span class="element">author_name</span><span class="plain">);</span>
            &lt;<span class="cwebmacro">Begin a tinted census line</span> <span class="cwebmacronumber">6.7.1.1</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Print the author's line in the extension census table</span> <span class="cwebmacronumber">6.7.2.1</span>&gt;<span class="character">;</span>
            &lt;<span class="cwebmacro">End a tinted census line</span> <span class="cwebmacronumber">6.7.1.2</span>&gt;<span class="plain">;</span>
            <span class="identifier">stripe</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">d</span><span class="plain"> == </span><span class="constant">SORT_CE_BY_INSTALL</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Extensions::Census::installation_region</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">) != </span><span class="identifier">current_installation</span><span class="plain">)) {</span>
            <span class="identifier">current_installation</span><span class="plain"> = </span><span class="functiontext">Extensions::Census::installation_region</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">);</span>
            &lt;<span class="cwebmacro">Begin a tinted census line</span> <span class="cwebmacronumber">6.7.1.1</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Print the installation region in the extension census table</span> <span class="cwebmacronumber">6.7.2.2</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">End a tinted census line</span> <span class="cwebmacronumber">6.7.1.2</span>&gt;<span class="plain">;</span>
            <span class="identifier">stripe</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6_7">&#167;6.7</a>.</p>

<p class="inwebparagraph"><a id="SP6_7_3"></a><b>&#167;6.7.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Show a final titling row closing the census sorting</span> <span class="cwebmacronumber">6.7.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        &lt;<span class="cwebmacro">Begin a tinted census line</span> <span class="cwebmacronumber">6.7.1.1</span>&gt;<span class="plain">;</span>
        <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">, </span><span class="string">"class=\"smaller\""</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%d extensions installed"</span><span class="plain">, </span><span class="identifier">no_entries</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">);</span>
        &lt;<span class="cwebmacro">End a tinted census line</span> <span class="cwebmacronumber">6.7.1.2</span>&gt;<span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6_7">&#167;6.7</a>.</p>

<p class="inwebparagraph"><a id="SP6_7_1_1"></a><b>&#167;6.7.1.1.  </b>Black text on a grey background.
</p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">CENSUS_TITLING_BG</span><span class="plain"> </span><span class="string">"#808080"</span>
</pre>

<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Begin a tinted census line</span> <span class="cwebmacronumber">6.7.1.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">span</span><span class="plain"> = </span><span class="constant">4</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">d</span><span class="plain"> == </span><span class="constant">SORT_CE_BY_TITLE</span><span class="plain">) </span><span class="identifier">span</span><span class="plain"> = </span><span class="constant">3</span><span class="plain">;</span>
        <span class="identifier">HTML::first_html_column_coloured</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">0</span><span class="plain">, </span><span class="constant">CENSUS_TITLING_BG</span><span class="plain">, </span><span class="identifier">span</span><span class="plain">);</span>
        <span class="identifier">HTML::begin_colour</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"ffffff"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;"</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6_7_1">&#167;6.7.1</a> (three times), <a href="#SP6_7_2">&#167;6.7.2</a> (twice), <a href="#SP6_7_3">&#167;6.7.3</a>.</p>

<p class="inwebparagraph"><a id="SP6_7_1_2"></a><b>&#167;6.7.1.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">End a tinted census line</span> <span class="cwebmacronumber">6.7.1.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">HTML::end_colour</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
        <span class="identifier">HTML::end_html_row</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6_7_1">&#167;6.7.1</a> (three times), <a href="#SP6_7_2">&#167;6.7.2</a> (twice), <a href="#SP6_7_3">&#167;6.7.3</a>.</p>

<p class="inwebparagraph"><a id="SP6_7_2_1"></a><b>&#167;6.7.2.1.  </b>Used only in "by author".
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Print the author's line in the extension census table</span> <span class="cwebmacronumber">6.7.2.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="identifier">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">-&gt;</span><span class="element">raw_author_name</span><span class="plain">);</span>

        <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">ecd2</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">cu</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">, </span><span class="identifier">cn</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">, </span><span class="identifier">j</span><span class="plain">;</span>
        <span class="reserved">for</span><span class="plain"> (</span><span class="identifier">j</span><span class="plain"> = </span><span class="identifier">i</span><span class="plain">; </span><span class="identifier">j</span><span class="plain"> &lt; </span><span class="identifier">no_entries</span><span class="plain">; </span><span class="identifier">j</span><span class="plain">++) {</span>
            <span class="identifier">ecd2</span><span class="plain"> = </span><span class="identifier">sorted_census_results</span><span class="plain">[</span><span class="identifier">j</span><span class="plain">];</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::ne</span><span class="plain">(</span><span class="identifier">current_author_name</span><span class="plain">, </span><span class="identifier">ecd2</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">-&gt;</span><span class="element">author_name</span><span class="plain">)) </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Extensions::Census::ecd_used</span><span class="plain">(</span><span class="identifier">ecd2</span><span class="plain">)) </span><span class="identifier">cu</span><span class="plain">++;</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="identifier">cn</span><span class="plain">++;</span>
        <span class="plain">}</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;&amp;nbsp;"</span><span class="plain">);</span>
        <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">, </span><span class="string">"class=\"smaller\""</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%d extension%s"</span><span class="plain">, </span><span class="identifier">cu</span><span class="plain">+</span><span class="identifier">cn</span><span class="plain">, (</span><span class="identifier">cu</span><span class="plain">+</span><span class="identifier">cn</span><span class="plain">==1)?</span><span class="string">""</span><span class="plain">:</span><span class="string">"s"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">cu</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="identifier">cn</span><span class="plain"> == </span><span class="constant">1</span><span class="plain">)) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">", unused"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">cu</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="identifier">cn</span><span class="plain"> == </span><span class="constant">2</span><span class="plain">)) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">", both unused"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">cu</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="identifier">cn</span><span class="plain"> &gt; </span><span class="constant">2</span><span class="plain">)) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">", all unused"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">cn</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="identifier">cu</span><span class="plain"> == </span><span class="constant">1</span><span class="plain">)) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">", used"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">cn</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="identifier">cu</span><span class="plain"> == </span><span class="constant">2</span><span class="plain">)) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">", both used"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">cn</span><span class="plain"> == </span><span class="constant">0</span><span class="plain">) &amp;&amp; (</span><span class="identifier">cu</span><span class="plain"> &gt; </span><span class="constant">2</span><span class="plain">)) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">", all used"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">cn</span><span class="plain">+</span><span class="identifier">cu</span><span class="plain"> &gt; </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">", %d used, %d unused"</span><span class="plain">, </span><span class="identifier">cu</span><span class="plain">, </span><span class="identifier">cn</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">")"</span><span class="plain">);</span>
        <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6_7_2">&#167;6.7.2</a>.</p>

<p class="inwebparagraph"><a id="SP6_7_2_2"></a><b>&#167;6.7.2.2.  </b>Used only in "by installation".
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Print the installation region in the extension census table</span> <span class="cwebmacronumber">6.7.2.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">current_installation</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">0</span><span class="plain">:</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Supplied in the .materials folder&amp;nbsp;&amp;nbsp;"</span><span class="plain">);</span>
                <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">, </span><span class="string">"class=\"smaller\""</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%p"</span><span class="plain">, </span><span class="functiontext">Extensions::Census::internal_path</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">));</span>
                <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">1</span><span class="plain">: </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Built in to Inform"</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">2</span><span class="plain">: </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"User installed but overriding a built-in extension"</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">3</span><span class="plain">:</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"User installed&amp;nbsp;&amp;nbsp;"</span><span class="plain">);</span>
                <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">, </span><span class="string">"class=\"smaller\""</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%p"</span><span class="plain">, </span><span class="functiontext">Extensions::Census::external_path</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">));</span>
                <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP6_7_2">&#167;6.7.2</a>.</p>

<p class="inwebparagraph"><a id="SP6_7_4"></a><b>&#167;6.7.4.  </b></p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">UNINDEXED_SYMBOL</span><span class="plain"> </span><span class="string">"border=\"0\" src=\"inform:/doc_images/unindexed_bullet.png\""</span>
    <span class="definitionkeyword">define</span> <span class="constant">INDEXED_SYMBOL</span><span class="plain"> </span><span class="string">"border=\"0\" src=\"inform:/doc_images/indexed_bullet.png\""</span>

    <p class="macrodefinition"><code class="display">
    &lt;<span class="cwebmacrodefn">Print the census line for this extension</span> <span class="cwebmacronumber">6.7.4</span>&gt; =
    </code></p>


    <pre class="displaydefn">
            &lt;<span class="cwebmacro">Print column 1 of the census line</span> <span class="cwebmacronumber">6.7.4.1</span>&gt;<span class="plain">;</span>
            <span class="identifier">HTML::next_html_column_nw</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">d</span><span class="plain"> != </span><span class="constant">SORT_CE_BY_TITLE</span><span class="plain">) {</span>
                &lt;<span class="cwebmacro">Print column 2 of the census line</span> <span class="cwebmacronumber">6.7.4.2</span>&gt;<span class="plain">;</span>
                <span class="identifier">HTML::next_html_column_nw</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>
            <span class="plain">}</span>
            &lt;<span class="cwebmacro">Print column 3 of the census line</span> <span class="cwebmacronumber">6.7.4.3</span>&gt;<span class="plain">;</span>
            <span class="identifier">HTML::next_html_column_w</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>
            &lt;<span class="cwebmacro">Print column 4 of the census line</span> <span class="cwebmacronumber">6.7.4.4</span>&gt;<span class="plain">;</span>
    </pre>

    <p class="inwebparagraph"></p>

    <p class="endnote">This code is used in <a href="#SP6_7">&#167;6.7</a>.</p>

    <p class="inwebparagraph"><a id="SP6_7_4_1"></a><b>&#167;6.7.4.1.  </b>The appearance of the line is
    </p>

    <blockquote>
        <p>(bullet) The Title (by The Author) (VM requirement icons)</p>

    </blockquote>

    <p class="inwebparagraph">where all is optional except the title part.
    </p>


    <p class="macrodefinition"><code class="display">
    &lt;<span class="cwebmacrodefn">Print column 1 of the census line</span> <span class="cwebmacronumber">6.7.4.1</span>&gt; =
    </code></p>


    <pre class="displaydefn">
            <span class="reserved">char</span><span class="plain"> *</span><span class="identifier">bulletornot</span><span class="plain"> = </span><span class="constant">UNINDEXED_SYMBOL</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Extensions::Census::ecd_used</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">)) { </span><span class="identifier">bulletornot</span><span class="plain"> = </span><span class="constant">INDEXED_SYMBOL</span><span class="plain">; </span><span class="identifier">key_bullet</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">; }</span>
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;"</span><span class="plain">);</span>
            <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"%s"</span><span class="plain">, </span><span class="identifier">bulletornot</span><span class="plain">);</span>

            <span class="functiontext">Works::begin_extension_link</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">, </span><span class="functiontext">Extensions::Census::ecd_rubric</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">));</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">d</span><span class="plain"> != </span><span class="constant">SORT_CE_BY_AUTHOR</span><span class="plain">) {</span>
                <span class="identifier">HTML::begin_colour</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"404040"</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="identifier">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">-&gt;</span><span class="element">raw_title</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">-&gt;</span><span class="element">raw_title</span><span class="plain">) + </span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">-&gt;</span><span class="element">raw_author_name</span><span class="plain">) &gt; </span><span class="constant">45</span><span class="plain">) {</span>
                    <span class="identifier">HTML_TAG</span><span class="plain">(</span><span class="string">"br"</span><span class="plain">);</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;"</span><span class="plain">);</span>
                <span class="plain">} </span><span class="reserved">else</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">" "</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"by %S"</span><span class="plain">, </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">-&gt;</span><span class="element">raw_author_name</span><span class="plain">);</span>
                <span class="identifier">HTML::end_colour</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                <span class="identifier">HTML::begin_colour</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"404040"</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="identifier">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">-&gt;</span><span class="element">raw_title</span><span class="plain">);</span>
                <span class="identifier">HTML::end_colour</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
            <span class="plain">}</span>
            <span class="functiontext">Works::end_extension_link</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">);</span>

            <span class="identifier">compatibility_specification</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain"> = </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">compatibility</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="identifier">parsed_from</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) {</span>
                &lt;<span class="cwebmacro">Append icons which signify the VM requirements of the extension</span> <span class="cwebmacronumber">6.7.4.1.1</span>&gt;<span class="plain">;</span>
                <span class="identifier">key_vms</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
            <span class="plain">}</span>
    </pre>

    <p class="inwebparagraph"></p>

    <p class="endnote">This code is used in <a href="#SP6_7_4">&#167;6.7.4</a>.</p>

    <p class="inwebparagraph"><a id="SP6_7_4_1_1"></a><b>&#167;6.7.4.1.1.  </b>VM requirements are parsed by feeding them into the lexer and calling the
    same routines as would be used when parsing headings about VM requirements
    in a normal run of Inform. Note that because the requirements are in round
    brackets, which the lexer will split off as distinct words, we can ignore
    the first and last word and just look at what is in between:
    </p>


    <p class="macrodefinition"><code class="display">
    &lt;<span class="cwebmacrodefn">Append icons which signify the VM requirements of the extension</span> <span class="cwebmacronumber">6.7.4.1.1</span>&gt; =
    </code></p>


    <pre class="displaydefn">
            <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;%S"</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">-&gt;</span><span class="identifier">parsed_from</span><span class="plain">);</span>
            <span class="plain">#</span><span class="identifier">ifdef</span><span class="plain"> </span><span class="identifier">CORE_MODULE</span>
            <span class="functiontext">Extensions::Census::write_icons</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">);</span>
            <span class="plain">#</span><span class="identifier">endif</span>
    </pre>

    <p class="inwebparagraph"></p>

    <p class="endnote">This code is used in <a href="#SP6_7_4_1">&#167;6.7.4.1</a>.</p>

    <p class="inwebparagraph"><a id="SP6_7_4_2"></a><b>&#167;6.7.4.2.  </b><code class="display">
    &lt;<span class="cwebmacrodefn">Print column 2 of the census line</span> <span class="cwebmacronumber">6.7.4.2</span>&gt; =
    </code></p>


    <pre class="displaydefn">
            <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">, </span><span class="string">"class=\"smaller\""</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">VersionNumbers::is_null</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="identifier">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">version</span><span class="plain">) == </span><span class="identifier">FALSE</span><span class="plain">)</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"v&amp;nbsp;%v"</span><span class="plain">, &amp;(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">version</span><span class="plain">));</span>
            <span class="reserved">else</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"--"</span><span class="plain">);</span>
            <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">);</span>
    </pre>

    <p class="inwebparagraph"></p>

    <p class="endnote">This code is used in <a href="#SP6_7_4">&#167;6.7.4</a>.</p>

    <p class="inwebparagraph"><a id="SP6_7_4_3"></a><b>&#167;6.7.4.3.  </b></p>


    <pre class="definitions">
        <span class="definitionkeyword">define</span> <span class="constant">BUILT_IN_SYMBOL</span><span class="plain"> </span><span class="string">"border=\"0\" src=\"inform:/doc_images/builtin_ext.png\""</span>
        <span class="definitionkeyword">define</span> <span class="constant">OVERRIDING_SYMBOL</span><span class="plain"> </span><span class="string">"border=\"0\" src=\"inform:/doc_images/override_ext.png\""</span>
        <span class="definitionkeyword">define</span> <span class="constant">PROJECT_SPECIFIC_SYMBOL</span><span class="plain"> </span><span class="string">"border=\"0\" src=\"inform:/doc_images/pspec_ext.png\""</span>

        <p class="macrodefinition"><code class="display">
        &lt;<span class="cwebmacrodefn">Print column 3 of the census line</span> <span class="cwebmacronumber">6.7.4.3</span>&gt; =
        </code></p>


        <pre class="displaydefn">
                <span class="reserved">char</span><span class="plain"> *</span><span class="identifier">opener</span><span class="plain"> = </span><span class="string">"src='inform:/doc_images/folder4.png' border=0"</span><span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">built_in</span><span class="plain">) { </span><span class="identifier">opener</span><span class="plain"> = </span><span class="constant">BUILT_IN_SYMBOL</span><span class="plain">; </span><span class="identifier">key_builtin</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">; }</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">overriding_a_built_in_extension</span><span class="plain">) {</span>
                    <span class="identifier">opener</span><span class="plain"> = </span><span class="constant">OVERRIDING_SYMBOL</span><span class="plain">; </span><span class="identifier">key_override</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">project_specific</span><span class="plain">) {</span>
                    <span class="identifier">opener</span><span class="plain"> = </span><span class="constant">PROJECT_SPECIFIC_SYMBOL</span><span class="plain">; </span><span class="identifier">key_pspec</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
                <span class="plain">}</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">built_in</span><span class="plain">) </span><span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"%s"</span><span class="plain">, </span><span class="identifier">opener</span><span class="plain">)</span>
                <span class="reserved">else</span><span class="plain"> {</span>
                    <span class="plain">#</span><span class="identifier">ifdef</span><span class="plain"> </span><span class="identifier">INDEX_MODULE</span>
                    <span class="identifier">pathname</span><span class="plain"> *</span><span class="identifier">area</span><span class="plain"> = </span><span class="functiontext">ExtensionManager::path_within_nest</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">nest</span><span class="plain">);</span>
                    <span class="identifier">HTML::Javascript::open_file</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">area</span><span class="plain">, </span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">-&gt;</span><span class="element">raw_author_name</span><span class="plain">, </span><span class="identifier">opener</span><span class="plain">);</span>
                    <span class="plain">#</span><span class="identifier">endif</span>
                <span class="plain">}</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="endnote">This code is used in <a href="#SP6_7_4">&#167;6.7.4</a>.</p>

        <p class="inwebparagraph"><a id="SP6_7_4_4"></a><b>&#167;6.7.4.4.  </b><code class="display">
        &lt;<span class="cwebmacrodefn">Print column 4 of the census line</span> <span class="cwebmacronumber">6.7.4.4</span>&gt; =
        </code></p>


        <pre class="displaydefn">
                <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">, </span><span class="string">"class=\"smaller\""</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">d</span><span class="plain"> == </span><span class="constant">SORT_CE_BY_DATE</span><span class="plain">) || (</span><span class="identifier">d</span><span class="plain"> == </span><span class="constant">SORT_CE_BY_INSTALL</span><span class="plain">)) {</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="functiontext">Works::get_usage_date</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">));</span>
                <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">d</span><span class="plain"> == </span><span class="constant">SORT_CE_BY_LENGTH</span><span class="plain">) {</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Works::forgot</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="identifier">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">))</span>
                        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"I did read this, but forgot"</span><span class="plain">);</span>
                    <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Works::never</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">))</span>
                        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"I've never read this"</span><span class="plain">);</span>
                    <span class="reserved">else</span>
                        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%d words"</span><span class="plain">, </span><span class="functiontext">Works::get_word_count</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">));</span>
                <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="functiontext">Extensions::Census::ecd_rubric</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">)) &gt; </span><span class="constant">0</span><span class="plain">)</span>
                        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S"</span><span class="plain">, </span><span class="functiontext">Extensions::Census::ecd_rubric</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">));</span>
                    <span class="reserved">else</span>
                        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"--"</span><span class="plain">);</span>
                <span class="plain">}</span>
                <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"span"</span><span class="plain">);</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="endnote">This code is used in <a href="#SP6_7_4">&#167;6.7.4</a>.</p>

        <p class="inwebparagraph"><a id="SP7"></a><b>&#167;7.  </b>Two useful measurements:
        </p>

        <pre class="display">
            <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Extensions::Census::installation_region</span><span class="plain">(</span><span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">ecd</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">project_specific</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">0</span><span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">built_in</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">1</span><span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">overriding_a_built_in_extension</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="constant">2</span><span class="plain">;</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="constant">3</span><span class="plain">;</span>
            <span class="plain">}</span>

            <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Extensions::Census::ecd_used</span><span class="plain">(</span><span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">ecd</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="functiontext">Works::no_times_used_in_context</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">, </span><span class="constant">LOADED_WDBC</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) ||</span>
                    <span class="plain">(</span><span class="functiontext">Works::no_times_used_in_context</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">, </span><span class="constant">DICTIONARY_REFERRED_WDBC</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">))</span>
                    <span class="reserved">return</span><span class="plain"> </span><span class="identifier">TRUE</span><span class="plain">;</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
            <span class="plain">}</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="endnote">The function Extensions::Census::installation_region is used in <a href="#SP6_7_2">&#167;6.7.2</a>, <a href="#SP8">&#167;8</a>.</p>

        <p class="endnote">The function Extensions::Census::ecd_used is used in <a href="#SP6_7_2_1">&#167;6.7.2.1</a>, <a href="#SP6_7_4_1">&#167;6.7.4.1</a>.</p>

        <p class="inwebparagraph"><a id="SP8"></a><b>&#167;8.  </b>The following give the sorting criteria:
        </p>

        <pre class="display">
            <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Extensions::Census::compare_ecd_by_title</span><span class="plain">(</span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ecd1</span><span class="plain">, </span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ecd2</span><span class="plain">) {</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">e1</span><span class="plain"> = *((</span><span class="reserved">extension_census_datum</span><span class="plain"> **) </span><span class="identifier">ecd1</span><span class="plain">);</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">e2</span><span class="plain"> = *((</span><span class="reserved">extension_census_datum</span><span class="plain"> **) </span><span class="identifier">ecd2</span><span class="plain">);</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">Works::compare_by_title</span><span class="plain">(</span><span class="identifier">e1</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">, </span><span class="identifier">e2</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">);</span>
            <span class="plain">}</span>

            <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Extensions::Census::compare_ecd_by_author</span><span class="plain">(</span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ecd1</span><span class="plain">, </span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ecd2</span><span class="plain">) {</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">e1</span><span class="plain"> = *((</span><span class="reserved">extension_census_datum</span><span class="plain"> **) </span><span class="identifier">ecd1</span><span class="plain">);</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">e2</span><span class="plain"> = *((</span><span class="reserved">extension_census_datum</span><span class="plain"> **) </span><span class="identifier">ecd2</span><span class="plain">);</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">Works::compare</span><span class="plain">(</span><span class="identifier">e1</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">, </span><span class="identifier">e2</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">);</span>
            <span class="plain">}</span>

            <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Extensions::Census::compare_ecd_by_installation</span><span class="plain">(</span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ecd1</span><span class="plain">, </span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ecd2</span><span class="plain">) {</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">e1</span><span class="plain"> = *((</span><span class="reserved">extension_census_datum</span><span class="plain"> **) </span><span class="identifier">ecd1</span><span class="plain">);</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">e2</span><span class="plain"> = *((</span><span class="reserved">extension_census_datum</span><span class="plain"> **) </span><span class="identifier">ecd2</span><span class="plain">);</span>
                <span class="reserved">int</span><span class="plain"> </span><span class="identifier">d</span><span class="plain"> = </span><span class="functiontext">Extensions::Census::installation_region</span><span class="plain">(</span><span class="identifier">e1</span><span class="plain">) - </span><span class="functiontext">Extensions::Census::installation_region</span><span class="plain">(</span><span class="identifier">e2</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">d</span><span class="plain"> != </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">d</span><span class="plain">;</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">Works::compare_by_title</span><span class="plain">(</span><span class="identifier">e1</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">, </span><span class="identifier">e2</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">);</span>
            <span class="plain">}</span>

            <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Extensions::Census::compare_ecd_by_date</span><span class="plain">(</span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ecd1</span><span class="plain">, </span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ecd2</span><span class="plain">) {</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">e1</span><span class="plain"> = *((</span><span class="reserved">extension_census_datum</span><span class="plain"> **) </span><span class="identifier">ecd1</span><span class="plain">);</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">e2</span><span class="plain"> = *((</span><span class="reserved">extension_census_datum</span><span class="plain"> **) </span><span class="identifier">ecd2</span><span class="plain">);</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">Works::compare_by_date</span><span class="plain">(</span><span class="identifier">e1</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">, </span><span class="identifier">e2</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">);</span>
            <span class="plain">}</span>

            <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Extensions::Census::compare_ecd_by_length</span><span class="plain">(</span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ecd1</span><span class="plain">, </span><span class="reserved">const</span><span class="plain"> </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">ecd2</span><span class="plain">) {</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">e1</span><span class="plain"> = *((</span><span class="reserved">extension_census_datum</span><span class="plain"> **) </span><span class="identifier">ecd1</span><span class="plain">);</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">e2</span><span class="plain"> = *((</span><span class="reserved">extension_census_datum</span><span class="plain"> **) </span><span class="identifier">ecd2</span><span class="plain">);</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="functiontext">Works::compare_by_length</span><span class="plain">(</span><span class="identifier">e1</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">, </span><span class="identifier">e2</span><span class="plain">-&gt;</span><span class="element">found_as</span><span class="plain">-&gt;</span><span class="element">copy</span><span class="plain">-&gt;</span><span class="element">edition</span><span class="plain">-&gt;</span><span class="element">work</span><span class="plain">);</span>
            <span class="plain">}</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="endnote">The function Extensions::Census::compare_ecd_by_title is used in <a href="#SP6_6">&#167;6.6</a>.</p>

        <p class="endnote">The function Extensions::Census::compare_ecd_by_author is used in <a href="#SP6_6">&#167;6.6</a>.</p>

        <p class="endnote">The function Extensions::Census::compare_ecd_by_installation is used in <a href="#SP6_6">&#167;6.6</a>.</p>

        <p class="endnote">The function Extensions::Census::compare_ecd_by_date is used in <a href="#SP6_6">&#167;6.6</a>.</p>

        <p class="endnote">The function Extensions::Census::compare_ecd_by_length is used in <a href="#SP6_6">&#167;6.6</a>.</p>

        <p class="inwebparagraph"><a id="SP9"></a><b>&#167;9. Icons for virtual machines. </b>And everything else is cosmetic: printing, or showing icons to signify,
        the current VM or some set of permitted VMs. The following plots the
        icon associated with a given minor VM, and explicates what the icons mean:
        </p>

        <pre class="display">
            <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::plot_icon</span><span class="plain">(</span><span class="identifier">OUTPUT_STREAM</span><span class="plain">, </span><span class="identifier">target_vm</span><span class="plain"> *</span><span class="identifier">VM</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::len</span><span class="plain">(</span><span class="identifier">VM</span><span class="plain">-&gt;</span><span class="identifier">VM_image</span><span class="plain">) &gt; </span><span class="constant">0</span><span class="plain">) {</span>
                    <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"border=0 src=inform:/doc_images/%S"</span><span class="plain">, </span><span class="identifier">VM</span><span class="plain">-&gt;</span><span class="identifier">VM_image</span><span class="plain">);</span>
                    <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&amp;nbsp;"</span><span class="plain">);</span>
                <span class="plain">}</span>
            <span class="plain">}</span>

            <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::write_key</span><span class="plain">(</span><span class="identifier">OUTPUT_STREAM</span><span class="plain">) {</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Extensions compatible with specific story file formats only: "</span><span class="plain">);</span>
                <span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
                <span class="identifier">target_vm</span><span class="plain"> *</span><span class="identifier">VM</span><span class="plain">;</span>
                <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">VM</span><span class="plain">, </span><span class="identifier">target_vm</span><span class="plain">) {</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">VM</span><span class="plain">-&gt;</span><span class="identifier">with_debugging_enabled</span><span class="plain">) </span><span class="reserved">continue</span><span class="plain">; </span><span class="comment">avoids listing twice</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">i</span><span class="plain">++ &gt; </span><span class="constant">0</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">", "</span><span class="plain">);</span>
                    <span class="functiontext">Extensions::Census::plot_icon</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">VM</span><span class="plain">);</span>
                    <span class="identifier">TargetVMs::write</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">VM</span><span class="plain">);</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="endnote">The function Extensions::Census::plot_icon is used in <a href="#SP10">&#167;10</a>.</p>

        <p class="endnote">The function Extensions::Census::write_key is used in <a href="#SP6_5">&#167;6.5</a>.</p>

        <p class="inwebparagraph"><a id="SP10"></a><b>&#167;10. Displaying VM restrictions. </b>Given a word range, we describe the result as concisely as we can with a
        row of icons (but do not bother for the common case where some extension
        has no restriction on its use).
        </p>

        <pre class="display">
            <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::write_icons</span><span class="plain">(</span><span class="identifier">OUTPUT_STREAM</span><span class="plain">, </span><span class="identifier">compatibility_specification</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">) {</span>
                <span class="reserved">int</span><span class="plain"> </span><span class="identifier">something</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">, </span><span class="identifier">everything</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
                <span class="identifier">target_vm</span><span class="plain"> *</span><span class="identifier">VM</span><span class="plain">;</span>
                <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">VM</span><span class="plain">, </span><span class="identifier">target_vm</span><span class="plain">)</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Compatibility::with</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">, </span><span class="identifier">VM</span><span class="plain">))</span>
                        <span class="identifier">something</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
                    <span class="reserved">else</span>
                        <span class="identifier">everything</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">something</span><span class="plain"> == </span><span class="identifier">FALSE</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"none"</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">everything</span><span class="plain"> == </span><span class="identifier">FALSE</span><span class="plain">)</span>
                    <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">VM</span><span class="plain">, </span><span class="identifier">target_vm</span><span class="plain">)</span>
                        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Compatibility::with</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">, </span><span class="identifier">VM</span><span class="plain">))</span>
                            <span class="functiontext">Extensions::Census::plot_icon</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">VM</span><span class="plain">);</span>
            <span class="plain">}</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="endnote">The function Extensions::Census::write_icons is used in <a href="#SP6_7_4_1_1">&#167;6.7.4.1.1</a>, 7/ed2 (<a href="7-ed2.html#SP3_2_1_2">&#167;3.2.1.2</a>).</p>

        <p class="inwebparagraph"><a id="SP11"></a><b>&#167;11. Updating the documentation. </b>This is done in the course of taking an extension census, which is called
        for in one of two circumstances: when Inform is being run in "census mode" to
        notify it that extensions have been installed or uninstalled; or when Inform
        has completed the successful compilation of a source text. In the latter
        case, it knows quite a lot about the extensions actually used in that
        compilation, and so can write detailed versions of their documentation:
        since it is updating extension documentation anyway, it conducts a census
        as well. (In both cases the extension dictionary is also worked upon.) The
        two alternatives are expressed here:
        </p>

        <pre class="display">
            <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::handle_census_mode</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
                <span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain"> = </span><span class="functiontext">Extensions::Census::new</span><span class="plain">();</span>
                <span class="functiontext">Extensions::Dictionary::load</span><span class="plain">();</span>
                <span class="functiontext">Extensions::Census::perform</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">);</span>
                <span class="functiontext">Extensions::Census::write_top_level_of_extensions_documentation</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">);</span>
                <span class="functiontext">Extensions::Census::write_sketchy_documentation_for_extensions_found</span><span class="plain">(</span><span class="identifier">TRUE</span><span class="plain">);</span>
            <span class="plain">}</span>

            <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::update_census</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
                <span class="functiontext">Extensions::Dictionary::load</span><span class="plain">();</span>
                <span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain"> = </span><span class="functiontext">Extensions::Census::new</span><span class="plain">();</span>
                <span class="functiontext">Extensions::Census::perform</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">);</span>
                <span class="functiontext">Extensions::Census::write_top_level_of_extensions_documentation</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">);</span>
                <span class="plain">#</span><span class="identifier">ifdef</span><span class="plain"> </span><span class="identifier">CORE_MODULE</span>
                <span class="reserved">inform_extension</span><span class="plain"> *</span><span class="identifier">E</span><span class="plain">;</span>
                <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">E</span><span class="plain">, </span><span class="reserved">inform_extension</span><span class="plain">) </span><span class="functiontext">Extensions::Documentation::write_detailed</span><span class="plain">(</span><span class="identifier">E</span><span class="plain">);</span>
                <span class="plain">#</span><span class="identifier">endif</span>
                <span class="functiontext">Extensions::Census::write_sketchy_documentation_for_extensions_found</span><span class="plain">(</span><span class="identifier">FALSE</span><span class="plain">);</span>
                <span class="functiontext">Extensions::Dictionary::write_back</span><span class="plain">();</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Log::aspect_switched_on</span><span class="plain">(</span><span class="constant">EXTENSIONS_CENSUS_DA</span><span class="plain">)) </span><span class="functiontext">Works::log_work_hash_table</span><span class="plain">();</span>
            <span class="plain">}</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="endnote">The function Extensions::Census::handle_census_mode is used in 1/ic (<a href="1-ic.html#SP11">&#167;11</a>).</p>

        <p class="endnote">The function Extensions::Census::update_census appears nowhere else.</p>

        <p class="inwebparagraph"><a id="SP12"></a><b>&#167;12.  </b>Documenting extensions seen but not used: we run through the census
        results in no particular order and create a sketchy page of documentation,
        if there's no better one already.
        </p>

        <pre class="display">
            <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::write_sketchy_documentation_for_extensions_found</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">census_mode</span><span class="plain">) {</span>
                <span class="reserved">extension_census_datum</span><span class="plain"> *</span><span class="identifier">ecd</span><span class="plain">;</span>
                <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">, </span><span class="reserved">extension_census_datum</span><span class="plain">)</span>
                    <span class="functiontext">Extensions::Documentation::write_sketchy</span><span class="plain">(</span><span class="identifier">ecd</span><span class="plain">, </span><span class="identifier">census_mode</span><span class="plain">);</span>
            <span class="plain">}</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="endnote">The function Extensions::Census::write_sketchy_documentation_for_extensions_found is used in <a href="#SP11">&#167;11</a>.</p>

        <p class="inwebparagraph"><a id="SP13"></a><b>&#167;13. Writing the extensions home pages. </b>Extensions documentation forms a mini-website within the Inform
        documentation. There is a top level consisting of two home pages: a
        directory of all installed extensions, and an index to the terms defined in
        those extensions. A cross-link switches between them. Each of these links
        down to the bottom level, where there is a page for every installed
        extension (wherever it is installed). The picture is therefore something
        like this:
        </p>

        <pre class="display">
                <span class="plain">(Main documentation contents page)</span>
                        <span class="plain">|</span>
                <span class="plain">Extensions.html--ExtIndex.html</span>
                        <span class="plain">|      \/      |</span>
                        <span class="plain">|      /\      |</span>
                <span class="plain">Nigel Toad/Eggs  Barnabas Dundritch/Neopolitan Iced Cream   ...</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="inwebparagraph"><a id="SP14"></a><b>&#167;14.  </b>These pages are stored at the relative pathnames
        </p>

        <pre class="display">
                <span class="plain">Extensions/Documentation/Extensions.html</span>
                <span class="plain">Extensions/Documentation/ExtIndex.html</span>
        </pre>

        <p class="inwebparagraph">They are made by inserting content in place of the material between the
        HTML anchors <code class="display"><span class="extract">on</span></code> and <code class="display"><span class="extract">off</span></code> in a template version of the page built in
        to the application, with a leafname which varies from platform to
        platform, for reasons as always to do with the vagaries of Internet
        Explorer 7 for Windows.
        </p>

        <pre class="display">
            <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::write_top_level_of_extensions_documentation</span><span class="plain">(</span><span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">) {</span>
                <span class="functiontext">Extensions::Census::write_top_level_extensions_page</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"Extensions.html"</span><span class="plain">, </span><span class="constant">1</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">);</span>
                <span class="functiontext">Extensions::Census::write_top_level_extensions_page</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"ExtIndex.html"</span><span class="plain">, </span><span class="constant">2</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
            <span class="plain">}</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="endnote">The function Extensions::Census::write_top_level_of_extensions_documentation is used in <a href="#SP11">&#167;11</a>.</p>

        <p class="inwebparagraph"><a id="SP15"></a><b>&#167;15.  </b></p>

        <pre class="display">
            <span class="identifier">pathname</span><span class="plain"> *</span><span class="functiontext">Extensions::Census::doc_pathname</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
                <span class="identifier">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> = </span><span class="functiontext">Inbuild::transient</span><span class="plain">();</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">P</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">NULL</span><span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Pathnames::create_in_file_system</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">) == </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">NULL</span><span class="plain">;</span>
                <span class="identifier">P</span><span class="plain"> = </span><span class="identifier">Pathnames::subfolder</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Documentation"</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Pathnames::create_in_file_system</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">) == </span><span class="constant">0</span><span class="plain">) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">NULL</span><span class="plain">;</span>
                <span class="reserved">return</span><span class="plain"> </span><span class="identifier">P</span><span class="plain">;</span>
            <span class="plain">}</span>

            <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Extensions::Census::write_top_level_extensions_page</span><span class="plain">(</span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">leaf</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">content</span><span class="plain">, </span><span class="reserved">extension_census</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain">) {</span>
                <span class="identifier">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> = </span><span class="functiontext">Extensions::Census::doc_pathname</span><span class="plain">();</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">P</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="reserved">return</span><span class="plain">;</span>
                <span class="identifier">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="identifier">Filenames::in_folder</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">, </span><span class="identifier">leaf</span><span class="plain">);</span>

                <span class="identifier">text_stream</span><span class="plain"> </span><span class="identifier">HOMEPAGE_struct</span><span class="plain">;</span>
                <span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">OUT</span><span class="plain"> = &amp;</span><span class="identifier">HOMEPAGE_struct</span><span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">STREAM_OPEN_TO_FILE</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">, </span><span class="identifier">UTF8_ENC</span><span class="plain">) == </span><span class="identifier">FALSE</span><span class="plain">) {</span>
                    <span class="plain">#</span><span class="identifier">ifdef</span><span class="plain"> </span><span class="identifier">CORE_MODULE</span>
                    <span class="identifier">Problems::Fatal::filename_related</span><span class="plain">(</span>
                        <span class="string">"Unable to open extensions documentation index for writing"</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">);</span>
                    <span class="plain">#</span><span class="identifier">endif</span>
                    <span class="plain">#</span><span class="identifier">ifndef</span><span class="plain"> </span><span class="identifier">CORE_MODULE</span>
                    <span class="identifier">Errors::fatal_with_file</span><span class="plain">(</span><span class="string">"extensions documentation index for writing: %f"</span><span class="plain">, </span><span class="identifier">F</span><span class="plain">);</span>
                    <span class="plain">#</span><span class="identifier">endif</span>
                <span class="plain">}</span>

                <span class="identifier">HTML::declare_as_HTML</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">FALSE</span><span class="plain">);</span>

                <span class="identifier">HTML::begin_head</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
                <span class="identifier">HTML::title</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Extensions"</span><span class="plain">);</span>
                <span class="identifier">HTML::incorporate_javascript</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">TRUE</span><span class="plain">,</span>
                    <span class="functiontext">Inbuild::file_from_installation</span><span class="plain">(</span><span class="constant">JAVASCRIPT_FOR_EXTENSIONS_IRES</span><span class="plain">));</span>
                <span class="identifier">HTML::incorporate_CSS</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">,</span>
                    <span class="functiontext">Inbuild::file_from_installation</span><span class="plain">(</span><span class="constant">CSS_FOR_STANDARD_PAGES_IRES</span><span class="plain">));</span>
                <span class="identifier">HTML::end_head</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>

                <span class="identifier">HTML::begin_body</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
                <span class="identifier">HTML::begin_html_table</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">TRUE</span><span class="plain">, </span><span class="constant">0</span><span class="plain">, </span><span class="constant">4</span><span class="plain">, </span><span class="constant">0</span><span class="plain">, </span><span class="constant">0</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>
                <span class="identifier">HTML::first_html_column</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>
                <span class="identifier">HTML_TAG_WITH</span><span class="plain">(</span><span class="string">"img"</span><span class="plain">, </span><span class="string">"src='inform:/doc_images/extensions@2x.png' border=0 width=150 height=150"</span><span class="plain">);</span>
                <span class="identifier">HTML::next_html_column</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>

                <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"div"</span><span class="plain">, </span><span class="string">"class=\"headingboxDark\""</span><span class="plain">);</span>
                <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"div"</span><span class="plain">, </span><span class="string">"class=\"headingtextWhite\""</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Installed Extensions"</span><span class="plain">);</span>
                <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"div"</span><span class="plain">);</span>
                <span class="identifier">HTML_OPEN_WITH</span><span class="plain">(</span><span class="string">"div"</span><span class="plain">, </span><span class="string">"class=\"headingrubricWhite\""</span><span class="plain">);</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Bundles of extra rules or phrases to extend what Inform can do"</span><span class="plain">);</span>
                <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"div"</span><span class="plain">);</span>
                <span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"div"</span><span class="plain">);</span>

                <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">content</span><span class="plain">) {</span>
                    <span class="reserved">case</span><span class="plain"> </span><span class="constant">1</span><span class="plain">: </span><span class="functiontext">Extensions::Census::write_results</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">C</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
                    <span class="reserved">case</span><span class="plain"> </span><span class="constant">2</span><span class="plain">: </span><span class="functiontext">Extensions::Dictionary::write_to_HTML</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
                <span class="plain">}</span>

                <span class="identifier">HTML::end_body</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">);</span>
            <span class="plain">}</span>
        </pre>

        <p class="inwebparagraph"></p>

        <p class="endnote">The function Extensions::Census::doc_pathname appears nowhere else.</p>

        <p class="endnote">The function Extensions::Census::write_top_level_extensions_page is used in <a href="#SP14">&#167;14</a>.</p>

        <hr class="tocbar">
        <ul class="toc"><li><a href="7-ed2.html">Back to 'Extension Documentation'</a></li><li><i>(This section ends Chapter 7: Extension Indexing.)</i></li></ul><hr class="tocbar">
        <!--End of weave-->
        		</main>
        	</body>
        </html>

