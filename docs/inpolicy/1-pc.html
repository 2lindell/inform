<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>1/mn</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>

<!--Weave of '1/pc' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">&#9733;</a></li><li><a href="index.html">inpolicy 1</a></li><li><a href="index.html#1">Chapter 1: What It Does</a></li><li><b>Problem Coverage</b></li></ul><p class="purpose">To see which problem messages have test cases and which are linked to the documentation.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Observation</a></li><li><a href="#SP3">&#167;3. Problems which have test cases</a></li><li><a href="#SP4">&#167;4. Problems mentioned in documentation</a></li><li><a href="#SP5">&#167;5. Problems generated in the I7 source</a></li><li><a href="#SP6">&#167;6. Checking</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Observation. </b></p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">CASE_EXISTS_PCON</span><span class="plain">		0</span><span class="identifier">x00000001</span>
    <span class="definitionkeyword">define</span> <span class="constant">DOC_MENTIONS_PCON</span><span class="plain"> 	0</span><span class="identifier">x00000002</span>
    <span class="definitionkeyword">define</span> <span class="constant">CODE_MENTIONS_PCON</span><span class="plain"> 	0</span><span class="identifier">x00000004</span>
    <span class="definitionkeyword">define</span> <span class="constant">IMPOSSIBLE_PCON</span><span class="plain"> 		0</span><span class="identifier">x00000008</span>
    <span class="definitionkeyword">define</span> <span class="constant">UNTESTABLE_PCON</span><span class="plain"> 		0</span><span class="identifier">x00000010</span>
    <span class="definitionkeyword">define</span> <span class="constant">NAMELESS_PCON</span><span class="plain">		0</span><span class="identifier">x00000020</span>
</pre>

<pre class="display">
    <span class="reserved">dictionary</span><span class="plain"> *</span><span class="identifier">problems_dictionary</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>

    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">known_problem</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">contexts_observed</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">contexts_observed_multiple_times</span><span class="plain">;</span>
        <span class="constant">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">known_problem</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure known_problem is accessed in 1/vn and here.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>When a problem is observed, we create a dictionary entry for it, if necessary,
and augment its bitmap of known contexts:
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Coverage::observe_problem</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">context</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">problems_dictionary</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">)</span>
            <span class="identifier">problems_dictionary</span><span class="plain"> = </span><span class="functiontext">Dictionaries::new</span><span class="plain">(1000, </span><span class="constant">FALSE</span><span class="plain">);</span>
        <span class="reserved">known_problem</span><span class="plain"> *</span><span class="identifier">KP</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Dictionaries::find</span><span class="plain">(</span><span class="identifier">problems_dictionary</span><span class="plain">, </span><span class="identifier">name</span><span class="plain">)) {</span>
            <span class="identifier">KP</span><span class="plain"> = (</span><span class="reserved">known_problem</span><span class="plain"> *) </span><span class="functiontext">Dictionaries::read_value</span><span class="plain">(</span><span class="identifier">problems_dictionary</span><span class="plain">, </span><span class="identifier">name</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">KP</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">known_problem</span><span class="plain">);</span>
            <span class="functiontext">Dictionaries::create</span><span class="plain">(</span><span class="identifier">problems_dictionary</span><span class="plain">, </span><span class="identifier">name</span><span class="plain">);</span>
            <span class="functiontext">Dictionaries::write_value</span><span class="plain">(</span><span class="identifier">problems_dictionary</span><span class="plain">, </span><span class="identifier">name</span><span class="plain">, (</span><span class="reserved">void</span><span class="plain"> *) </span><span class="identifier">KP</span><span class="plain">);</span>
            <span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;name</span><span class="plain"> = </span><span class="functiontext">Str::duplicate</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">);</span>
            <span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;contexts_observed</span><span class="plain"> = 0;</span>
            <span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;contexts_observed_multiple_times</span><span class="plain"> = 0;</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;contexts_observed</span><span class="plain"> &amp; </span><span class="identifier">context</span><span class="plain">)</span>
            <span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;contexts_observed_multiple_times</span><span class="plain"> |= </span><span class="identifier">context</span><span class="plain">;</span>
        <span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;contexts_observed</span><span class="plain"> |= </span><span class="identifier">context</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Coverage::observe_problem is used in <a href="#SP3">&#167;3</a>, <a href="#SP4">&#167;4</a>, <a href="#SP5">&#167;5</a>.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3. Problems which have test cases. </b>Here we ask Intest to produce a roster of all known test cases, then parse
this back to look for cases whose names have the <code class="display"><span class="extract">PM_...</span></code> format. Those are
the problem message test cases, so we observe them.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Coverage::which_problems_have_test_cases</span><span class="plain">(</span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">Workspace</span><span class="plain">) {</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">CAT</span><span class="plain"> = </span><span class="functiontext">Filenames::in_folder</span><span class="plain">(</span><span class="identifier">Workspace</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"cases.txt"</span><span class="plain">);</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">COMMAND</span><span class="plain">);</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">COMMAND</span><span class="plain">, </span><span class="string">"intest/Tangled/intest inform7 -catalogue "</span><span class="plain">);</span>
        <span class="functiontext">Shell::redirect</span><span class="plain">(</span><span class="identifier">COMMAND</span><span class="plain">, </span><span class="identifier">CAT</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Shell::run</span><span class="plain">(</span><span class="identifier">COMMAND</span><span class="plain">)) </span><span class="functiontext">Errors::fatal</span><span class="plain">(</span><span class="string">"can't run intest to harvest cases"</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">COMMAND</span><span class="plain">);</span>
        <span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">CAT</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"unable to read roster of test cases"</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">,</span>
            <span class="plain">&amp;</span><span class="functiontext">Coverage::test_case_harvester</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Coverage::test_case_harvester</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">state</span><span class="plain">) {</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(PM_%C+)%c*"</span><span class="plain">))</span>
            <span class="functiontext">Coverage::observe_problem</span><span class="plain">(</span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0], </span><span class="constant">CASE_EXISTS_PCON</span><span class="plain">);</span>
        <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Coverage::which_problems_have_test_cases is used in <a href="#SP6">&#167;6</a>.</p>

<p class="endnote">The function Coverage::test_case_harvester appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4. Problems mentioned in documentation. </b>Here we look through the "Writing with Inform" source text for cross-references
to problem messages:
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Coverage::which_problems_are_referenced</span><span class="plain">(</span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">Workspace</span><span class="plain">) {</span>
        <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">D</span><span class="plain"> = </span><span class="functiontext">Pathnames::from_text</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"Documentation"</span><span class="plain">);</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">WWI</span><span class="plain"> = </span><span class="functiontext">Filenames::in_folder</span><span class="plain">(</span><span class="identifier">D</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Writing with Inform.txt"</span><span class="plain">);</span>
        <span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">WWI</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"unable to read 'Writing with Inform' source text"</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">,</span>
            <span class="plain">&amp;</span><span class="functiontext">Coverage::xref_harvester</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Coverage::xref_harvester</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">state</span><span class="plain">) {</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*)%{(PM_%C+?)%}(%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext">Coverage::observe_problem</span><span class="plain">(</span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[1], </span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">);</span>
            <span class="functiontext">Str::clear</span><span class="plain">(</span><span class="identifier">text</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">text</span><span class="plain">, </span><span class="string">"%S%S"</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0], </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[2]);</span>
        <span class="plain">}</span>
        <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Coverage::which_problems_are_referenced is used in <a href="#SP6">&#167;6</a>.</p>

<p class="endnote">The function Coverage::xref_harvester appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5. Problems generated in the I7 source. </b>Which is to say, actually existing problem messages.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Coverage::which_problems_exist</span><span class="plain">(</span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">Workspace</span><span class="plain">) {</span>
        <span class="functiontext">Coverage::which_problems_exist_inner</span><span class="plain">(</span>
            <span class="functiontext">Pathnames::from_text</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"inform7"</span><span class="plain">), </span><span class="identifier">Workspace</span><span class="plain">);</span>
        <span class="functiontext">Coverage::which_problems_exist_inner</span><span class="plain">(</span>
            <span class="functiontext">Pathnames::from_text</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"inform7/core-module"</span><span class="plain">), </span><span class="identifier">Workspace</span><span class="plain">);</span>
        <span class="functiontext">Coverage::which_problems_exist_inner</span><span class="plain">(</span>
            <span class="functiontext">Pathnames::from_text</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"inform7/if-module"</span><span class="plain">), </span><span class="identifier">Workspace</span><span class="plain">);</span>
        <span class="functiontext">Coverage::which_problems_exist_inner</span><span class="plain">(</span>
            <span class="functiontext">Pathnames::from_text</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"inform7/multimedia-module"</span><span class="plain">), </span><span class="identifier">Workspace</span><span class="plain">);</span>
        <span class="functiontext">Coverage::which_problems_exist_inner</span><span class="plain">(</span>
            <span class="functiontext">Pathnames::from_text</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"inter/codegen-module"</span><span class="plain">), </span><span class="identifier">Workspace</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Coverage::which_problems_exist_inner</span><span class="plain">(</span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">D</span><span class="plain">, </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">Workspace</span><span class="plain">) {</span>
        <span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">C</span><span class="plain"> = </span><span class="functiontext">Filenames::in_folder</span><span class="plain">(</span><span class="identifier">D</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Contents.w"</span><span class="plain">);</span>
        <span class="reserved">existence_state</span><span class="plain"> </span><span class="identifier">es</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.web_path</span><span class="plain"> = </span><span class="identifier">D</span><span class="plain">;</span>
        <span class="identifier">es</span><span class="element">.chapter_path</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">C</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"unable to read contents page of 'inform7' web"</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">,</span>
            <span class="plain">&amp;</span><span class="functiontext">Coverage::section_harvester</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, &amp;</span><span class="identifier">es</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">existence_state</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">web_path</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">chapter_path</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="reserved">filename</span><span class="plain"> *</span><span class="identifier">section</span><span class="plain">;</span>
    <span class="plain">} </span><span class="reserved">existence_state</span><span class="plain">;</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Coverage::section_harvester</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">state</span><span class="plain">) {</span>
        <span class="reserved">existence_state</span><span class="plain"> *</span><span class="identifier">es</span><span class="plain"> = (</span><span class="reserved">existence_state</span><span class="plain"> *) </span><span class="identifier">state</span><span class="plain">;</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(Chapter %d+)%c+"</span><span class="plain">))</span>
            <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;chapter_path</span><span class="plain"> = </span><span class="functiontext">Pathnames::subfolder</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;web_path</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"Appendix%c+"</span><span class="plain">)) </span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;chapter_path</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"Preliminaries%c+"</span><span class="plain">)) </span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;chapter_path</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;chapter_path</span><span class="plain">) &amp;&amp; (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">" (%c+?) *"</span><span class="plain">))) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
            <span class="functiontext">Str::copy</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">leaf</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c+?) %[%[%c+"</span><span class="plain">)) </span><span class="functiontext">Str::copy</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0]);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">, </span><span class="string">".w"</span><span class="plain">);</span>
            <span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;section</span><span class="plain"> = </span><span class="functiontext">Filenames::in_folder</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;chapter_path</span><span class="plain">, </span><span class="identifier">leaf</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">leaf</span><span class="plain">);</span>
            <span class="functiontext">TextFiles::read</span><span class="plain">(</span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;section</span><span class="plain">, </span><span class="constant">FALSE</span><span class="plain">, </span><span class="string">"unable to read section page from 'inform7' web"</span><span class="plain">, </span><span class="constant">TRUE</span><span class="plain">,</span>
                <span class="plain">&amp;</span><span class="functiontext">Coverage::existence_harvester</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Coverage::existence_harvester</span><span class="plain">(</span><span class="reserved">text_stream</span><span class="plain"> *</span><span class="identifier">text</span><span class="plain">, </span><span class="reserved">text_file_position</span><span class="plain"> *</span><span class="identifier">tfp</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">state</span><span class="plain">) {</span>
        <span class="reserved">existence_state</span><span class="plain"> *</span><span class="identifier">es</span><span class="plain"> = (</span><span class="reserved">existence_state</span><span class="plain"> *) </span><span class="identifier">state</span><span class="plain">;</span>
        <span class="reserved">match_results</span><span class="plain"> </span><span class="identifier">mr</span><span class="plain"> = </span><span class="functiontext">Regexp::create_mr</span><span class="plain">();</span>
        <span class="reserved">while</span><span class="plain"> (</span><span class="functiontext">Regexp::match</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">, </span><span class="identifier">text</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"(%c*?)_p_%((%c+?)%)(%c*)"</span><span class="plain">)) {</span>
            <span class="functiontext">Str::clear</span><span class="plain">(</span><span class="identifier">text</span><span class="plain">);</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">text</span><span class="plain">, </span><span class="string">"%S%S"</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[0], </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[2]);</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">);</span>
            <span class="functiontext">Str::copy</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="identifier">mr</span><span class="element">.exp</span><span class="plain">[1]);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq_wide_string</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"sigil"</span><span class="plain">)) </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">context</span><span class="plain"> = </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq_wide_string</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"BelievedImpossible"</span><span class="plain">)) { </span><span class="identifier">context</span><span class="plain"> = </span><span class="constant">IMPOSSIBLE_PCON</span><span class="plain">; </span>&lt;<span class="cwebmacro">Suffix location</span> <span class="cwebmacronumber">5.1</span>&gt;<span class="plain"> }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq_wide_string</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"Untestable"</span><span class="plain">)) { </span><span class="identifier">context</span><span class="plain"> = </span><span class="constant">UNTESTABLE_PCON</span><span class="plain">; </span>&lt;<span class="cwebmacro">Suffix location</span> <span class="cwebmacronumber">5.1</span>&gt;<span class="plain"> }</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq_wide_string</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"..."</span><span class="plain">)) { </span><span class="identifier">context</span><span class="plain"> = </span><span class="constant">NAMELESS_PCON</span><span class="plain">; </span>&lt;<span class="cwebmacro">Suffix location</span> <span class="cwebmacronumber">5.1</span>&gt;<span class="plain"> }</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Str::eq_wide_string</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"BelievedImpossible"</span><span class="plain">)) </span>&lt;<span class="cwebmacro">Suffix location</span> <span class="cwebmacronumber">5.1</span>&gt;
            <span class="functiontext">Coverage::observe_problem</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="identifier">context</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="functiontext">Regexp::dispose_of</span><span class="plain">(&amp;</span><span class="identifier">mr</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Coverage::which_problems_exist is used in <a href="#SP6">&#167;6</a>.</p>

<p class="endnote">The function Coverage::which_problems_exist_inner appears nowhere else.</p>

<p class="endnote">The function Coverage::section_harvester appears nowhere else.</p>

<p class="endnote">The function Coverage::existence_harvester appears nowhere else.</p>

<p class="endnote">The structure existence_state is private to this section.</p>

<p class="inwebparagraph"><a id="SP5_1"></a><b>&#167;5.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Suffix location</span> <span class="cwebmacronumber">5.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">name</span><span class="plain">, </span><span class="string">"_%f_line%d"</span><span class="plain">, </span><span class="identifier">es</span><span class="plain">-</span><span class="element">&gt;section</span><span class="plain">, </span><span class="identifier">tfp</span><span class="plain">-</span><span class="element">&gt;line_count</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP5">&#167;5</a> (four times).</p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6. Checking. </b></p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="identifier">observations_made</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Coverage::check</span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">observations_made</span><span class="plain"> == </span><span class="constant">FALSE</span><span class="plain">) {</span>
            <span class="reserved">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> =</span>
                <span class="functiontext">Pathnames::subfolder</span><span class="plain">(</span><span class="functiontext">Pathnames::from_text</span><span class="plain">(</span><span class="identifier">I</span><span class="string">"inpolicy"</span><span class="plain">), </span><span class="identifier">I</span><span class="string">"Workspace"</span><span class="plain">);</span>
            <span class="functiontext">Coverage::which_problems_have_test_cases</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">);</span>
            <span class="functiontext">Coverage::which_problems_are_referenced</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">);</span>
            <span class="functiontext">Coverage::which_problems_exist</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">);</span>
            <span class="identifier">observations_made</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>

        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">all_is_well</span><span class="plain"> = </span><span class="constant">TRUE</span><span class="plain">;</span>

        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%d problem name(s) have been observed:\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">NUMBER_CREATED</span><span class="plain">(</span><span class="reserved">known_problem</span><span class="plain">)); </span><span class="constant">INDENT</span><span class="plain">;</span>

        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Problems actually existing (the source code refers to them):\</span><span class="plain">n</span><span class="string">"</span><span class="plain">); </span><span class="constant">INDENT</span><span class="plain">;</span>
        <span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">, 0, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"are named and in principle testable"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, 0, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"are named more than once:"</span><span class="plain">) &gt; 0) {</span>
            <span class="identifier">all_is_well</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="functiontext">Coverage::list</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, 0, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">IMPOSSIBLE_PCON</span><span class="plain">, 0, </span><span class="constant">IMPOSSIBLE_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"are 'BelievedImpossible', that is, no known source text causes them"</span><span class="plain">);</span>
        <span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">UNTESTABLE_PCON</span><span class="plain">, 0, </span><span class="constant">UNTESTABLE_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"are 'Untestable', that is, not mechanically testable"</span><span class="plain">);</span>
        <span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">NAMELESS_PCON</span><span class="plain">, 0, </span><span class="constant">NAMELESS_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"are '...', that is, they need to be give a name and a test case"</span><span class="plain">);</span>
        <span class="constant">OUTDENT</span><span class="plain">;</span>

        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Problems which should have test cases:\</span><span class="plain">n</span><span class="string">"</span><span class="plain">); </span><span class="constant">INDENT</span><span class="plain">;</span>
        <span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">CASE_EXISTS_PCON</span><span class="plain">+</span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">, 0, </span><span class="constant">CASE_EXISTS_PCON</span><span class="plain">+</span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"have test cases"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">CASE_EXISTS_PCON</span><span class="plain">+</span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">, 0, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"have no test case yet:"</span><span class="plain">) &gt; 0) {</span>
            <span class="functiontext">Coverage::list</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">CASE_EXISTS_PCON</span><span class="plain">+</span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">, 0, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">CASE_EXISTS_PCON</span><span class="plain">+</span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">, 0, </span><span class="constant">CASE_EXISTS_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"are spurious test cases, since no such problems exist:"</span><span class="plain">) &gt; 0) {</span>
            <span class="identifier">all_is_well</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="functiontext">Coverage::list</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">CASE_EXISTS_PCON</span><span class="plain">+</span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">, 0, </span><span class="constant">CASE_EXISTS_PCON</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="constant">OUTDENT</span><span class="plain">;</span>

        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"Problems which are cross-referenced in 'Writing with Inform':\</span><span class="plain">n</span><span class="string">"</span><span class="plain">); </span><span class="constant">INDENT</span><span class="plain">;</span>
        <span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">+</span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">, 0, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">+</span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"are cross-referenced"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, 0, </span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">, </span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"are cross-referenced more than once:"</span><span class="plain">) &gt; 0) {</span>
            <span class="identifier">all_is_well</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="functiontext">Coverage::list</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, 0, </span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">, </span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">+</span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">, 0, </span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">,</span>
            <span class="identifier">L</span><span class="string">"are spurious references, since no such problems exist:"</span><span class="plain">) &gt; 0) {</span>
            <span class="identifier">all_is_well</span><span class="plain"> = </span><span class="constant">FALSE</span><span class="plain">;</span>
            <span class="functiontext">Coverage::list</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="constant">CODE_MENTIONS_PCON</span><span class="plain">+</span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">, 0, </span><span class="constant">DOC_MENTIONS_PCON</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="constant">OUTDENT</span><span class="plain">;</span>

        <span class="constant">OUTDENT</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">all_is_well</span><span class="plain">) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"All is well.\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="reserved">else</span><span class="plain"> </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"This needs attention.\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">all_is_well</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">Coverage::cite</span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">mask</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">mask2</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">wchar_t</span><span class="plain"> *</span><span class="identifier">message</span><span class="plain">) {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">N</span><span class="plain"> = 0;</span>
        <span class="reserved">known_problem</span><span class="plain"> *</span><span class="identifier">KP</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">KP</span><span class="plain">, </span><span class="reserved">known_problem</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;contexts_observed</span><span class="plain"> &amp; </span><span class="identifier">mask</span><span class="plain">) == </span><span class="identifier">val</span><span class="plain">) </span><span class="identifier">N</span><span class="plain">++;</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;contexts_observed_multiple_times</span><span class="plain"> &amp; </span><span class="identifier">mask2</span><span class="plain">) == </span><span class="identifier">val</span><span class="plain">) </span><span class="identifier">N</span><span class="plain">++;</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">N</span><span class="plain">&gt;0) &amp;&amp; (</span><span class="identifier">message</span><span class="plain">)) </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%d problem(s) %w\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">N</span><span class="plain">, </span><span class="identifier">message</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">N</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Coverage::list</span><span class="plain">(</span><span class="constant">OUTPUT_STREAM</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">mask</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">mask2</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">val</span><span class="plain">) {</span>
        <span class="constant">INDENT</span><span class="plain">;</span>
        <span class="reserved">known_problem</span><span class="plain"> *</span><span class="identifier">KP</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">KP</span><span class="plain">, </span><span class="reserved">known_problem</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (((</span><span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;contexts_observed</span><span class="plain"> &amp; </span><span class="identifier">mask</span><span class="plain">) == </span><span class="identifier">val</span><span class="plain">) ||</span>
                <span class="plain">((</span><span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;contexts_observed_multiple_times</span><span class="plain"> &amp; </span><span class="identifier">mask2</span><span class="plain">) == </span><span class="identifier">val</span><span class="plain">)) {</span>
                <span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"%S\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">KP</span><span class="plain">-</span><span class="element">&gt;name</span><span class="plain">);</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="constant">OUTDENT</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function Coverage::check is used in 1/mn (<a href="1-mn.html#SP2">&#167;2</a>).</p>

<p class="endnote">The function Coverage::cite appears nowhere else.</p>

<p class="endnote">The function Coverage::list appears nowhere else.</p>

<!--End of weave: 262 lines from a web of 9902-->
	</body>
</html>

