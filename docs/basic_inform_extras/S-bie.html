<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Booklet Title</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="inweb.css" rel="stylesheet" rev="stylesheet" type="text/css"><style type="text/css">
/* This is a CSS file for pages woven by the literate programming tool inweb */

/* We'll start with syntax colouring, since everyone likes to toy with this: */

.cwebmacrotext { color: #000000; font-weight: bold; } /* The name of a web macro */
.functiontext  { color: #C00000; } /* When a C function is being defined */
.string        { color: #408040; } /* A double-quoted C literal string */
.character     { color: #204020; } /* A single-quoted C literal character */
.constant     { color: #204020; } /* A named constant */
.element    { color: #40407f; } /* A C structure element */
.identifier    { color: #4040ff; } /* An identifier */
.reserved      { color: #600000; } /* A reserved word */

/* Comments at the end of lines are rendered like so: */

.comment {
	font: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
	color: #404040;
	font-style:italic;
}

/* The name of a web macro when being used: */

.cwebmacro {
	font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
	text-decoration: none;
	color: #000000; font-weight: bold;
}

.cwebmacronumber {
	font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
	font-size: 80%;
	text-decoration: none;
	color: #000000;
}

/* And when being defined: */

.cwebmacrodefn {
	font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
	text-decoration: none;
	color: #000000; font-weight: bold;
	font-weight:bold;
}

/* Now some generalities: */

body {
	background-color: #ffffff;
	margin: 8px;
	font-family: "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
	font-size: 16px;
	line-height: 24px;
	background-color: transparent;
	-webkit-font-smoothing: antialiased;
}

/* Forms of paragraph: */

p {
	margin: 0;
	padding-top: 5px;
	padding-bottom: 5px;
	clear: both;
}

/* Where an inweb paragraph begins: */

p.inwebparagraph {
	padding-top: 15px;
	padding-bottom: 5px;
}

/* If a web macro definition begins in its own paragraph, this is it: */

p.macrodefinition {
	padding-top: 0px;
	padding-bottom: 0px;
	margin-left: 30px;
}

/* The endnotes at the foot of code: "The function foo_bar is used in ..." */

p.endnote {
	font-size: 0.8em;
	padding-top: 0px;
	padding-bottom: 0px;
	margin-left: 30px;
	text-decoration:none;
	color: #000000;
}

/* The Purpose slug: */

p.purpose {
	font-size: 1em;
	font-style:italic;	
	margin-left: 15px;
}

/* Blocks of code appear in these */

pre {
	font-family: Monaco, monospace;
}

pre.display {
	padding: 3px;
	margin-top: 5px;
	margin-bottom: 5px;
	margin-left: 30px;
	margin-right: 10px;
	background: #f8f8f8;
	border-width: 1px;
	border-style: solid solid solid solid;
	border-color: #ccc;
	word-wrap: break-word;
	white-space: pre-wrap;
}

pre.displaydefn {
	padding: 3px;
	margin-top: 0px;
	margin-bottom: 0px;
	margin-left: 0px;
	margin-right: 10px;
	background: #f8f8f8;
	border-width: 1px;
	border-style: solid solid solid solid;
	border-color: #ccc;
	word-wrap: break-word;
	white-space: pre-wrap;
}

pre.definitions {
	padding-top: 0px;
	margin-top: 0px;
	margin-left: 0px;
	margin-right: 10px;
	word-wrap: break-word;
	white-space: pre-wrap;
}

/* The following are for breadcrumbs of links: */

ul, li {
	list-style-type:none;
	padding:0;
	margin:0;
}

.crumbs {
	border:1px solid #dedede;
	height:3.45em;
}

.crumbs li {
	float:left;
	line-height:2.3em;
	padding-left:.75em;
	color:#333;
	font-size: 1.5em;
}

.crumbs li a {
	display:block;
	padding:0 15px 0 0;
	background:url(crumbs.gif) no-repeat right center;
}

.crumbs li a:link, #crumbs li a:visited {
	text-decoration:none;
	color:#333;
}

.crumbs li a:hover, #crumbs li a:focus {
	color:#dd2c0d;
}

/* This is for items in lists from inweb source: */

ul.items {
	margin-top: 3px;
	margin-bottom: 3px;
}

ul.items li {
	margin-top: 1px;
	margin-bottom: 1px;
	margin-left: 15px;
}

/* And this is for each section's table of contents: */

ul.toc {
	margin-top: 3px;
	margin-bottom: 3px;
}

ul.toc li {
	float:left;
	margin-left: 15px;
	color:#000;
}

ul.toc li a {
	display:block;
}

ul.toc li a:link, ul.toc li a:visited {
	text-decoration:none;
	color:#000;
}

ul.toc li a:hover, ul.toc li a:focus {
	color:#dd2c0d;
}

hr.tocbar {
	clear: both;
	margin-top:3px;
	margin-bottom:3px;
	color:#333;
	border:0
	background-color:#333;
}

/* This is for cross-reference links ("This code is used in ...") */

p.endnote:link, p.endnote:visited, p.endnote:hover, p.endnote:focus {
	text-decoration:none;
	color:#000;
}

p.endnote a:link, p.endnote a:visited {
	text-decoration:none;
	color:#000;
}

p.endnote a:hover, p.endnote a:focus {
	text-decoration:none;
	color:#dd2c0d;
}

/* Now for the index page */

p.heading {
	margin-top: 2px;
	margin-bottom: 2px;
	font-size: 20
}
p.chapter {
	font-size: 14
}
p.tight {
	font-size: 12
}
p.tightin {
	padding-left: 25px;
	font-size: 12
}
.chapterlist li {
	padding-top: 8px;
	padding-left: 16px;
}
.chaptertitle {
	font-weight: bold;
}
.chapterlist .sectionlist li {
	padding-left: 48px;
}
span.definitionkeyword {
	color:#801010;
	font-weight:bold;
}
span.extract {
	font-size: 15px;
	border: 1px solid #e8e8e8;
	border-radius: 3px;
	background-color: #eef;
	width: 100%;
	padding: 3px;
}



</style>

	</head>
	<body>

<!--Weave of 'S/bie' generated by 7-->
<ul class="crumbs"><li><b>basic_inform_extras Template Library</b></li></ul><p class="purpose">Additions to the Basic Inform template which are needed only if the Standard Rules are not to be used.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Justification</a></li><li><a href="#SP2">&#167;2. Miscellany</a></li><li><a href="#SP3">&#167;3. Veneer</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Justification. </b>Q. Why isn't all of this done with conditional compilation in the Basic Inform
template files? A. That wouldn't work, since template files are assimilated
before it is known how they will be used.
</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2. Miscellany. </b></p>


<pre class="display">
    <span class="plain">[ DefaultTopic; return 0; ];</span>
    <span class="plain">[ PrintSnippet x; ];</span>
    <span class="plain">[ LIST_WRITER_INTERNAL_RM x;</span>
        <span class="plain">print " and ";</span>
    <span class="plain">];</span>
    <span class="plain">[ RunTimeProblemShowWM n x y z; ];</span>
    <span class="plain">[ OwnerOf o; return nothing; ];</span>
    <span class="plain">[ MoveObject from to; ];</span>
    <span class="plain">[ WriteListOfMarkedObjects in_style</span>
        <span class="plain">obj c;</span>
        <span class="plain">objectloop (obj ofclass Object &amp;&amp; obj has workflag2) {</span>
            <span class="plain">c++;</span>
        <span class="plain">}</span>
        <span class="plain">objectloop (obj ofclass Object &amp;&amp; obj has workflag2) {</span>
            <span class="plain">PrintShortName(obj);</span>
            <span class="plain">c--;</span>
            <span class="plain">if (c &gt; 0) print ", ";</span>
        <span class="plain">}</span>
    <span class="plain">];</span>
    <span class="plain">[ PrintShortName obj;</span>
        <span class="plain">print (object) obj;</span>
    <span class="plain">];</span>
    <span class="plain">[ Main;</span>
        <span class="plain">#ifdef TARGET_ZCODE; max_z_object = #largest_object - 255; #endif;</span>
        <span class="plain">VM_Initialise();</span>
        <span class="plain">print "^";</span>
        <span class="plain">INITIALISE_MEMORY_R();</span>
        <span class="plain">SEED_RANDOM_NUMBER_GENERATOR_R();</span>
        <span class="plain">ClearRTP();</span>
        <span class="plain">FollowRulebook(STARTUP_RB);</span>
        <span class="plain">Submain();</span>
        <span class="plain">FollowRulebook(SHUTDOWN_RB);</span>
    <span class="plain">];</span>

    <span class="plain">Constant FBNA_PROP_NUMBER = MAX_POSITIVE_NUMBER;</span>

    <span class="plain">[ INITIALISE_MEMORY_R;</span>
        <span class="plain">#ifdef TARGET_GLULX; VM_PreInitialise(); #Endif;</span>
        <span class="plain">#Ifdef LanguageInitialise; LanguageInitialise(); #Endif;</span>

        <span class="plain">CreatePropertyOffsets();</span>
        <span class="plain">HeapInitialise(); ! Create a completely unused memory allocation heap</span>
        <span class="plain">StackFramingInitialise(); ! Create an empty stack</span>
        <span class="plain">CreateDynamicRelations(); ! Create relation structures on the heap</span>

        <span class="plain">rfalse;</span>
    <span class="plain">];</span>

    <span class="plain">[ DrawStatusLine width posb;</span>
    <span class="plain">];</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3. Veneer. </b></p>


<pre class="display">
    <span class="plain">#Ifdef TARGET_ZCODE;</span>
    <span class="plain">[ OC__Cl obj cla j a n objflag;</span>

        <span class="plain">@jl obj 1 ?NotObj;</span>
        <span class="plain">@jg obj max_z_object ?NotObj;</span>
        <span class="plain">@inc objflag;</span>
        <span class="plain">.NotObj;</span>

        <span class="plain">@je cla Object Class ?ObjOrClass;</span>
        <span class="plain">@je cla Routine String ?RoutOrStr;</span>

        <span class="plain">@jin cla 1 ?~Mistake;</span>

        <span class="plain">@jz objflag ?rfalse;</span>
        <span class="plain">@get_prop_addr obj 2 -&gt; a;</span>
        <span class="plain">@jz a ?rfalse;</span>
        <span class="plain">@get_prop_len a -&gt; n;</span>

        <span class="plain">@div n 2 -&gt; n;</span>
        <span class="plain">.Loop;</span>
        <span class="plain">@loadw a j -&gt; sp;</span>
        <span class="plain">@je sp cla ?rtrue;</span>
        <span class="plain">@inc j;</span>
        <span class="plain">@jl j n ?Loop;</span>
        <span class="plain">@rfalse;</span>

        <span class="plain">.ObjOrClass;</span>
        <span class="plain">@jz objflag ?rfalse;</span>
        <span class="plain">@je cla Object ?JustObj;</span>

        <span class="plain">! So now cla is Class</span>
        <span class="plain">@jg obj String ?~rtrue;</span>
        <span class="plain">@jin obj Class ?rtrue;</span>
        <span class="plain">@rfalse;</span>

        <span class="plain">.JustObj;</span>
        <span class="plain">! So now cla is Object</span>
        <span class="plain">@jg obj String ?~rfalse;</span>
        <span class="plain">@jin obj Class ?rfalse;</span>
        <span class="plain">@rtrue;</span>

        <span class="plain">.RoutOrStr;</span>
        <span class="plain">@jz objflag ?~rfalse;</span>
        <span class="plain">@call_2s Z__Region obj -&gt; sp;</span>
        <span class="plain">@inc sp;</span>
        <span class="plain">@je sp cla ?rtrue;</span>
        <span class="plain">@rfalse;</span>

        <span class="plain">.Mistake;</span>
        <span class="plain">RT__Err("apply 'ofclass' for", cla, -1);</span>
        <span class="plain">rfalse;</span>
    <span class="plain">];</span>
    <span class="plain">#Endif;</span>

</pre>

<p class="inwebparagraph"></p>

<hr class="tocbar">
<ul class="toc"><li><i>(This section begins Sections.)</i></li><li><i>(This section ends Sections.)</i></li></ul><hr class="tocbar">
<!--End of weave-->
	</body>
</html>

