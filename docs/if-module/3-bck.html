<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>3/tp</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>

<!--Weave of '3/bck' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">&#9733;</a></li><li><a href="index.html">if</a></li><li><a href="index.html#3">Chapter 3: Space and Time</a></li><li><b>Backdrops</b></li></ul><p class="purpose">A plugin to provide support for backdrop objects, which are present as scenery in multiple rooms at once.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Definitions</a></li><li><a href="#SP4">&#167;4. Initialisation</a></li><li><a href="#SP5">&#167;5. Kinds</a></li><li><a href="#SP8">&#167;8. Properties</a></li><li><a href="#SP11">&#167;11. Inferences</a></li><li><a href="#SP15">&#167;15. Everywhere</a></li><li><a href="#SP18">&#167;18. Model completion</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Definitions. </b></p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>While we normally assume that nothing can be in more than one place at
once, backdrops are an exception. These are intended to represent widely
spread, probably background, things, such as the sky, and they placing one
inside something generates <code class="display"><span class="extract">FOUND_IN_INF</span></code> rather than <code class="display"><span class="extract">PARENTAGE_INF</span></code>
inferences to avoid piling up bogus inconsistencies.
</p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="constant">FOUND_IN_INF</span><span class="plain"> 56 </span>    <span class="comment">for backdrop things in many places</span>
    <span class="definitionkeyword">define</span> <span class="constant">FOUND_EVERYWHERE_INF</span><span class="plain"> 57 </span>    <span class="comment">ditto</span>
</pre>

<pre class="display">
    <span class="identifier">kind</span><span class="plain"> *</span><span class="identifier">K_backdrop</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
    <span class="identifier">property</span><span class="plain"> *</span><span class="identifier">P_scenery</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">; </span>    <span class="comment">an I7 either/or property marking something as scenery</span>
    <span class="identifier">property</span><span class="plain"> *</span><span class="identifier">P_absent</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">; </span>    <span class="comment">an I6-only property for backdrops out of play</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b></p>


<pre class="display">
    <span class="reserved">typedef</span><span class="plain"> </span><span class="reserved">struct</span><span class="plain"> </span><span class="reserved">backdrop_found_in_notice</span><span class="plain"> {</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">backdrop</span><span class="plain">;</span>
        <span class="reserved">struct</span><span class="plain"> </span><span class="identifier">inter_name</span><span class="plain"> *</span><span class="identifier">found_in_routine_iname</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">many_places</span><span class="plain">;</span>
        <span class="identifier">MEMORY_MANAGEMENT</span>
    <span class="plain">} </span><span class="reserved">backdrop_found_in_notice</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The structure backdrop_found_in_notice is private to this section.</p>

<p class="inwebparagraph"><a id="SP4"></a><b>&#167;4. Initialisation. </b></p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::start</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="identifier">PLUGIN_REGISTER</span><span class="plain">(</span><span class="identifier">PLUGIN_NEW_BASE_KIND_NOTIFY</span><span class="plain">, </span><span class="functiontext">PL::Backdrops::backdrops_new_base_kind_notify</span><span class="plain">);</span>
        <span class="identifier">PLUGIN_REGISTER</span><span class="plain">(</span><span class="identifier">PLUGIN_NEW_PROPERTY_NOTIFY</span><span class="plain">, </span><span class="functiontext">PL::Backdrops::backdrops_new_property_notify</span><span class="plain">);</span>
        <span class="identifier">PLUGIN_REGISTER</span><span class="plain">(</span><span class="identifier">PLUGIN_COMPLETE_MODEL</span><span class="plain">, </span><span class="functiontext">PL::Backdrops::backdrops_complete_model</span><span class="plain">);</span>
        <span class="identifier">PLUGIN_REGISTER</span><span class="plain">(</span><span class="identifier">PLUGIN_LOG_INFERENCE_TYPE</span><span class="plain">, </span><span class="functiontext">PL::Backdrops::backdrops_log_inference_type</span><span class="plain">);</span>
        <span class="identifier">PLUGIN_REGISTER</span><span class="plain">(</span><span class="identifier">PLUGIN_ESTIMATE_PROPERTY_USAGE</span><span class="plain">, </span><span class="functiontext">PL::Backdrops::backdrops_estimate_property_usage</span><span class="plain">);</span>
        <span class="identifier">PLUGIN_REGISTER</span><span class="plain">(</span><span class="identifier">PLUGIN_INTERVENE_IN_ASSERTION</span><span class="plain">, </span><span class="functiontext">PL::Backdrops::backdrops_intervene_in_assertion</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::start appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP5"></a><b>&#167;5. Kinds. </b>This a kind name to do with backdrops which Inform provides special support
for; it recognises the English name when defined by the Standard Rules. (So
there is no need to translate this to other languages.)
</p>


<pre class="display">
    <span class="plain">&lt;</span><span class="identifier">notable</span><span class="plain">-</span><span class="identifier">backdrops</span><span class="plain">-</span><span class="identifier">kinds</span><span class="plain">&gt; ::=</span>
        <span class="identifier">backdrop</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP6"></a><b>&#167;6.  </b></p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::backdrops_new_base_kind_notify</span><span class="plain">(</span><span class="identifier">kind</span><span class="plain"> *</span><span class="identifier">new_base</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">name</span><span class="plain">, </span><span class="identifier">wording</span><span class="plain"> </span><span class="identifier">W</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (&lt;</span><span class="identifier">notable</span><span class="plain">-</span><span class="identifier">backdrops</span><span class="plain">-</span><span class="identifier">kinds</span><span class="plain">&gt;(</span><span class="identifier">W</span><span class="plain">)) {</span>
            <span class="identifier">K_backdrop</span><span class="plain"> = </span><span class="identifier">new_base</span><span class="plain">; </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::backdrops_new_base_kind_notify is used in <a href="#SP4">&#167;4</a>.</p>

<p class="inwebparagraph"><a id="SP7"></a><b>&#167;7.  </b></p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::object_is_a_backdrop</span><span class="plain">(</span><span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">I</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">Plugins::Manage::plugged_in</span><span class="plain">(</span><span class="identifier">regions_plugin</span><span class="plain">)) &amp;&amp; (</span><span class="identifier">K_backdrop</span><span class="plain">) &amp;&amp; (</span><span class="identifier">I</span><span class="plain">) &amp;&amp;</span>
            <span class="plain">(</span><span class="identifier">Instances::of_kind</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">, </span><span class="identifier">K_backdrop</span><span class="plain">))) </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::object_is_a_backdrop is used in <a href="#SP13">&#167;13</a>.</p>

<p class="inwebparagraph"><a id="SP8"></a><b>&#167;8. Properties. </b>This is a property name to do with backdrops which Inform provides special
support for; it recognises the English name when it is defined by the
Standard Rules. (So there is no need to translate this to other languages.)
</p>


<pre class="display">
    <span class="plain">&lt;</span><span class="identifier">notable</span><span class="plain">-</span><span class="identifier">backdrops</span><span class="plain">-</span><span class="identifier">properties</span><span class="plain">&gt; ::=</span>
        <span class="identifier">scenery</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP9"></a><b>&#167;9.  </b></p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::backdrops_new_property_notify</span><span class="plain">(</span><span class="identifier">property</span><span class="plain"> *</span><span class="identifier">prn</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (&lt;</span><span class="identifier">notable</span><span class="plain">-</span><span class="identifier">backdrops</span><span class="plain">-</span><span class="identifier">properties</span><span class="plain">&gt;(</span><span class="identifier">prn</span><span class="plain">-</span><span class="element">&gt;name</span><span class="plain">))</span>
            <span class="identifier">P_scenery</span><span class="plain"> = </span><span class="identifier">prn</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::object_is_scenery</span><span class="plain">(</span><span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">I</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">World::Inferences::get_EO_state</span><span class="plain">(</span><span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">), </span><span class="identifier">P_scenery</span><span class="plain">) &gt; 0)</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::backdrops_new_property_notify is used in <a href="#SP4">&#167;4</a>.</p>

<p class="endnote">The function PL::Backdrops::object_is_scenery is used in 3/sm (<a href="3-sm.html#SP19">&#167;19</a>).</p>

<p class="inwebparagraph"><a id="SP10"></a><b>&#167;10.  </b>Every backdrop needs a single-word property (<code class="display"><span class="extract">found_in</span></code> at the I6 level):
</p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::backdrops_estimate_property_usage</span><span class="plain">(</span><span class="identifier">kind</span><span class="plain"> *</span><span class="identifier">k</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> *</span><span class="identifier">words_used</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Kinds::Compare::eq</span><span class="plain">(</span><span class="identifier">k</span><span class="plain">, </span><span class="identifier">K_backdrop</span><span class="plain">)) *</span><span class="identifier">words_used</span><span class="plain"> += 2;</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::backdrops_estimate_property_usage is used in <a href="#SP4">&#167;4</a>.</p>

<p class="inwebparagraph"><a id="SP11"></a><b>&#167;11. Inferences. </b></p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::backdrops_log_inference_type</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">it</span><span class="plain">) {</span>
        <span class="reserved">switch</span><span class="plain">(</span><span class="identifier">it</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">FOUND_IN_INF</span><span class="plain">: </span><span class="identifier">LOG</span><span class="plain">(</span><span class="string">"FOUND_IN_INF"</span><span class="plain">); </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">TRUE</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">FOUND_EVERYWHERE_INF</span><span class="plain">: </span><span class="identifier">LOG</span><span class="plain">(</span><span class="string">"FOUND_EVERYWHERE_INF"</span><span class="plain">); </span><span class="reserved">return</span><span class="plain"> </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::backdrops_log_inference_type is used in <a href="#SP4">&#167;4</a>.</p>

<p class="inwebparagraph"><a id="SP12"></a><b>&#167;12.  </b>Here we look at "in" and "part of" relationships to see if they concern
backdrops; if they do, then they need to become <code class="display"><span class="extract">FOUND_IN_INF</span></code> inferences.
Without this intervention, they'd be subject to the usual spatial rules
and text like
</p>

<blockquote>
    <p>The sky is in the Grand Balcony. The sky is in the Vizier's Lawn.</p>

</blockquote>

<p class="inwebparagraph">would lead to contradiction problem messages.
</p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::assert_relations</span><span class="plain">(</span><span class="identifier">binary_predicate</span><span class="plain"> *</span><span class="identifier">relation</span><span class="plain">,</span>
        <span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">I0</span><span class="plain">, </span><span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">I1</span><span class="plain">) {</span>

        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">Instances::of_kind</span><span class="plain">(</span><span class="identifier">I1</span><span class="plain">, </span><span class="identifier">K_backdrop</span><span class="plain">)) &amp;&amp;</span>
            <span class="plain">((</span><span class="identifier">relation</span><span class="plain"> == </span><span class="identifier">R_incorporation</span><span class="plain">) ||</span>
                <span class="plain">(</span><span class="identifier">relation</span><span class="plain"> == </span><span class="identifier">R_containment</span><span class="plain">) ||</span>
                <span class="plain">(</span><span class="identifier">relation</span><span class="plain"> == </span><span class="identifier">R_regional_containment</span><span class="plain">))) {</span>
            <span class="identifier">inference_subject</span><span class="plain"> *</span><span class="identifier">bd</span><span class="plain"> = </span><span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">I1</span><span class="plain">);</span>
            <span class="identifier">inference_subject</span><span class="plain"> *</span><span class="identifier">loc</span><span class="plain"> = </span><span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">I0</span><span class="plain">);</span>
            <span class="identifier">World::Inferences::draw</span><span class="plain">(</span><span class="constant">PART_OF_INF</span><span class="plain">, </span><span class="identifier">bd</span><span class="plain">, </span><span class="identifier">IMPOSSIBLE_CE</span><span class="plain">, </span><span class="identifier">loc</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
            <span class="identifier">World::Inferences::draw</span><span class="plain">(</span><span class="constant">IS_ROOM_INF</span><span class="plain">, </span><span class="identifier">bd</span><span class="plain">, </span><span class="identifier">IMPOSSIBLE_CE</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
            <span class="identifier">World::Inferences::draw</span><span class="plain">(</span><span class="constant">FOUND_IN_INF</span><span class="plain">, </span><span class="identifier">bd</span><span class="plain">, </span><span class="identifier">CERTAIN_CE</span><span class="plain">, </span><span class="identifier">loc</span><span class="plain">, </span><span class="identifier">loc</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>

        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::assert_relations is used in 3/sr (<a href="3-sr.html#SP6_1">&#167;6.1</a>).</p>

<p class="inwebparagraph"><a id="SP13"></a><b>&#167;13.  </b>For indexing purposes, the following loops are useful:
</p>


<pre class="definitions">
    <span class="definitionkeyword">define</span> <span class="identifier">LOOP_OVER_BACKDROPS_IN</span><span class="plain">(</span><span class="identifier">B</span><span class="plain">, </span><span class="identifier">P</span><span class="plain">, </span><span class="identifier">I</span><span class="plain">)</span>
        <span class="identifier">LOOP_OVER_OBJECT_INSTANCES</span><span class="plain">(</span><span class="identifier">B</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">PL::Backdrops::object_is_a_backdrop</span><span class="plain">(</span><span class="identifier">B</span><span class="plain">))</span>
                <span class="identifier">POSITIVE_KNOWLEDGE_LOOP</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">, </span><span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">B</span><span class="plain">), </span><span class="constant">FOUND_IN_INF</span><span class="plain">)</span>
                    <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">World::Inferences::get_reference_as_object</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">) == </span><span class="identifier">P</span><span class="plain">)</span>
    <span class="definitionkeyword">define</span> <span class="identifier">LOOP_OVER_BACKDROPS_EVERYWHERE</span><span class="plain">(</span><span class="identifier">B</span><span class="plain">, </span><span class="identifier">I</span><span class="plain">)</span>
        <span class="identifier">LOOP_OVER_OBJECT_INSTANCES</span><span class="plain">(</span><span class="identifier">B</span><span class="plain">)</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="functiontext">PL::Backdrops::object_is_a_backdrop</span><span class="plain">(</span><span class="identifier">B</span><span class="plain">))</span>
                <span class="identifier">POSITIVE_KNOWLEDGE_LOOP</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">, </span><span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">B</span><span class="plain">), </span><span class="constant">FOUND_EVERYWHERE_INF</span><span class="plain">)</span>
</pre>
<p class="inwebparagraph"><a id="SP14"></a><b>&#167;14.  </b>Since backdrops are contained using different mechanisms, the following
(which does nothing if Backdrops isn't plugged in) adds backdrop contents to
a room called <code class="display"><span class="extract">loc</span></code>, or lists backdrops which are "everywhere" if <code class="display"><span class="extract">loc</span></code>
is <code class="display"><span class="extract">NULL</span></code>.
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::index_object_further</span><span class="plain">(</span><span class="identifier">OUTPUT_STREAM</span><span class="plain">, </span><span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">loc</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">depth</span><span class="plain">,</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">details</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">how</span><span class="plain">) {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">discoveries</span><span class="plain"> = 0;</span>
        <span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">bd</span><span class="plain">;</span>
        <span class="identifier">inference</span><span class="plain"> *</span><span class="identifier">inf</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">loc</span><span class="plain">) {</span>
            <span class="identifier">LOOP_OVER_BACKDROPS_IN</span><span class="plain">(</span><span class="identifier">bd</span><span class="plain">, </span><span class="identifier">loc</span><span class="plain">, </span><span class="identifier">inf</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> (++</span><span class="identifier">discoveries</span><span class="plain"> == 1) </span>&lt;<span class="cwebmacro">Insert fore-matter</span> <span class="cwebmacronumber">14.1</span>&gt;<span class="plain">;</span>
                <span class="identifier">Data::Objects::index</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">bd</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">depth</span><span class="plain">+1, </span><span class="identifier">details</span><span class="plain">);</span>
            <span class="plain">}</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">LOOP_OVER_BACKDROPS_EVERYWHERE</span><span class="plain">(</span><span class="identifier">bd</span><span class="plain">, </span><span class="identifier">inf</span><span class="plain">) {</span>
                <span class="reserved">if</span><span class="plain"> (++</span><span class="identifier">discoveries</span><span class="plain"> == 1) </span>&lt;<span class="cwebmacro">Insert fore-matter</span> <span class="cwebmacronumber">14.1</span>&gt;<span class="plain">;</span>
                <span class="identifier">Data::Objects::index</span><span class="plain">(</span><span class="identifier">OUT</span><span class="plain">, </span><span class="identifier">bd</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">depth</span><span class="plain">+1, </span><span class="identifier">details</span><span class="plain">);</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">discoveries</span><span class="plain"> &gt; 0) </span>&lt;<span class="cwebmacro">Insert after-matter</span> <span class="cwebmacronumber">14.2</span>&gt;<span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::index_object_further is used in 3/sm (<a href="3-sm.html#SP44">&#167;44</a>).</p>

<p class="inwebparagraph"><a id="SP14_1"></a><b>&#167;14.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Insert fore-matter</span> <span class="cwebmacronumber">14.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">how</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> 1: </span><span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">); </span><span class="identifier">WRITE</span><span class="plain">(</span><span class="string">"&lt;b&gt;Present everywhere:&lt;/b&gt;"</span><span class="plain">); </span><span class="identifier">HTML_TAG</span><span class="plain">(</span><span class="string">"br"</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> 2: </span><span class="identifier">HTML_TAG</span><span class="plain">(</span><span class="string">"br"</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP14">&#167;14</a> (twice).</p>

<p class="inwebparagraph"><a id="SP14_2"></a><b>&#167;14.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Insert after-matter</span> <span class="cwebmacronumber">14.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">how</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> 1: </span><span class="identifier">HTML_CLOSE</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">); </span><span class="identifier">HTML_TAG</span><span class="plain">(</span><span class="string">"hr"</span><span class="plain">); </span><span class="identifier">HTML_OPEN</span><span class="plain">(</span><span class="string">"p"</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> 2: </span><span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP14">&#167;14</a>.</p>

<p class="inwebparagraph"><a id="SP15"></a><b>&#167;15. Everywhere. </b>Here we defines a form of noun phrase special to Backdrops (because a backdrop
can be said to be "everywhere", which nothing else can).
</p>


<pre class="display">
    <span class="plain">&lt;</span><span class="identifier">notable</span><span class="plain">-</span><span class="identifier">backdrops</span><span class="plain">-</span><span class="identifier">noun</span><span class="plain">-</span><span class="identifier">phrases</span><span class="plain">&gt; ::=</span>
        <span class="identifier">everywhere</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP16"></a><b>&#167;16.  </b></p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::backdrops_intervene_in_assertion</span><span class="plain">(</span><span class="identifier">parse_node</span><span class="plain"> *</span><span class="identifier">px</span><span class="plain">, </span><span class="identifier">parse_node</span><span class="plain"> *</span><span class="identifier">py</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">ParseTree::get_type</span><span class="plain">(</span><span class="identifier">py</span><span class="plain">) == </span><span class="identifier">EVERY_NT</span><span class="plain">) &amp;&amp;</span>
            <span class="plain">(&lt;</span><span class="identifier">notable</span><span class="plain">-</span><span class="identifier">backdrops</span><span class="plain">-</span><span class="identifier">noun</span><span class="plain">-</span><span class="identifier">phrases</span><span class="plain">&gt;(</span><span class="identifier">ParseTree::get_text</span><span class="plain">(</span><span class="identifier">py</span><span class="plain">)))) {</span>
            <span class="identifier">inference_subject</span><span class="plain"> *</span><span class="identifier">left_subject</span><span class="plain"> = </span><span class="identifier">ParseTree::get_subject</span><span class="plain">(</span><span class="identifier">px</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">left_subject</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">)</span>
                <span class="identifier">Problems::Issue::assertion_problem</span><span class="plain">(</span><span class="identifier">_p_</span><span class="plain">(</span><span class="identifier">PM_ValueEverywhere</span><span class="plain">),</span>
                    <span class="string">"'everywhere' can only be used to place individual backdrops"</span><span class="plain">,</span>
                    <span class="string">"so although 'The mist is a backdrop. The mist is everywhere.' "</span>
                    <span class="string">"would be fine, 'Corruption is everywhere.' would not."</span><span class="plain">);</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">InferenceSubjects::domain</span><span class="plain">(</span><span class="identifier">left_subject</span><span class="plain">))</span>
                <span class="identifier">Problems::Issue::subject_problem_at_sentence</span><span class="plain">(</span><span class="identifier">_p_</span><span class="plain">(</span><span class="identifier">PM_KindOfBackdropEverywhere</span><span class="plain">),</span>
                    <span class="identifier">left_subject</span><span class="plain">,</span>
                    <span class="string">"seems to be said to be 'everywhere' in some way"</span><span class="plain">,</span>
                    <span class="string">"which doesn't make sense. An individual backdrop can be 'everywhere', "</span>
                    <span class="string">"but here we're talking about a whole kind, and it's not allowed "</span>
                    <span class="string">"to talk about general locations of a whole kind of things at once."</span><span class="plain">);</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="identifier">Calculus::Propositions::Assert::assert_true_about</span><span class="plain">(</span>
                <span class="identifier">Calculus::Propositions::Abstract::to_put_everywhere</span><span class="plain">(), </span><span class="identifier">left_subject</span><span class="plain">, </span><span class="identifier">prevailing_mood</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::backdrops_intervene_in_assertion is used in <a href="#SP4">&#167;4</a>.</p>

<p class="inwebparagraph"><a id="SP17"></a><b>&#167;17.  </b>And this is where it makes the necessary inference after such a request has
been asserted true:
</p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::infer_presence_everywhere</span><span class="plain">(</span><span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">I</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">I</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) || (</span><span class="identifier">Instances::of_kind</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">, </span><span class="identifier">K_backdrop</span><span class="plain">) == </span><span class="identifier">FALSE</span><span class="plain">)) {</span>
            <span class="identifier">Problems::Issue::sentence_problem</span><span class="plain">(</span><span class="identifier">_p_</span><span class="plain">(</span><span class="identifier">PM_EverywhereNonBackdrop</span><span class="plain">),</span>
                <span class="string">"only a backdrop can be everywhere"</span><span class="plain">,</span>
                <span class="string">"and no other kind of object will do. For instance, 'The sky is "</span>
                <span class="string">"a backdrop which is everywhere.' is allowed, but 'The travelator "</span>
                <span class="string">"is a vehicle which is everywhere.' is not."</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">World::Inferences::draw</span><span class="plain">(</span><span class="constant">FOUND_EVERYWHERE_INF</span><span class="plain">,</span>
            <span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">), </span><span class="identifier">prevailing_mood</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::infer_presence_everywhere appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP18"></a><b>&#167;18. Model completion. </b>We intervene only at Stage II, the spatial modelling stage.
</p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::backdrops_complete_model</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">stage</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">stage</span><span class="plain"> == 2) {</span>
            <span class="identifier">P_absent</span><span class="plain"> = </span><span class="identifier">Properties::EitherOr::new_nameless</span><span class="plain">(</span><span class="identifier">L</span><span class="string">"absent"</span><span class="plain">);</span>
            <span class="identifier">Properties::EitherOr::implement_as_attribute</span><span class="plain">(</span><span class="identifier">P_absent</span><span class="plain">, </span><span class="identifier">TRUE</span><span class="plain">);</span>
            <span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">I</span><span class="plain">;</span>
            <span class="identifier">LOOP_OVER_OBJECT_INSTANCES</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">) {</span>
                <span class="identifier">inter_name</span><span class="plain"> *</span><span class="identifier">FOUNDIN</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>
                &lt;<span class="cwebmacro">If the object is found everywhere, make a found-in property accordingly</span> <span class="cwebmacronumber">18.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">int</span><span class="plain"> </span><span class="identifier">room_count</span><span class="plain"> = 0, </span><span class="identifier">region_count</span><span class="plain"> = 0;</span>
                &lt;<span class="cwebmacro">Find how many rooms or regions the object is found inside</span> <span class="cwebmacronumber">18.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">FOUNDIN</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) &amp;&amp; (</span><span class="identifier">room_count</span><span class="plain"> &gt; 0) &amp;&amp; (</span><span class="identifier">room_count</span><span class="plain"> &lt; 16) &amp;&amp; (</span><span class="identifier">region_count</span><span class="plain"> == 0))</span>
                    &lt;<span class="cwebmacro">The object is found only in a few rooms, and no regions, so make it a list</span> <span class="cwebmacronumber">18.3</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">FOUNDIN</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) &amp;&amp; (</span><span class="identifier">room_count</span><span class="plain"> + </span><span class="identifier">region_count</span><span class="plain"> &gt; 0))</span>
                    &lt;<span class="cwebmacro">The object is found in many rooms or in whole regions, so make it a routine</span> <span class="cwebmacronumber">18.4</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">FOUNDIN</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) &amp;&amp; (</span><span class="identifier">Instances::of_kind</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">, </span><span class="identifier">K_backdrop</span><span class="plain">)))</span>
                    &lt;<span class="cwebmacro">The object is found nowhere, so give it a stub found-in property and mark it absent</span> <span class="cwebmacronumber">18.5</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">FOUNDIN</span><span class="plain">) </span><span class="functiontext">PL::Map::set_found_in</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">, </span><span class="identifier">FOUNDIN</span><span class="plain">);</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::backdrops_complete_model is used in <a href="#SP4">&#167;4</a>.</p>

<p class="inwebparagraph"><a id="SP18_1"></a><b>&#167;18.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">If the object is found everywhere, make a found-in property accordingly</span> <span class="cwebmacronumber">18.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">inference</span><span class="plain"> *</span><span class="identifier">inf</span><span class="plain">;</span>
        <span class="identifier">POSITIVE_KNOWLEDGE_LOOP</span><span class="plain">(</span><span class="identifier">inf</span><span class="plain">, </span><span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">), </span><span class="constant">FOUND_EVERYWHERE_INF</span><span class="plain">) {</span>
            <span class="identifier">FOUNDIN</span><span class="plain"> = </span><span class="identifier">Hierarchy::find</span><span class="plain">(</span><span class="identifier">FOUND_EVERYWHERE_HL</span><span class="plain">);</span>
            <span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP18">&#167;18</a>.</p>

<p class="inwebparagraph"><a id="SP18_2"></a><b>&#167;18.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Find how many rooms or regions the object is found inside</span> <span class="cwebmacronumber">18.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">inference</span><span class="plain"> *</span><span class="identifier">inf</span><span class="plain">;</span>
        <span class="identifier">POSITIVE_KNOWLEDGE_LOOP</span><span class="plain">(</span><span class="identifier">inf</span><span class="plain">, </span><span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">), </span><span class="constant">FOUND_IN_INF</span><span class="plain">) {</span>
            <span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">loc</span><span class="plain"> = </span><span class="identifier">World::Inferences::get_reference_as_object</span><span class="plain">(</span><span class="identifier">inf</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">K_region</span><span class="plain">) &amp;&amp; (</span><span class="identifier">Instances::of_kind</span><span class="plain">(</span><span class="identifier">loc</span><span class="plain">, </span><span class="identifier">K_region</span><span class="plain">))) </span><span class="identifier">region_count</span><span class="plain">++;</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="identifier">room_count</span><span class="plain">++;</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP18">&#167;18</a>.</p>

<p class="inwebparagraph"><a id="SP18_3"></a><b>&#167;18.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">The object is found only in a few rooms, and no regions, so make it a list</span> <span class="cwebmacronumber">18.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">package_request</span><span class="plain"> *</span><span class="identifier">PR</span><span class="plain"> = </span><span class="identifier">Hierarchy::package_within</span><span class="plain">(</span><span class="identifier">INLINE_PROPERTIES_HAP</span><span class="plain">, </span><span class="identifier">Instances::package</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">));</span>
        <span class="identifier">FOUNDIN</span><span class="plain"> = </span><span class="identifier">Hierarchy::make_iname_in</span><span class="plain">(</span><span class="identifier">INLINE_PROPERTY_HL</span><span class="plain">, </span><span class="identifier">PR</span><span class="plain">);</span>
        <span class="identifier">packaging_state</span><span class="plain"> </span><span class="identifier">save</span><span class="plain"> = </span><span class="identifier">Emit::named_array_begin</span><span class="plain">(</span><span class="identifier">FOUNDIN</span><span class="plain">, </span><span class="identifier">K_value</span><span class="plain">);</span>
        <span class="identifier">inference</span><span class="plain"> *</span><span class="identifier">inf</span><span class="plain">;</span>
        <span class="identifier">POSITIVE_KNOWLEDGE_LOOP</span><span class="plain">(</span><span class="identifier">inf</span><span class="plain">, </span><span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">), </span><span class="constant">FOUND_IN_INF</span><span class="plain">)</span>
            <span class="identifier">Emit::array_iname_entry</span><span class="plain">(</span><span class="identifier">Instances::iname</span><span class="plain">(</span><span class="identifier">World::Inferences::get_reference_as_object</span><span class="plain">(</span><span class="identifier">inf</span><span class="plain">)));</span>
        <span class="identifier">Emit::array_end</span><span class="plain">(</span><span class="identifier">save</span><span class="plain">);</span>
        <span class="identifier">Emit::annotate_i</span><span class="plain">(</span><span class="identifier">FOUNDIN</span><span class="plain">, </span><span class="identifier">INLINE_ARRAY_IANN</span><span class="plain">, 1);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP18">&#167;18</a>.</p>

<p class="inwebparagraph"><a id="SP18_4"></a><b>&#167;18.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">The object is found in many rooms or in whole regions, so make it a routine</span> <span class="cwebmacronumber">18.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">backdrop_found_in_notice</span><span class="plain"> *</span><span class="identifier">notice</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">backdrop_found_in_notice</span><span class="plain">);</span>
        <span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;backdrop</span><span class="plain"> = </span><span class="identifier">I</span><span class="plain">;</span>
        <span class="identifier">package_request</span><span class="plain"> *</span><span class="identifier">R</span><span class="plain"> = </span><span class="identifier">Instances::package</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">);</span>
        <span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;found_in_routine_iname</span><span class="plain"> = </span><span class="identifier">Hierarchy::make_iname_in</span><span class="plain">(</span><span class="identifier">BACKDROP_FOUND_IN_FN_HL</span><span class="plain">, </span><span class="identifier">R</span><span class="plain">);</span>
        <span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;many_places</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="identifier">FOUNDIN</span><span class="plain"> = </span><span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;found_in_routine_iname</span><span class="plain">;</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP18">&#167;18</a>.</p>

<p class="inwebparagraph"><a id="SP18_5"></a><b>&#167;18.5.  </b><code class="display"><span class="extract">absent</span></code> is an I6-only attribute which marks a backdrop has having been removed
from the world model. It's not sufficient for an object's <code class="display"><span class="extract">found_in</span></code> always to
say no to the question "are you in the current location?"; the I6 template
code, derived from the old I6 library, requires <code class="display"><span class="extract">absent</span></code> to be set. So:
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">The object is found nowhere, so give it a stub found-in property and mark it absent</span> <span class="cwebmacronumber">18.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">backdrop_found_in_notice</span><span class="plain"> *</span><span class="identifier">notice</span><span class="plain"> = </span><span class="identifier">CREATE</span><span class="plain">(</span><span class="reserved">backdrop_found_in_notice</span><span class="plain">);</span>
        <span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;backdrop</span><span class="plain"> = </span><span class="identifier">I</span><span class="plain">;</span>
        <span class="identifier">package_request</span><span class="plain"> *</span><span class="identifier">R</span><span class="plain"> = </span><span class="identifier">Instances::package</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">);</span>
        <span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;found_in_routine_iname</span><span class="plain"> = </span><span class="identifier">Hierarchy::make_iname_in</span><span class="plain">(</span><span class="identifier">BACKDROP_FOUND_IN_FN_HL</span><span class="plain">, </span><span class="identifier">R</span><span class="plain">);</span>
        <span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;many_places</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
        <span class="identifier">FOUNDIN</span><span class="plain"> = </span><span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;found_in_routine_iname</span><span class="plain">;</span>
        <span class="identifier">Properties::EitherOr::assert</span><span class="plain">(</span>
            <span class="identifier">P_absent</span><span class="plain">, </span><span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">), </span><span class="identifier">TRUE</span><span class="plain">, </span><span class="identifier">CERTAIN_CE</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP18">&#167;18</a>.</p>

<p class="inwebparagraph"><a id="SP19"></a><b>&#167;19.  </b></p>


<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">PL::Backdrops::write_found_in_routines</span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="reserved">backdrop_found_in_notice</span><span class="plain"> *</span><span class="identifier">notice</span><span class="plain">;</span>
        <span class="identifier">LOOP_OVER</span><span class="plain">(</span><span class="identifier">notice</span><span class="plain">, </span><span class="reserved">backdrop_found_in_notice</span><span class="plain">) {</span>
            <span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">I</span><span class="plain"> = </span><span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;backdrop</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;many_places</span><span class="plain">)</span>
                &lt;<span class="cwebmacro">The object is found in many rooms or in whole regions</span> <span class="cwebmacronumber">19.1</span>&gt;
            <span class="reserved">else</span>
                &lt;<span class="cwebmacro">The object is found nowhere</span> <span class="cwebmacronumber">19.2</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function PL::Backdrops::write_found_in_routines appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP19_1"></a><b>&#167;19.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">The object is found in many rooms or in whole regions</span> <span class="cwebmacronumber">19.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">packaging_state</span><span class="plain"> </span><span class="identifier">save</span><span class="plain"> = </span><span class="identifier">Routines::begin</span><span class="plain">(</span><span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;found_in_routine_iname</span><span class="plain">);</span>
        <span class="identifier">inference</span><span class="plain"> *</span><span class="identifier">inf</span><span class="plain">;</span>
        <span class="identifier">POSITIVE_KNOWLEDGE_LOOP</span><span class="plain">(</span><span class="identifier">inf</span><span class="plain">, </span><span class="identifier">Instances::as_subject</span><span class="plain">(</span><span class="identifier">I</span><span class="plain">), </span><span class="constant">FOUND_IN_INF</span><span class="plain">) {</span>
            <span class="identifier">instance</span><span class="plain"> *</span><span class="identifier">loc</span><span class="plain"> = </span><span class="identifier">World::Inferences::get_reference_as_object</span><span class="plain">(</span><span class="identifier">inf</span><span class="plain">);</span>
            <span class="identifier">Emit::inv_primitive</span><span class="plain">(</span><span class="identifier">Emit::opcode</span><span class="plain">(</span><span class="identifier">IF_BIP</span><span class="plain">));</span>
            <span class="identifier">Emit::down</span><span class="plain">();</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">K_region</span><span class="plain">) &amp;&amp; (</span><span class="identifier">Instances::of_kind</span><span class="plain">(</span><span class="identifier">loc</span><span class="plain">, </span><span class="identifier">K_region</span><span class="plain">))) {</span>
                <span class="identifier">Emit::inv_call_iname</span><span class="plain">(</span><span class="identifier">Hierarchy::find</span><span class="plain">(</span><span class="identifier">TESTREGIONALCONTAINMENT_HL</span><span class="plain">));</span>
                <span class="identifier">Emit::down</span><span class="plain">();</span>
                    <span class="identifier">Emit::val_iname</span><span class="plain">(</span><span class="identifier">K_object</span><span class="plain">, </span><span class="identifier">Hierarchy::find</span><span class="plain">(</span><span class="identifier">LOCATION_HL</span><span class="plain">));</span>
                    <span class="identifier">Emit::val_iname</span><span class="plain">(</span><span class="identifier">K_object</span><span class="plain">, </span><span class="identifier">Instances::iname</span><span class="plain">(</span><span class="identifier">loc</span><span class="plain">));</span>
                <span class="identifier">Emit::up</span><span class="plain">();</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                <span class="identifier">Emit::inv_primitive</span><span class="plain">(</span><span class="identifier">Emit::opcode</span><span class="plain">(</span><span class="identifier">EQ_BIP</span><span class="plain">));</span>
                <span class="identifier">Emit::down</span><span class="plain">();</span>
                    <span class="identifier">Emit::val_iname</span><span class="plain">(</span><span class="identifier">K_object</span><span class="plain">, </span><span class="identifier">Hierarchy::find</span><span class="plain">(</span><span class="identifier">LOCATION_HL</span><span class="plain">));</span>
                    <span class="identifier">Emit::val_iname</span><span class="plain">(</span><span class="identifier">K_object</span><span class="plain">, </span><span class="identifier">Instances::iname</span><span class="plain">(</span><span class="identifier">loc</span><span class="plain">));</span>
                <span class="identifier">Emit::up</span><span class="plain">();</span>
            <span class="plain">}</span>
                <span class="identifier">Emit::code</span><span class="plain">();</span>
                <span class="identifier">Emit::down</span><span class="plain">();</span>
                    <span class="identifier">Emit::rtrue</span><span class="plain">();</span>
                <span class="identifier">Emit::up</span><span class="plain">();</span>
            <span class="identifier">Emit::up</span><span class="plain">();</span>
            <span class="identifier">Emit::rfalse</span><span class="plain">();</span>
            <span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">Routines::end</span><span class="plain">(</span><span class="identifier">save</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP19">&#167;19</a>.</p>

<p class="inwebparagraph"><a id="SP19_2"></a><b>&#167;19.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">The object is found nowhere</span> <span class="cwebmacronumber">19.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">packaging_state</span><span class="plain"> </span><span class="identifier">save</span><span class="plain"> = </span><span class="identifier">Routines::begin</span><span class="plain">(</span><span class="identifier">notice</span><span class="plain">-</span><span class="element">&gt;found_in_routine_iname</span><span class="plain">);</span>
        <span class="identifier">Emit::rfalse</span><span class="plain">();</span>
        <span class="identifier">Routines::end</span><span class="plain">(</span><span class="identifier">save</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP19">&#167;19</a>.</p>

<hr class="tocbar">
<ul class="toc"><li><a href="3-tp.html">Back to 'The Player'</a></li><li><a href="3-rgn.html">Continue with 'Regions'</a></li></ul><hr class="tocbar">
<!--End of weave-->
	</body>
</html>

