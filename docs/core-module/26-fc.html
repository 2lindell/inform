<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Fundamental Constants</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-src/Figures/Inform.png" height=72">
</a></h1>
<ul><li><a href="../compiler.html">compiler tools</a></li>
<li><a href="../other.html">other tools</a></li>
<li><a href="../extensions.html">extensions and kits</a></li>
<li><a href="../units.html">unit test tools</a></li>
</ul><h2>Compiler Webs</h2><ul>
<li><a href="../inbuild/index.html">inbuild</a></li>
<li><a href="../inform7/index.html">inform7</a></li>
<li><a href="../inter/index.html">inter</a></li>
</ul><h2>Inbuild Modules</h2><ul>
<li><a href="../supervisor-module/index.html">supervisor</a></li>
</ul><h2>Inform7 Modules</h2><ul>
<li><a href="index.html"><span class="selectedlink">core</span></a></li>
<li><a href="../inflections-module/index.html">inflections</a></li>
<li><a href="../linguistics-module/index.html">linguistics</a></li>
<li><a href="../kinds-module/index.html">kinds</a></li>
<li><a href="../if-module/index.html">if</a></li>
<li><a href="../multimedia-module/index.html">multimedia</a></li>
<li><a href="../problems-module/index.html">problems</a></li>
<li><a href="../index-module/index.html">index</a></li>
</ul><h2>Inter Modules</h2><ul>
<li><a href="../bytecode-module/index.html">bytecode</a></li>
<li><a href="../building-module/index.html">building</a></li>
<li><a href="../codegen-module/index.html">codegen</a></li>
</ul><h2>Shared Modules</h2><ul>
<li><a href="../arch-module/index.html">arch</a></li>
<li><a href="../syntax-module/index.html">syntax</a></li>
<li><a href="../words-module/index.html">words</a></li>
<li><a href="../html-module/index.html">html</a></li>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>

</ul>
		</nav>
		<main role="main">
		
<!--Weave of 'Fundamental Constants' generated by 7-->
<ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="../compiler.html">Inform7 Modules</a></li><li><a href="index.html">core</a></li><li><a href="index.html#26">Chapter 26: Compilation Utilities</a></li><li><b>Fundamental Constants</b></li></ul><p class="purpose">Inter constants for, say, extremal number values, which depend on the target we are compiling to, and are generally low-level in nature.</p>

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1.  </b>Fundamental constants are emitted about our choice of virtual machine.
</p>

<p class="inwebparagraph">The old I6 library used to confuse Z-vs-G with 16-vs-32-bit, but we try
to separate these distinctions here, even though at present the Z-machine
is our only 16-bit target and Glulx our only 32-bit one. The <code class="display"><span class="extract">WORDSIZE</span></code>
constant is the word size in bytes, so is the multiplier between <code class="display"><span class="extract">-&gt;</span></code> and
<code class="display"><span class="extract">--&gt;</span></code> offsets in I6 pointer syntax.
</p>

<p class="inwebparagraph"></p>

<ul class="items"><li>(1) <code class="display"><span class="extract">NULL</span></code> is used, as in C, to represent a null value or pointer. In C,
this is conventionally 0, but here it is the maximum unsigned value which
can be stored, pointing to the topmost byte in the directly addressable
memory map; this means it is also \(-1\) when regarded as a signed
twos-complement integer, but we write it as an unsigned hexadecimal
address for clarity's sake.
</li></ul>
<ul class="items"><li>(2) <code class="display"><span class="extract">WORD_HIGHBIT</span></code> is the most significant bit in the VM's data word.
</li></ul>
<ul class="items"><li>(3) <code class="display"><span class="extract">IMPROBABLE_VALUE</span></code> is one which is unlikely but still possible
to be a genuine I7 value. The efficiency of some algorithms depends on
how well chosen this is: they would ran badly if we chose 1, for instance.
</li></ul>
<ul class="items"><li>(4) <code class="display"><span class="extract">MAX_POSITIVE_NUMBER</span></code> is the largest representable positive (signed)
integer, in twos-complement form.
</li></ul>
<ul class="items"><li>(5) <code class="display"><span class="extract">REPARSE_CODE</span></code> is a magic value used in the I6 library's parser to
signal that some code which ought to have been parsing a command has in
fact rewritten it, so that the whole command must be re-parsed afresh.
(Returning this value is like throwing an exception in a language like
Java, though we don't implement it that way.) A comment in the 6/11 library
reads: "The parser rather gunkily adds addresses to <code class="display"><span class="extract">REPARSE_CODE</span></code> for
some purposes. And expects the result to be greater than <code class="display"><span class="extract">REPARSE_CODE</span></code>
(signed comparison). So Glulx Inform is limited to a single gigabyte of
storage, for the moment." Guilty as charged, but the gigabyte story file
is a remote prospect for now. Anyway, it's this comparison issue which
means we need a different value for each possible word size.
</li></ul>
<pre class="display">
    <span class="identifier">inter_name</span><span class="plain"> *</span><span class="functiontext">FundamentalConstants::emit_one<button class="popup" onclick="togglePopup('usagePopup2030')">...<span class="popuptext" id="usagePopup2030">Usage of <b>FundamentalConstants::emit_one</b>:<br>none</span></button></span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">id</span><span class="plain">, </span><span class="identifier">inter_t</span><span class="plain"> </span><span class="identifier">val</span><span class="plain">) {</span>
        <span class="identifier">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="identifier">id</span><span class="plain">);</span>
        <span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::make_available</a></span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">iname</span><span class="plain">);</span>
        <span class="functiontext"><a href="27-em.html#SP3">Emit::named_numeric_constant</a></span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">inter_name</span><span class="plain"> *</span><span class="functiontext">FundamentalConstants::emit_signed<button class="popup" onclick="togglePopup('usagePopup2031')">...<span class="popuptext" id="usagePopup2031">Usage of <b>FundamentalConstants::emit_signed</b>:<br>none</span></button></span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">id</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">val</span><span class="plain">) {</span>
        <span class="identifier">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="identifier">id</span><span class="plain">);</span>
        <span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::make_available</a></span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">iname</span><span class="plain">);</span>
        <span class="functiontext"><a href="27-em.html#SP3">Emit::named_numeric_constant_signed</a></span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">inter_name</span><span class="plain"> *</span><span class="functiontext">FundamentalConstants::emit_hex<button class="popup" onclick="togglePopup('usagePopup2032')">...<span class="popuptext" id="usagePopup2032">Usage of <b>FundamentalConstants::emit_hex</b>:<br>none</span></button></span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">id</span><span class="plain">, </span><span class="identifier">inter_t</span><span class="plain"> </span><span class="identifier">val</span><span class="plain">) {</span>
        <span class="identifier">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="identifier">id</span><span class="plain">);</span>
        <span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::make_available</a></span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">iname</span><span class="plain">);</span>
        <span class="functiontext"><a href="27-em.html#SP3">Emit::named_numeric_constant_hex</a></span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="identifier">inter_name</span><span class="plain"> *</span><span class="functiontext">FundamentalConstants::emit_unchecked_hex<button class="popup" onclick="togglePopup('usagePopup2033')">...<span class="popuptext" id="usagePopup2033">Usage of <b>FundamentalConstants::emit_unchecked_hex</b>:<br>none</span></button></span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">id</span><span class="plain">, </span><span class="identifier">inter_t</span><span class="plain"> </span><span class="identifier">val</span><span class="plain">) {</span>
        <span class="identifier">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="identifier">id</span><span class="plain">);</span>
        <span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::make_available</a></span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">iname</span><span class="plain">);</span>
        <span class="functiontext"><a href="27-em.html#SP3">Emit::named_unchecked_constant_hex</a></span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">);</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">iname</span><span class="plain">;</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">FundamentalConstants::emit<button class="popup" onclick="togglePopup('usagePopup2034')">...<span class="popuptext" id="usagePopup2034">Usage of <b>FundamentalConstants::emit</b>:<br>Emitting Inter - <a href="27-em.html#SP2">&#167;2</a></span></button></span><span class="plain">(</span><span class="identifier">target_vm</span><span class="plain"> *</span><span class="identifier">VM</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">VM</span><span class="plain"> == </span><span class="identifier">NULL</span><span class="plain">) </span><span class="identifier">internal_error</span><span class="plain">(</span><span class="string">"target VM not set yet"</span><span class="plain">);</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">TargetVMs::debug_enabled</span><span class="plain">(</span><span class="identifier">VM</span><span class="plain">))</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_one</a></span><span class="plain">(</span><span class="constant">DEBUG_HL</span><span class="plain">, </span><span class="constant">1</span><span class="plain">);</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::eq</span><span class="plain">(</span><span class="identifier">VM</span><span class="plain">-&gt;</span><span class="identifier">family_name</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Z-Machine"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_one</a></span><span class="plain">(</span><span class="constant">TARGET_ZCODE_HL</span><span class="plain">, </span><span class="constant">1</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_one</a></span><span class="plain">(</span><span class="constant">DICT_WORD_SIZE_HL</span><span class="plain">, </span><span class="constant">6</span><span class="plain">);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> </span><span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Str::eq</span><span class="plain">(</span><span class="identifier">VM</span><span class="plain">-&gt;</span><span class="identifier">family_name</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Glulx"</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_one</a></span><span class="plain">(</span><span class="constant">TARGET_GLULX_HL</span><span class="plain">, </span><span class="constant">1</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_one</a></span><span class="plain">(</span><span class="constant">DICT_WORD_SIZE_HL</span><span class="plain">, </span><span class="constant">9</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_one</a></span><span class="plain">(</span><span class="constant">INDIV_PROP_START_HL</span><span class="plain">, </span><span class="constant">0</span><span class="plain">);</span>
        <span class="plain">}</span>

        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">TargetVMs::is_16_bit</span><span class="plain">(</span><span class="identifier">VM</span><span class="plain">)) {</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_one</a></span><span class="plain">(</span><span class="constant">WORDSIZE_HL</span><span class="plain">, </span><span class="constant">2</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_unchecked_hex</a></span><span class="plain">(</span><span class="constant">NULL_HL</span><span class="plain">, </span><span class="constant">0xffff</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_hex</a></span><span class="plain">(</span><span class="constant">WORD_HIGHBIT_HL</span><span class="plain">, </span><span class="constant">0x8000</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_hex</a></span><span class="plain">(</span><span class="constant">WORD_NEXTTOHIGHBIT_HL</span><span class="plain">, </span><span class="constant">0x4000</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_hex</a></span><span class="plain">(</span><span class="constant">IMPROBABLE_VALUE_HL</span><span class="plain">, </span><span class="constant">0x7fe3</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_hex</a></span><span class="plain">(</span><span class="constant">REPARSE_CODE_HL</span><span class="plain">, </span><span class="constant">10000</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_one</a></span><span class="plain">(</span><span class="constant">MAX_POSITIVE_NUMBER_HL</span><span class="plain">, </span><span class="constant">32767</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_signed</a></span><span class="plain">(</span><span class="constant">MIN_NEGATIVE_NUMBER_HL</span><span class="plain">, -32768);</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_one</a></span><span class="plain">(</span><span class="constant">WORDSIZE_HL</span><span class="plain">, </span><span class="constant">4</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_unchecked_hex</a></span><span class="plain">(</span><span class="constant">NULL_HL</span><span class="plain">, </span><span class="constant">0xffffffff</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_hex</a></span><span class="plain">(</span><span class="constant">WORD_HIGHBIT_HL</span><span class="plain">, </span><span class="constant">0x80000000</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_hex</a></span><span class="plain">(</span><span class="constant">WORD_NEXTTOHIGHBIT_HL</span><span class="plain">, </span><span class="constant">0x40000000</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_hex</a></span><span class="plain">(</span><span class="constant">IMPROBABLE_VALUE_HL</span><span class="plain">, </span><span class="constant">0xdeadce11</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_hex</a></span><span class="plain">(</span><span class="constant">REPARSE_CODE_HL</span><span class="plain">, </span><span class="constant">0x40000000</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_one</a></span><span class="plain">(</span><span class="constant">MAX_POSITIVE_NUMBER_HL</span><span class="plain">, </span><span class="constant">2147483647</span><span class="plain">);</span>
            <span class="functiontext"><a href="#SP1">FundamentalConstants::emit_signed</a></span><span class="plain">(</span><span class="constant">MIN_NEGATIVE_NUMBER_HL</span><span class="plain">, -2147483648);</span>
        <span class="plain">}</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2.  </b>This version-numbering constant is not really to do with the VM (it is
Inform's own version number), but it belongs nowhere else either, so:
</p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">FundamentalConstants::emit_build_number<button class="popup" onclick="togglePopup('usagePopup2035')">...<span class="popuptext" id="usagePopup2035">Usage of <b>FundamentalConstants::emit_build_number</b>:<br>How To Compile - <a href="1-htc.html#SP2_8">&#167;2.8</a></span></button></span><span class="plain">(</span><span class="reserved">void</span><span class="plain">) {</span>
        <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">build</span><span class="plain">);</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">build</span><span class="plain">, </span><span class="string">"%B"</span><span class="plain">, </span><span class="identifier">TRUE</span><span class="plain">);</span>
        <span class="identifier">inter_name</span><span class="plain"> *</span><span class="identifier">iname</span><span class="plain"> = </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">NI_BUILD_COUNT_HL</span><span class="plain">);</span>
        <span class="functiontext"><a href="27-em.html#SP3">Emit::named_string_constant</a></span><span class="plain">(</span><span class="identifier">iname</span><span class="plain">, </span><span class="identifier">build</span><span class="plain">);</span>
        <span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::make_available</a></span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">iname</span><span class="plain">);</span>
        <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">build</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>This also doesn't really belong here, but...
</p>

<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">FundamentalConstants::veto_number<button class="popup" onclick="togglePopup('usagePopup2036')">...<span class="popuptext" id="usagePopup2036">Usage of <b>FundamentalConstants::veto_number</b>:<br>none</span></button></span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">X</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (((</span><span class="identifier">X</span><span class="plain"> &gt; </span><span class="constant">32767</span><span class="plain">) || (</span><span class="identifier">X</span><span class="plain"> &lt; -32768)) &amp;&amp;</span>
            <span class="plain">(</span><span class="identifier">TargetVMs::is_16_bit</span><span class="plain">(</span><span class="functiontext"><a href="1-wtc.html#SP5">Task::vm</a></span><span class="plain">()))) {</span>
            <span class="identifier">Problems::Issue::sentence_problem</span><span class="plain">(</span><span class="functiontext"><a href="1-wtc.html#SP5">Task::syntax_tree</a></span><span class="plain">(), </span><span class="identifier">_p_</span><span class="plain">(</span><span class="identifier">PM_LiteralOverflow</span><span class="plain">),</span>
                <span class="string">"you use a number which is too large"</span><span class="plain">,</span>
                <span class="string">"at least with the Settings for this project as they currently "</span>
                <span class="string">"are. (Change to Glulx to be allowed to use much larger numbers.)"</span><span class="plain">);</span>
            <span class="reserved">return</span><span class="plain"> </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">FALSE</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<hr class="tocbar">
<ul class="toc"><li><i>(This section begins Chapter 26: Compilation Utilities.)</i></li><li><a href="26-i6i.html">Continue with 'Inform 6 Inclusions'</a></li></ul><hr class="tocbar">
<!--End of weave-->
<script>
MathJax = {
  tex: {
    inlineMath: '$', '$'], ['\\(', '\\)'
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>

<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
		</main>
	</body>
</html>

