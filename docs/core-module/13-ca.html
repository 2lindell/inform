<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Compile Arithmetic</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-src/Figures/Inform.png" height=72">
</a></h1>
<ul><li><a href="../compiler.html">compiler tools</a></li>
<li><a href="../other.html">other tools</a></li>
<li><a href="../extensions.html">extensions and kits</a></li>
<li><a href="../units.html">unit test tools</a></li>
</ul><h2>Compiler Webs</h2><ul>
<li><a href="../inbuild/index.html">inbuild</a></li>
<li><a href="../inform7/index.html">inform7</a></li>
<li><a href="../inter/index.html">inter</a></li>
</ul><h2>Inbuild Modules</h2><ul>
<li><a href="../supervisor-module/index.html">supervisor</a></li>
</ul><h2>Inform7 Modules</h2><ul>
<li><a href="index.html"><span class="selectedlink">core</span></a></li>
<li><a href="../inflections-module/index.html">inflections</a></li>
<li><a href="../linguistics-module/index.html">linguistics</a></li>
<li><a href="../kinds-module/index.html">kinds</a></li>
<li><a href="../if-module/index.html">if</a></li>
<li><a href="../multimedia-module/index.html">multimedia</a></li>
<li><a href="../problems-module/index.html">problems</a></li>
<li><a href="../index-module/index.html">index</a></li>
</ul><h2>Inter Modules</h2><ul>
<li><a href="../bytecode-module/index.html">bytecode</a></li>
<li><a href="../building-module/index.html">building</a></li>
<li><a href="../codegen-module/index.html">codegen</a></li>
</ul><h2>Shared Modules</h2><ul>
<li><a href="../arch-module/index.html">arch</a></li>
<li><a href="../syntax-module/index.html">syntax</a></li>
<li><a href="../words-module/index.html">words</a></li>
<li><a href="../html-module/index.html">html</a></li>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>

</ul>
		</nav>
		<main role="main">
		
<!--Weave of 'Compile Arithmetic' generated by 7-->
<ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="../compiler.html">Inform7 Modules</a></li><li><a href="index.html">core</a></li><li><a href="index.html#13">Chapter 13: Bridge to Kinds Module</a></li><li><b>Compile Arithmetic</b></li></ul><p class="purpose">To compile code performing an arithmetic operation.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. Compiling arithmetic</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. Compiling arithmetic. </b></p>

<pre class="display">
    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">Kinds::Compile::perform_arithmetic_emit<button class="popup" onclick="togglePopup('usagePopup861')">...<span class="popuptext" id="usagePopup861">Usage of <b>Kinds::Compile::perform_arithmetic_emit</b>:<br>Equations - <a href="20-eq.html#SP48_1">&#167;48.1</a><br>Compile Invocations Inline - <a href="25-cii.html#SP3_5_7">&#167;3.5.7</a></span></button></span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">op</span><span class="plain">, </span><span class="reserved">equation</span><span class="plain"> *</span><span class="identifier">eqn</span><span class="plain">,</span>
        <span class="identifier">parse_node</span><span class="plain"> *</span><span class="identifier">X</span><span class="plain">, </span><span class="reserved">equation_node</span><span class="plain"> *</span><span class="identifier">EX</span><span class="plain">, </span><span class="identifier">kind</span><span class="plain"> *</span><span class="identifier">KX</span><span class="plain">,</span>
        <span class="identifier">parse_node</span><span class="plain"> *</span><span class="identifier">Y</span><span class="plain">, </span><span class="reserved">equation_node</span><span class="plain"> *</span><span class="identifier">EY</span><span class="plain">, </span><span class="identifier">kind</span><span class="plain"> *</span><span class="identifier">KY</span><span class="plain">) {</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">binary</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Kinds::Dimensions::arithmetic_op_is_unary</span><span class="plain">(</span><span class="identifier">op</span><span class="plain">)) </span><span class="identifier">binary</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">use_fp</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">, </span><span class="identifier">promote_X</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">, </span><span class="identifier">promote_Y</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">, </span><span class="identifier">reduce_modulo_1440</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">KX</span><span class="plain">) &amp;&amp; (</span><span class="identifier">KY</span><span class="plain">)) {</span>
            <span class="plain">#</span><span class="identifier">ifdef</span><span class="plain"> </span><span class="identifier">IF_MODULE</span>
            <span class="identifier">kind</span><span class="plain"> *</span><span class="identifier">KR</span><span class="plain"> = </span><span class="identifier">Kinds::Dimensions::arithmetic_on_kinds</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="identifier">KY</span><span class="plain">, </span><span class="identifier">op</span><span class="plain">);</span>
            <span class="identifier">kind</span><span class="plain"> *</span><span class="identifier">KT</span><span class="plain"> = </span><span class="functiontext"><a href="5-tod.html#SP5">PL::TimesOfDay::kind</a></span><span class="plain">();</span>
            <span class="reserved">if</span><span class="plain"> ((</span><span class="identifier">KT</span><span class="plain">) &amp;&amp; (</span><span class="identifier">Kinds::Compare::eq</span><span class="plain">(</span><span class="identifier">KR</span><span class="plain">, </span><span class="identifier">KT</span><span class="plain">))) </span><span class="identifier">reduce_modulo_1440</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
            <span class="plain">#</span><span class="identifier">endif</span>
        <span class="plain">}</span>
        &lt;<span class="cwebmacro">Choose which form of arithmetic and promotion</span> <span class="cwebmacronumber">1.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">reduce_modulo_1440</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">NUMBER_TY_TO_TIME_TY_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">}</span>
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">op</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">EQUALS_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit set-equals</span> <span class="cwebmacronumber">1.10</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">PLUS_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit plus</span> <span class="cwebmacronumber">1.2</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">MINUS_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit minus</span> <span class="cwebmacronumber">1.3</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">TIMES_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit times</span> <span class="cwebmacronumber">1.4</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">DIVIDE_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit divide</span> <span class="cwebmacronumber">1.5</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">REMAINDER_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit remainder</span> <span class="cwebmacronumber">1.6</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">APPROXIMATION_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit approximation</span> <span class="cwebmacronumber">1.7</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">ROOT_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit root</span> <span class="cwebmacronumber">1.8</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">REALROOT_OPERATION:</span><span class="plain"> </span><span class="identifier">use_fp</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">; </span>&lt;<span class="cwebmacro">Emit root</span> <span class="cwebmacronumber">1.8</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">CUBEROOT_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit cube root</span> <span class="cwebmacronumber">1.9</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">POWER_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit a power of the left operand</span> <span class="cwebmacronumber">1.12</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">UNARY_MINUS_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit unary minus</span> <span class="cwebmacronumber">1.11</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="identifier">IMPLICIT_APPLICATION_OPERATION:</span><span class="plain"> </span>&lt;<span class="cwebmacro">Emit function application</span> <span class="cwebmacronumber">1.13</span>&gt;<span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="identifier">default:</span>
                <span class="identifier">Problems::Issue::sentence_problem</span><span class="plain">(</span><span class="functiontext"><a href="1-wtc.html#SP5">Task::syntax_tree</a></span><span class="plain">(), </span><span class="identifier">_p_</span><span class="plain">(</span><span class="identifier">BelievedImpossible</span><span class="plain">),</span>
                    <span class="string">"this doesn't seem to be an arithmetic operation"</span><span class="plain">,</span>
                    <span class="string">"suggesting a problem with some inline definition."</span><span class="plain">);</span>
                <span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">reduce_modulo_1440</span><span class="plain">) </span><span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="inwebparagraph"><a id="SP1_1"></a><b>&#167;1.1.  </b>The four cases for a binary operation correspond to:
</p>

<blockquote>
    <p>pi plus pi, pi plus 3, 3 plus pi, 3 plus 3</p>

</blockquote>

<p class="inwebparagraph">respectively. If either operand is real, floating-point arithmetic is used,
and the other operand is promoted from integer to real if necessary.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Choose which form of arithmetic and promotion</span> <span class="cwebmacronumber">1.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">binary</span><span class="plain">) {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Kinds::FloatingPoint::uses_floating_point</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">)) {</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Kinds::FloatingPoint::uses_floating_point</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">)) {</span>
                    <span class="identifier">use_fp</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">; </span><span class="identifier">promote_X</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">; </span><span class="identifier">promote_Y</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
                <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                    <span class="identifier">use_fp</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">; </span><span class="identifier">promote_X</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">; </span><span class="identifier">promote_Y</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">;</span>
                <span class="plain">}</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Kinds::FloatingPoint::uses_floating_point</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">)) {</span>
                    <span class="identifier">use_fp</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">; </span><span class="identifier">promote_X</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">; </span><span class="identifier">promote_Y</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
                <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                    <span class="identifier">use_fp</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">; </span><span class="identifier">promote_X</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">; </span><span class="identifier">promote_Y</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Kinds::FloatingPoint::uses_floating_point</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">)) {</span>
                <span class="identifier">use_fp</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">; </span><span class="identifier">promote_X</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">; </span><span class="identifier">promote_Y</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
            <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
                <span class="identifier">use_fp</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">; </span><span class="identifier">promote_X</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">; </span><span class="identifier">promote_Y</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">;</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_2"></a><b>&#167;1.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit plus</span> <span class="cwebmacronumber">1.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">REAL_NUMBER_TY_PLUS_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">Produce::inv_primitive</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">PLUS_BIP</span><span class="plain">);</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_3"></a><b>&#167;1.3.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit minus</span> <span class="cwebmacronumber">1.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">REAL_NUMBER_TY_MINUS_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">Produce::inv_primitive</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">MINUS_BIP</span><span class="plain">);</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_4"></a><b>&#167;1.4.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit times</span> <span class="cwebmacronumber">1.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">REAL_NUMBER_TY_TIMES_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">Kinds::Dimensions::kind_rescale_multiplication_emit_op</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="identifier">KY</span><span class="plain">);</span>
            <span class="identifier">Produce::inv_primitive</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">TIMES_BIP</span><span class="plain">);</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
            <span class="identifier">Kinds::Dimensions::kind_rescale_multiplication_emit_factor</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="identifier">KY</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_5"></a><b>&#167;1.5.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit divide</span> <span class="cwebmacronumber">1.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">REAL_NUMBER_TY_DIVIDE_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">INTEGERDIVIDE_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                <span class="identifier">Kinds::Dimensions::kind_rescale_division_emit_op</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="identifier">KY</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="identifier">Kinds::Dimensions::kind_rescale_division_emit_factor</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="identifier">KY</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_6"></a><b>&#167;1.6.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit remainder</span> <span class="cwebmacronumber">1.6</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">REAL_NUMBER_TY_REMAINDER_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">INTEGERREMAINDER_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_7"></a><b>&#167;1.7.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit approximation</span> <span class="cwebmacronumber">1.7</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">REAL_NUMBER_TY_APPROXIMATE_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">ROUNDOFFVALUE_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_8"></a><b>&#167;1.8.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit root</span> <span class="cwebmacronumber">1.8</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">REAL_NUMBER_TY_ROOT_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">SQUAREROOT_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                <span class="identifier">Kinds::Dimensions::kind_rescale_root_emit_op</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="constant">2</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="identifier">Kinds::Dimensions::kind_rescale_root_emit_factor</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="constant">2</span><span class="plain">);</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a> (twice).</p>

<p class="inwebparagraph"><a id="SP1_9"></a><b>&#167;1.9.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit cube root</span> <span class="cwebmacronumber">1.9</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">REAL_NUMBER_TY_CUBE_ROOT_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">CUBEROOT_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                <span class="identifier">Kinds::Dimensions::kind_rescale_root_emit_op</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="constant">3</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="identifier">Kinds::Dimensions::kind_rescale_root_emit_factor</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="constant">3</span><span class="plain">);</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_10"></a><b>&#167;1.10.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit set-equals</span> <span class="cwebmacronumber">1.10</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">Produce::inv_primitive</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">STORE_BIP</span><span class="plain">);</span>
        <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
            <span class="identifier">Produce::reference</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
            &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
        <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_11"></a><b>&#167;1.11.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit unary minus</span> <span class="cwebmacronumber">1.11</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">REAL_NUMBER_TY_NEGATE_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">Produce::inv_primitive</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">UNARYMINUS_BIP</span><span class="plain">);</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_12"></a><b>&#167;1.12.  </b>We accomplish powers by repeated multiplication. This is partly because I6
has no "to the power of" function, partly because the powers involved will
always be small, partly because of the need for scaling to come out right.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Emit a power of the left operand</span> <span class="cwebmacronumber">1.12</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_call_iname</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="functiontext"><a href="27-hr.html#SP4">Hierarchy::find</a></span><span class="plain">(</span><span class="constant">REAL_NUMBER_TY_POW_HL</span><span class="plain">));</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_X</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">);</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">p</span><span class="plain"> = </span><span class="constant">0</span><span class="plain">;</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Y</span><span class="plain">) </span><span class="identifier">p</span><span class="plain"> = </span><span class="functiontext"><a href="14-rv.html#SP8">Rvalues::to_int</a></span><span class="plain">(</span><span class="identifier">Y</span><span class="plain">);</span>
            <span class="reserved">else</span><span class="plain"> </span><span class="identifier">p</span><span class="plain"> = </span><span class="functiontext"><a href="14-rv.html#SP8">Rvalues::to_int</a></span><span class="plain">(</span><span class="identifier">EY</span><span class="plain">-&gt;</span><span class="element">leaf_constant</span><span class="plain">);</span>
            <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">p</span><span class="plain"> &lt;= </span><span class="constant">0</span><span class="plain">) </span><span class="functiontext"><a href="20-eq.html#SP49">Equations::enode_compilation_error</a></span><span class="plain">(</span><span class="identifier">eqn</span><span class="plain">, </span><span class="identifier">EY</span><span class="plain">);</span>
            <span class="reserved">else</span><span class="plain"> {</span>
                <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=1; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">p</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) {</span>
                    <span class="identifier">Kinds::Dimensions::kind_rescale_multiplication_emit_op</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="identifier">KX</span><span class="plain">);</span>
                    <span class="identifier">Produce::inv_primitive</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">TIMES_BIP</span><span class="plain">);</span>
                    <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                        &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="plain">}</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=1; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">p</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) {</span>
                    <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                    <span class="identifier">Kinds::Dimensions::kind_rescale_multiplication_emit_factor</span><span class="plain">(</span><span class="identifier">KX</span><span class="plain">, </span><span class="identifier">KX</span><span class="plain">);</span>
                <span class="plain">}</span>
            <span class="plain">}</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_13"></a><b>&#167;1.13.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit function application</span> <span class="cwebmacronumber">1.13</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">use_fp</span><span class="plain">) {</span>
            <span class="identifier">Produce::inv_primitive</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">INDIRECT1_BIP</span><span class="plain">);</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::begin_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
                <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">promote_Y</span><span class="plain">) </span><span class="identifier">Kinds::FloatingPoint::end_flotation_emit</span><span class="plain">(</span><span class="identifier">KY</span><span class="plain">);</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">} </span><span class="reserved">else</span><span class="plain"> {</span>
            <span class="identifier">Produce::inv_primitive</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">(), </span><span class="identifier">INDIRECT1_BIP</span><span class="plain">);</span>
            <span class="identifier">Produce::down</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
                &lt;<span class="cwebmacro">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt;<span class="plain">;</span>
                &lt;<span class="cwebmacro">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt;<span class="plain">;</span>
            <span class="identifier">Produce::up</span><span class="plain">(</span><span class="functiontext"><a href="27-em.html#SP2">Emit::tree</a></span><span class="plain">());</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_2_1"></a><b>&#167;1.2.1.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit the X-operand</span> <span class="cwebmacronumber">1.2.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">X</span><span class="plain">) </span><span class="functiontext"><a href="14-cfs.html#SP8">Specifications::Compiler::emit_to_kind</a></span><span class="plain">(</span><span class="identifier">X</span><span class="plain">, </span><span class="identifier">KX</span><span class="plain">); </span><span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="20-eq.html#SP48">Equations::enode_compile_by_emission</a></span><span class="plain">(</span><span class="identifier">eqn</span><span class="plain">, </span><span class="identifier">EX</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_2">&#167;1.2</a> (twice), <a href="#SP1_3">&#167;1.3</a> (twice), <a href="#SP1_4">&#167;1.4</a> (twice), <a href="#SP1_5">&#167;1.5</a> (twice), <a href="#SP1_6">&#167;1.6</a> (twice), <a href="#SP1_7">&#167;1.7</a> (twice), <a href="#SP1_8">&#167;1.8</a> (twice), <a href="#SP1_9">&#167;1.9</a> (twice), <a href="#SP1_10">&#167;1.10</a>, <a href="#SP1_11">&#167;1.11</a> (twice), <a href="#SP1_12">&#167;1.12</a> (three times), <a href="#SP1_13">&#167;1.13</a> (twice).</p>

<p class="inwebparagraph"><a id="SP1_2_2"></a><b>&#167;1.2.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Emit the Y-operand</span> <span class="cwebmacronumber">1.2.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Y</span><span class="plain">) </span><span class="functiontext"><a href="14-cfs.html#SP8">Specifications::Compiler::emit_to_kind</a></span><span class="plain">(</span><span class="identifier">Y</span><span class="plain">, </span><span class="identifier">KY</span><span class="plain">); </span><span class="reserved">else</span><span class="plain"> </span><span class="functiontext"><a href="20-eq.html#SP48">Equations::enode_compile_by_emission</a></span><span class="plain">(</span><span class="identifier">eqn</span><span class="plain">, </span><span class="identifier">EY</span><span class="plain">);</span>

</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1_2">&#167;1.2</a> (twice), <a href="#SP1_3">&#167;1.3</a> (twice), <a href="#SP1_4">&#167;1.4</a> (twice), <a href="#SP1_5">&#167;1.5</a> (twice), <a href="#SP1_6">&#167;1.6</a> (twice), <a href="#SP1_7">&#167;1.7</a> (twice), <a href="#SP1_10">&#167;1.10</a>, <a href="#SP1_12">&#167;1.12</a>, <a href="#SP1_13">&#167;1.13</a> (twice).</p>

<hr class="tocbar">
<ul class="toc"><li><a href="13-kak.html">Back to 'Knowledge about Kinds'</a></li><li><a href="13-rsfk.html">Continue with 'Runtime Support for Kinds'</a></li></ul><hr class="tocbar">
<!--End of weave-->
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
		</main>
	</body>
</html>

