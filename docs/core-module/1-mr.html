<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>1/cm</title>
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">
		<link href="../inweb.css" rel="stylesheet" rev="stylesheet" type="text/css">
	</head>
	<body>
		<nav role="navigation">
		<h1><a href="../webs.html">Sources</a></h1>
<ul>
<li><a href="../compiler.html"><b>compiler</b></a></li>
<li><a href="../other.html">other tools</a></li>
<li><a href="../extensions.html">extensions and kits</a></li>
<li><a href="../units.html">unit test tools</a></li>
</ul>
<h2>Compiler Webs</h2>
<ul>
<li><a href="../inbuild/index.html">inbuild</a></li>
<li><a href="../inform7/index.html">inform7</a></li>
<li><a href="../inter/index.html">inter</a></li>
</ul>
<h2>Inbuild Modules</h2>
<ul>
<li><a href="../inbuild-module/index.html">inbuild</a></li>
<li><a href="../arch-module/index.html">arch</a></li>
<li><a href="../words-module/index.html">words</a></li>
<li><a href="../syntax-module/index.html">syntax</a></li>
<li><a href="../html-module/index.html">html</a></li>
</ul>
<h2>Inform7 Modules</h2>
<ul>
<li><a href="../core-module/index.html">core</a></li>
<li><a href="../problems-module/index.html">problems</a></li>
<li><a href="../inflections-module/index.html">inflections</a></li>
<li><a href="../linguistics-module/index.html">linguistics</a></li>
<li><a href="../kinds-module/index.html">kinds</a></li>
<li><a href="../if-module/index.html">if</a></li>
<li><a href="../multimedia-module/index.html">multimedia</a></li>
<li><a href="../index-module/index.html">index</a></li>
</ul>
<h2>Inter Modules</h2>
<ul>
<li><a href="../inter-module/index.html">inter</a></li>
<li><a href="../building-module/index.html">building</a></li>
<li><a href="../codegen-module/index.html">codegen</a></li>
</ul>
<h2>Foundation</h2>
<ul>
<li><a href="../../../inweb/docs/foundation-module/index.html">foundation</a></li>
</ul>


		</nav>
		<main role="main">
		
<!--Weave of '1/mr' generated by 7-->
<ul class="crumbs"><li><a href="../webs.html">Source</a></li><li><a href="../compiler.html">Compiler Modules</a></li><li><a href="index.html">core</a></li><li><a href="index.html#1">Chapter 1: Configuration and Control</a></li><li><b>Main Routine</b></li></ul><p class="purpose">The top level of the Inform 7 compiler, reading command line arguments and preparing the way.</p>

<ul class="toc"><li><a href="#SP1">&#167;1. The Management</a></li><li><a href="#SP2">&#167;2. Command line processing</a></li></ul><hr class="tocbar">

<p class="inwebparagraph"><a id="SP1"></a><b>&#167;1. The Management. </b>All C programs begin execution in <code class="display"><span class="extract">main</span></code>, but the function below is not it.
This is because the compiler proper is a tiny wrapper around a collection of
modules, of which <code class="display"><span class="extract">core</span></code> is only one. <code class="display"><span class="extract">main</span></code> is found in that wrapper. On the
other hand, <code class="display"><span class="extract">main</span></code> simply starts up the modules and hands straight over to us.
</p>

<p class="inwebparagraph">So the <code class="display"><span class="extract">CoreMain::main</span></code> function certainly has the opportunity to be head
honcho, and for the first fifteen years of Inform 7, it was exactly that. In
2020, though, it was deposed in a boardroom coup by a new CEO, the <code class="display"><span class="extract">inbuild</span></code>
module. High-level decisions on what to compile, where to put the result, and
so on, are all now taken by <code class="display"><span class="extract">inbuild</span></code>. Even the command line is very largely
read and dealt with by <code class="display"><span class="extract">inbuild</span></code> and not by <code class="display"><span class="extract">core</span></code>, as we shall see. The
upshot is that <code class="display"><span class="extract">CoreMain::main</span></code> is now a manager in name only, reduced to the
equivalent of unlocking the doors and turning the lights on in the morning.
</p>


<pre class="display">
    <span class="identifier">pathname</span><span class="plain"> *</span><span class="identifier">path_to_inform7</span><span class="plain"> = </span><span class="identifier">NULL</span><span class="plain">;</span>

    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">CoreMain::main</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">argc</span><span class="plain">, </span><span class="reserved">char</span><span class="plain"> *</span><span class="identifier">argv</span><span class="plain">[]) {</span>
        &lt;<span class="cwebmacro">Banner and startup</span> <span class="cwebmacronumber">1.1</span>&gt;<span class="plain">;</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">proceed</span><span class="plain"> = </span><span class="functiontext">CoreMain::read_command_line</span><span class="plain">(</span><span class="identifier">argc</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">proceed</span><span class="plain">) {</span>
            &lt;<span class="cwebmacro">Open the debugging log and the problems report</span> <span class="cwebmacronumber">1.2</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Name the telemetry</span> <span class="cwebmacronumber">1.3</span>&gt;<span class="plain">;</span>
            &lt;<span class="cwebmacro">Build the project identified for us by Inbuild</span> <span class="cwebmacronumber">1.4</span>&gt;<span class="plain">;</span>
        <span class="plain">}</span>

        <span class="comment">ParseTree::log_tree(DL, Task::syntax_tree()-&gt;root_node);</span>

        &lt;<span class="cwebmacro">Post mortem logging</span> <span class="cwebmacronumber">1.5</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">proceed</span><span class="plain">) </span>&lt;<span class="cwebmacro">Shutdown and rennab</span> <span class="cwebmacronumber">1.6</span>&gt;<span class="plain">;</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">problem_count</span><span class="plain"> &gt; 0) </span><span class="identifier">Problems::Fatal::exit</span><span class="plain">(1);</span>
        <span class="reserved">return</span><span class="plain"> 0;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function CoreMain::main appears nowhere else.</p>

<p class="inwebparagraph"><a id="SP1_1"></a><b>&#167;1.1.  </b>The very first thing we do is to make sure internal errors, though they
should never happen, are reported as problem messages (fed to our HTML
problems report) rather than simply causing an abrupt exit with only a
plain text error written to <code class="display"><span class="extract">stderr</span></code>. See the <code class="display"><span class="extract">problems</span></code> module for more.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Banner and startup</span> <span class="cwebmacronumber">1.1</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">Errors::set_internal_handler</span><span class="plain">(&amp;</span><span class="identifier">Problems::Issue::internal_error_fn</span><span class="plain">);</span>
        <span class="identifier">PRINT</span><span class="plain">(</span><span class="string">"Inform 7 v[[Version Number]] has started.\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">FALSE</span><span class="plain">, </span><span class="identifier">TRUE</span><span class="plain">);</span>
        <span class="functiontext">Plugins::Manage::start</span><span class="plain">();</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_2"></a><b>&#167;1.2.  </b><code class="display"><span class="extract">inbuild</span></code> supplies us with a folder in which to write the debugging log
and the Problems report (the HTML version of our error messages or success
message, which is displayed in the Inform app when a compilation has finished).
This folder will usually be the <code class="display"><span class="extract">Build</span></code> subfolder of the project folder,
but we won't assume that. Remember, <code class="display"><span class="extract">inbuild</span></code> knows best.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Open the debugging log and the problems report</span> <span class="cwebmacronumber">1.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">pathname</span><span class="plain"> *</span><span class="identifier">build_folder</span><span class="plain"> = </span><span class="identifier">Projects::build_pathname</span><span class="plain">(</span><span class="identifier">Inbuild::project</span><span class="plain">());</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Pathnames::create_in_file_system</span><span class="plain">(</span><span class="identifier">build_folder</span><span class="plain">) == 0)</span>
            <span class="identifier">Problems::Fatal::issue</span><span class="plain">(</span>
                <span class="string">"Unable to create Build folder for project: is it read-only?"</span><span class="plain">);</span>

        <span class="identifier">filename</span><span class="plain"> *</span><span class="identifier">DF</span><span class="plain"> = </span><span class="identifier">Filenames::in_folder</span><span class="plain">(</span><span class="identifier">build_folder</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Debug log.txt"</span><span class="plain">);</span>
        <span class="identifier">Log::set_debug_log_filename</span><span class="plain">(</span><span class="identifier">DF</span><span class="plain">);</span>
        <span class="identifier">Log::open</span><span class="plain">();</span>
        <span class="identifier">LOG</span><span class="plain">(</span><span class="string">"inform7 was called as:"</span><span class="plain">);</span>
        <span class="reserved">for</span><span class="plain"> (</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">i</span><span class="plain">=0; </span><span class="identifier">i</span><span class="plain">&lt;</span><span class="identifier">argc</span><span class="plain">; </span><span class="identifier">i</span><span class="plain">++) </span><span class="identifier">LOG</span><span class="plain">(</span><span class="string">" %s"</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">[</span><span class="identifier">i</span><span class="plain">]);</span>
        <span class="identifier">LOG</span><span class="plain">(</span><span class="string">"\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
        <span class="identifier">CommandLine::play_back_log</span><span class="plain">();</span>

        <span class="identifier">filename</span><span class="plain"> *</span><span class="identifier">PF</span><span class="plain"> = </span><span class="identifier">Filenames::in_folder</span><span class="plain">(</span><span class="identifier">build_folder</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"Problems.html"</span><span class="plain">);</span>
        <span class="identifier">Problems::Issue::start_problems_report</span><span class="plain">(</span><span class="identifier">PF</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_3"></a><b>&#167;1.3.  </b>Telemetry is not as sinister as it sounds: the app isn't sending data out
on the Internet, only (if requested) logging what it's doing to a local file.
This was provided for classroom use, so that teachers can see what their
students have been getting stuck on. In any case, it needs to be activated
with a use option, so by default this file will never be written.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Name the telemetry</span> <span class="cwebmacronumber">1.3</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">pathname</span><span class="plain"> *</span><span class="identifier">P</span><span class="plain"> = </span><span class="identifier">Pathnames::subfolder</span><span class="plain">(</span><span class="identifier">Inbuild::transient</span><span class="plain">(), </span><span class="identifier">I</span><span class="string">"Telemetry"</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Pathnames::create_in_file_system</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">)) {</span>
            <span class="identifier">TEMPORARY_TEXT</span><span class="plain">(</span><span class="identifier">leafname_of_telemetry</span><span class="plain">);</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">this_month</span><span class="plain"> = </span><span class="identifier">the_present</span><span class="plain">-&gt;</span><span class="identifier">tm_mon</span><span class="plain"> + 1;</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">this_day</span><span class="plain"> = </span><span class="identifier">the_present</span><span class="plain">-&gt;</span><span class="identifier">tm_mday</span><span class="plain">;</span>
            <span class="reserved">int</span><span class="plain"> </span><span class="identifier">this_year</span><span class="plain"> = </span><span class="identifier">the_present</span><span class="plain">-&gt;</span><span class="identifier">tm_year</span><span class="plain"> + 1900;</span>
            <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">leafname_of_telemetry</span><span class="plain">,</span>
                <span class="string">"Telemetry %04d-%02d-%02d.txt"</span><span class="plain">, </span><span class="identifier">this_year</span><span class="plain">, </span><span class="identifier">this_month</span><span class="plain">, </span><span class="identifier">this_day</span><span class="plain">);</span>
            <span class="identifier">filename</span><span class="plain"> *</span><span class="identifier">F</span><span class="plain"> = </span><span class="identifier">Filenames::in_folder</span><span class="plain">(</span><span class="identifier">P</span><span class="plain">, </span><span class="identifier">leafname_of_telemetry</span><span class="plain">);</span>
            <span class="identifier">Telemetry::locate_telemetry_file</span><span class="plain">(</span><span class="identifier">F</span><span class="plain">);</span>
            <span class="identifier">DISCARD_TEXT</span><span class="plain">(</span><span class="identifier">leafname_of_telemetry</span><span class="plain">);</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_4"></a><b>&#167;1.4.  </b>The compiler is now ready for use. We ask <code class="display"><span class="extract">inbuild</span></code> what project the user
seems to want to build (as expressed on the command line), and then we ask
it to go ahead and build that project.
</p>

<p class="inwebparagraph">But the art of leadership is delegation and what <code class="display"><span class="extract">inbuild</span></code> then does is to
call <code class="display"><span class="extract">core</span></code> back again to do the actual work: see the What To Compile section.
That sounds like an unnecessary round trip, but in fact it's not, because
<code class="display"><span class="extract">inbuild</span></code> also incrementally builds some of the resources we will be using.
That business is helpfully invisible to us: so it turns out that CEOs do
something, after all.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Build the project identified for us by Inbuild</span> <span class="cwebmacronumber">1.4</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">inform_project</span><span class="plain"> *</span><span class="identifier">project</span><span class="plain"> = </span><span class="identifier">Inbuild::go_operational</span><span class="plain">();</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">project</span><span class="plain">)</span>
            <span class="identifier">Copies::build</span><span class="plain">(</span><span class="identifier">STDOUT</span><span class="plain">, </span><span class="identifier">project</span><span class="plain">-&gt;</span><span class="identifier">as_copy</span><span class="plain">,</span>
                <span class="identifier">BuildMethodology::stay_in_current_process</span><span class="plain">());</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_5"></a><b>&#167;1.5.  </b>The options commented out here are very rarely useful, and some generate
gargantuan debugging logs if enabled.
</p>


<p class="macrodefinition"><code class="display">
&lt;<span class="cwebmacrodefn">Post mortem logging</span> <span class="cwebmacronumber">1.5</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">problem_count</span><span class="plain"> == 0) {</span>
            <span class="identifier">TemplateReader::report_unacted_upon_interventions</span><span class="plain">();</span>
            <span class="comment">Memory::log_statistics();</span>
            <span class="comment">Preform::log_language();</span>
            <span class="comment">Index::DocReferences::log_statistics();</span>
            <span class="comment">NewVerbs::log_all();</span>
        <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP1_6"></a><b>&#167;1.6.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Shutdown and rennab</span> <span class="cwebmacronumber">1.6</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">Problems::write_reports</span><span class="plain">(</span><span class="identifier">FALSE</span><span class="plain">);</span>
        <span class="identifier">LOG</span><span class="plain">(</span><span class="string">"Total of %d files written as streams.\</span><span class="plain">n</span><span class="string">"</span><span class="plain">, </span><span class="identifier">total_file_writes</span><span class="plain">);</span>
        <span class="identifier">Writers::log_escape_usage</span><span class="plain">();</span>
        <span class="identifier">WRITE_TO</span><span class="plain">(</span><span class="identifier">STDOUT</span><span class="plain">, </span><span class="string">"Inform 7 has finished.\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP2"></a><b>&#167;2. Command line processing. </b>The bulk of the command-line options are both registered and processed by
<code class="display"><span class="extract">inbuild</span></code> rather than here: in particular, every switch ever used by the
Inform UI apps is really a command to <code class="display"><span class="extract">inbuild</span></code> not to <code class="display"><span class="extract">inform7</span></code>.
</p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="functiontext">CoreMain::read_command_line</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">argc</span><span class="plain">, </span><span class="reserved">char</span><span class="plain"> *</span><span class="identifier">argv</span><span class="plain">[]) {</span>
        <span class="identifier">CommandLine::declare_heading</span><span class="plain">(</span>
            <span class="identifier">L</span><span class="string">"inform7: a compiler from source text to Inter code\</span><span class="plain">n</span><span class="string">\</span><span class="plain">n</span><span class="string">"</span>
            <span class="identifier">L</span><span class="string">"Usage: inform7 [OPTIONS]\</span><span class="plain">n</span><span class="string">"</span><span class="plain">);</span>

        &lt;<span class="cwebmacro">Register command-line arguments</span> <span class="cwebmacronumber">2.2</span>&gt;<span class="plain">;</span>
        <span class="identifier">Inbuild::declare_options</span><span class="plain">();</span>
        <span class="reserved">int</span><span class="plain"> </span><span class="identifier">proceed</span><span class="plain"> = </span><span class="identifier">CommandLine::read</span><span class="plain">(</span><span class="identifier">argc</span><span class="plain">, </span><span class="identifier">argv</span><span class="plain">, </span><span class="identifier">NULL</span><span class="plain">, &amp;</span><span class="functiontext">CoreMain::switch</span><span class="plain">, &amp;</span><span class="functiontext">CoreMain::bareword</span><span class="plain">);</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">proceed</span><span class="plain">) {</span>
            <span class="identifier">path_to_inform7</span><span class="plain"> = </span><span class="identifier">Pathnames::installation_path</span><span class="plain">(</span><span class="string">"INFORM7_PATH"</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"inform7"</span><span class="plain">);</span>
            <span class="identifier">Inbuild::optioneering_complete</span><span class="plain">(</span><span class="identifier">NULL</span><span class="plain">, </span><span class="identifier">TRUE</span><span class="plain">, &amp;</span><span class="functiontext">Semantics::read_preform</span><span class="plain">);</span>
        <span class="plain">}</span>
        <span class="reserved">return</span><span class="plain"> </span><span class="identifier">proceed</span><span class="plain">;</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function CoreMain::read_command_line is used in <a href="#SP1">&#167;1</a>.</p>

<p class="inwebparagraph"><a id="SP2_1"></a><b>&#167;2.1.  </b>What remains here are just some eldritch options for testing the <code class="display"><span class="extract">inform7</span></code>
compiler via Delia scripts in <code class="display"><span class="extract">intest</span></code>.
</p>


<pre class="definitions">
    <span class="definitionkeyword">enum</span> <span class="constant">INFORM_TESTING_CLSG</span>
    <span class="definitionkeyword">enum</span> <span class="constant">CRASHALL_CLSW</span>
    <span class="definitionkeyword">enum</span> <span class="constant">INDEX_CLSW</span>
    <span class="definitionkeyword">enum</span> <span class="constant">PROGRESS_CLSW</span>
    <span class="definitionkeyword">enum</span> <span class="constant">REQUIRE_PROBLEM_CLSW</span>
    <span class="definitionkeyword">enum</span> <span class="constant">SIGILS_CLSW</span>
</pre>
<p class="inwebparagraph"><a id="SP2_2"></a><b>&#167;2.2.  </b><code class="display">
&lt;<span class="cwebmacrodefn">Register command-line arguments</span> <span class="cwebmacronumber">2.2</span>&gt; =
</code></p>


<pre class="displaydefn">
        <span class="identifier">CommandLine::begin_group</span><span class="plain">(</span><span class="constant">INFORM_TESTING_CLSG</span><span class="plain">, </span><span class="identifier">I</span><span class="string">"for testing and debugging inform7"</span><span class="plain">);</span>
        <span class="identifier">CommandLine::declare_boolean_switch</span><span class="plain">(</span><span class="constant">CRASHALL_CLSW</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"crash-all"</span><span class="plain">, 1,</span>
            <span class="identifier">L</span><span class="string">"intentionally crash on Problem messages, for backtracing"</span><span class="plain">, </span><span class="identifier">FALSE</span><span class="plain">);</span>
        <span class="identifier">CommandLine::declare_boolean_switch</span><span class="plain">(</span><span class="constant">INDEX_CLSW</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"index"</span><span class="plain">, 1,</span>
            <span class="identifier">L</span><span class="string">"produce an Index"</span><span class="plain">, </span><span class="identifier">TRUE</span><span class="plain">);</span>
        <span class="identifier">CommandLine::declare_boolean_switch</span><span class="plain">(</span><span class="constant">PROGRESS_CLSW</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"progress"</span><span class="plain">, 1,</span>
            <span class="identifier">L</span><span class="string">"display progress percentages"</span><span class="plain">, </span><span class="identifier">TRUE</span><span class="plain">);</span>
        <span class="identifier">CommandLine::declare_boolean_switch</span><span class="plain">(</span><span class="constant">SIGILS_CLSW</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"sigils"</span><span class="plain">, 1,</span>
            <span class="identifier">L</span><span class="string">"print Problem message sigils"</span><span class="plain">, </span><span class="identifier">FALSE</span><span class="plain">);</span>
        <span class="identifier">CommandLine::declare_switch</span><span class="plain">(</span><span class="constant">REQUIRE_PROBLEM_CLSW</span><span class="plain">, </span><span class="identifier">L</span><span class="string">"require-problem"</span><span class="plain">, 2,</span>
            <span class="identifier">L</span><span class="string">"return 0 unless exactly this Problem message is generated"</span><span class="plain">);</span>
        <span class="identifier">CommandLine::end_group</span><span class="plain">();</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">This code is used in <a href="#SP2">&#167;2</a>.</p>

<p class="inwebparagraph"><a id="SP3"></a><b>&#167;3.  </b>Three of the five options here actually configure the <code class="display"><span class="extract">problems</span></code> module
rather than <code class="display"><span class="extract">core</span></code>.
</p>


<pre class="display">
    <span class="reserved">int</span><span class="plain"> </span><span class="identifier">show_progress_indicator</span><span class="plain"> = </span><span class="identifier">TRUE</span><span class="plain">; </span>    <span class="comment">Produce percentage of progress messages</span>
    <span class="reserved">int</span><span class="plain"> </span><span class="identifier">do_not_generate_index</span><span class="plain"> = </span><span class="identifier">FALSE</span><span class="plain">; </span>    <span class="comment">Set by the <code class="display"><span class="extract">-noindex</span></code> command line option</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">CoreMain::switch</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">id</span><span class="plain">, </span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">arg</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">state</span><span class="plain">) {</span>
        <span class="reserved">switch</span><span class="plain"> (</span><span class="identifier">id</span><span class="plain">) {</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">CRASHALL_CLSW</span><span class="plain">: </span><span class="identifier">debugger_mode</span><span class="plain"> = </span><span class="identifier">val</span><span class="plain">; </span><span class="identifier">crash_on_all_errors</span><span class="plain"> = </span><span class="identifier">val</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">INDEX_CLSW</span><span class="plain">: </span><span class="identifier">do_not_generate_index</span><span class="plain"> = </span><span class="identifier">val</span><span class="plain">?</span><span class="identifier">FALSE</span><span class="plain">:</span><span class="identifier">TRUE</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">PROGRESS_CLSW</span><span class="plain">: </span><span class="identifier">show_progress_indicator</span><span class="plain"> = </span><span class="identifier">val</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">SIGILS_CLSW</span><span class="plain">: </span><span class="identifier">echo_problem_message_sigils</span><span class="plain"> = </span><span class="identifier">val</span><span class="plain">; </span><span class="reserved">break</span><span class="plain">;</span>
            <span class="reserved">case</span><span class="plain"> </span><span class="constant">REQUIRE_PROBLEM_CLSW</span><span class="plain">: </span><span class="identifier">Problems::Fatal::require</span><span class="plain">(</span><span class="identifier">arg</span><span class="plain">); </span><span class="reserved">break</span><span class="plain">;</span>
        <span class="plain">}</span>
        <span class="identifier">Inbuild::option</span><span class="plain">(</span><span class="identifier">id</span><span class="plain">, </span><span class="identifier">val</span><span class="plain">, </span><span class="identifier">arg</span><span class="plain">, </span><span class="identifier">state</span><span class="plain">);</span>
    <span class="plain">}</span>

    <span class="reserved">void</span><span class="plain"> </span><span class="functiontext">CoreMain::bareword</span><span class="plain">(</span><span class="reserved">int</span><span class="plain"> </span><span class="identifier">id</span><span class="plain">, </span><span class="identifier">text_stream</span><span class="plain"> *</span><span class="identifier">opt</span><span class="plain">, </span><span class="reserved">void</span><span class="plain"> *</span><span class="identifier">state</span><span class="plain">) {</span>
        <span class="reserved">if</span><span class="plain"> (</span><span class="identifier">Inbuild::set_I7_source</span><span class="plain">(</span><span class="identifier">opt</span><span class="plain">) == </span><span class="identifier">FALSE</span><span class="plain">)</span>
            <span class="identifier">Errors::fatal_with_text</span><span class="plain">(</span><span class="string">"unknown command line argument: %S (see -help)"</span><span class="plain">, </span><span class="identifier">opt</span><span class="plain">);</span>
    <span class="plain">}</span>
</pre>

<p class="inwebparagraph"></p>

<p class="endnote">The function CoreMain::switch is used in <a href="#SP2">&#167;2</a>.</p>

<p class="endnote">The function CoreMain::bareword is used in <a href="#SP2">&#167;2</a>.</p>

<hr class="tocbar">
<ul class="toc"><li><a href="1-cm.html">Back to 'Core Module'</a></li><li><a href="1-wtc.html">Continue with 'What To Compile'</a></li></ul><hr class="tocbar">
<!--End of weave-->
		</main>
	</body>
</html>

